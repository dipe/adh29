[
    {
        "id": "37daec28.284ee4",
        "type": "tab",
        "label": "WoZi",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2ba29887.9266e8",
        "type": "tab",
        "label": "EsZi",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3a471104.edfbae",
        "type": "tab",
        "label": "Treppenhaus",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4d90b497.b5b2ac",
        "type": "tab",
        "label": "Waschküche",
        "disabled": false,
        "info": ""
    },
    {
        "id": "293bb437.fa00bc",
        "type": "tab",
        "label": "Außen",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fc81a32b.bb6db",
        "type": "tab",
        "label": "Store sensor data global",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2f328ad8.26ca86",
        "type": "tab",
        "label": "Verbrauch",
        "disabled": false,
        "info": ""
    },
    {
        "id": "dac2cb3b.559138",
        "type": "tab",
        "label": "Warmwasser",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4fa3b184.bc7fb",
        "type": "tab",
        "label": "Luftgütemesser1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2788b93b.8a2f56",
        "type": "tab",
        "label": "Lüftungsempfehlungen",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d0173d54.941d7",
        "type": "tab",
        "label": "influxdb",
        "disabled": false,
        "info": ""
    },
    {
        "id": "559aac41a5cf74c4",
        "type": "tab",
        "label": "IR Heizungen",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "caf02dc9a5b73890",
        "type": "tab",
        "label": "Nuki",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0133ddc4e63513b7",
        "type": "tab",
        "label": "Fingersensor",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ff52c0df.f6082",
        "type": "tab",
        "label": "Zigbee Low Battery Notifications",
        "disabled": true,
        "info": "\n![enter image description here](https://notenoughtech.com/wp-content/uploads/2020/01/maxresdefault-4.jpg)\nMonitoring more than a couple Zigbee devices for battery levels can be cumbersome. So I made a system that adds new devices automatically,keeps the battery info as a dashboard and sends you an Android notification when battery needs replacing.\n\n - [Complete instructions](https://notenoughtech.com/home-automation/zigbee-low-battery-warning/)\n\n**Features**:\n-   add devices automatically    \n-   Dashboard chart    \n-   notification for Android    \n-   custom low trigger    \n-   support for battery types and purchase links    \n-   more...\n\n## Requirements\n\n - node-red-contrib-dashboard-average-bars\n - node-red-dashboard\n\nYou will need the following Android Apps:\n\n - [Tasker](https://play.google.com/store/apps/details?id=net.dinglisch.android.taskerm&hl=en)\n - [AutoNotification](https://play.google.com/store/apps/details?id=com.joaomgcd.autonotification&hl=en)\n - [AutoTools](https://play.google.com/store/apps/details?id=com.joaomgcd.autotools&hl=en)\n - [AutoRemote](https://play.google.com/store/apps/details?id=com.joaomgcd.autoremote&hl=en)\n - [AutoApps](https://play.google.com/store/apps/details?id=com.joaomgcd.autoappshub&hl=en)\n \n This Setup leans on the following guides:\n [Perfect Autonotifications](https://notenoughtech.com/tasker/tasker-projects/tasker-perfect-autonotifications/), [Credentials in NodeRED](https://notenoughtech.com/home-automation/nodered-home-automation/serving-credentials-with-nodered/),\n\n# Settings\n\n - **battery** - battery type for your device\n - **name**  - friendly_name from yaml file (or ID)\n - **Notification Device**  - name of AutoRemote device served with credential system\n - **min Value**  - Low battery threshold value for notifications\n \n ## More about me:\n\nIf you want to get the latest updates to this project you can follow me via your preferred social media:\n\n-   [Facebook](https://www.facebook.com/NotEnoughTECH/)\n-   [Twitter](https://twitter.com/NotEnoughTECH)\n-   [Instagram](https://www.instagram.com/notenoughtech/)\n-   [YouTube](https://www.youtube.com/user/Polepositionpage)\n\nAnd if you feeling like buying me a coffee or supporting me in a more continuous way:\n\n-   [Paypal](https://www.paypal.me/notenoughtech)\n-   [Patreon](https://www.patreon.com/NotEnoughTECH)\n\nI hope you have enjoyed the project!\n\n "
    },
    {
        "id": "650e7c81.102bb4",
        "type": "tab",
        "label": "Nuki push state changes",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a48db0b1.9dac6",
        "type": "subflow",
        "name": "Zigbee Low Battery Setting",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 80,
                "wires": [
                    {
                        "id": "8e65b3ed.9f24"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 80,
                "wires": [
                    {
                        "id": "8e65b3ed.9f24",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "NotificationDevice",
                "type": "str",
                "value": ""
            },
            {
                "name": "BatteryWarning",
                "type": "num",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-battery-0",
                    "label": {
                        "en-US": "Min Value"
                    },
                    "type": "spinner",
                    "opts": {
                        "min": 1,
                        "max": 25
                    }
                }
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "97561555.3ea248",
        "type": "subflow",
        "name": "Subflow 1",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 300,
                "y": 100,
                "wires": [
                    {
                        "id": "9b62f1c2.e1c83"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 580,
                "y": 100,
                "wires": [
                    {
                        "id": "9b62f1c2.e1c83",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "BatteryType",
                "type": "str",
                "value": "CR2032",
                "ui": {
                    "icon": "font-awesome/fa-battery-4",
                    "label": {
                        "en-US": "CR2450"
                    },
                    "type": "select",
                    "opts": {
                        "opts": [
                            {
                                "l": {
                                    "en-US": "CR2450"
                                },
                                "v": "CR2450"
                            },
                            {
                                "l": {
                                    "en-US": "CR2032"
                                },
                                "v": "CR2032"
                            }
                        ]
                    }
                }
            },
            {
                "name": "Name",
                "type": "str",
                "value": "",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "num"
                        ]
                    },
                    "label": {}
                }
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "c349b9ff.9dc4c8",
        "type": "mqtt-broker",
        "name": "dipe-pi",
        "broker": "dipe-pi",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "dc07af4f.71ca1",
        "type": "ui_tab",
        "name": "Wohnzimmer",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "e4ade7a.0cef418",
        "type": "ui_base",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#097479",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#0eb8c0",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "dark"
            }
        },
        "site": {
            "name": "[DIPE] Home",
            "hideToolbar": "false",
            "allowSwipe": "true",
            "lockMenu": "false",
            "allowTempTheme": "none",
            "dateFormat": "YYYY-MM-DD",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "1b9713a7.a3a26c",
        "type": "ui_group",
        "name": "Tiffany",
        "tab": "dc07af4f.71ca1",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "3f0994e3.62d76c",
        "type": "ui_group",
        "name": "Szenen",
        "tab": "dc07af4f.71ca1",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "b4675dbc.146e1",
        "type": "ui_group",
        "name": "Leuchter",
        "tab": "dc07af4f.71ca1",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "4a760c5.5eef1f4",
        "type": "ui_tab",
        "name": "Esszimmer",
        "icon": "dashboard",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "740db3e2.8916ac",
        "type": "ui_group",
        "name": "Fensterbank",
        "tab": "dc07af4f.71ca1",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "33913a78.8716a6",
        "type": "ui_group",
        "name": "Klavierlampe",
        "tab": "dc07af4f.71ca1",
        "order": 5,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "12ecf9a1.9cb126",
        "type": "ui_group",
        "name": "Tisch",
        "tab": "4a760c5.5eef1f4",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "643154e.6b44bac",
        "type": "ui_group",
        "name": "Eckschrank",
        "tab": "4a760c5.5eef1f4",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "aca2d944.6c15c8",
        "type": "ui_group",
        "name": "Szenen",
        "tab": "4a760c5.5eef1f4",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "1c76ef79.75b781",
        "type": "ui_tab",
        "name": "Waschküche",
        "icon": "dashboard",
        "order": 5,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "e822c4d8.ce3a88",
        "type": "ui_tab",
        "name": "Verbrauch",
        "icon": "dashboard",
        "order": 8,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "48b52eb1.50063",
        "type": "fritzbox-config",
        "name": "",
        "host": "fritz.box",
        "port": "49443",
        "ssl": true
    },
    {
        "id": "7e092ea0.4f2d9",
        "type": "ui_group",
        "name": "Aktuell",
        "tab": "1c76ef79.75b781",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "10925253.f46f4e",
        "type": "hangoutsCertificate",
        "clientEmail": "haus-bot@home-hangout.iam.gserviceaccount.com",
        "privateKey": "-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCYNybJAubXeD6C\\nZQlSnhfZcVDgZWo4Yb3xAEz4/T0b5GpjaiO3oVYcdliFhVc+IfjmPPCeVDQvk3g7\\ns5YqG6NdRtvfqMrckUFzKA4DWmGBM+cdteoloTwn37FDxVZCk2ADXw/A++6bhKcl\\nh9hPtbL6UJvj0Vye5yeVjB9v5/l0pbJ3W+OXDEEZsGtYq3RMeKF7ghY00Z7uweiH\\nxoPO0tOZ5kp9Inmwy7Wd0D+OsjGjyEAu0zsvTOAatdeeErsQmfCrz5U13GYGoUbt\\nQfEChBIA1I17D/Pq9YuJXD+hAM7ZrC48zZwwM2HMoRSSRfiux2kfFhNW/d1zglzS\\nazqAs0lZAgMBAAECggEAD7mx6HYj6FqINbMvvIDv9JNKAFbF26OQapWl/hq2fZtS\\nWOkyHbJdqbTZxhiNl/INS2b8ElVfa1NcSmmuH7VJgjVT+ZYv+AvLI9UdZoAHvwAA\\nVl/Q+/h9dR6dawOX+uqMEqkXYO/+GYPBu2U+hhSe1BCwHEAIxjNaEe9/H3HrIf9k\\nBDSc8mRk1MwOiu5BvKxISWdWbgAgZKzlQaD9/knH430b9YtmF/jseoa1oG+p3cpu\\nfCyFma7yabR9Quugnx8IqSAm4rxVrDfAgH3gRsjwx5QUsl9wVz/egF0XRS6ScR7t\\nvxjd1oUr9Jt1G3QyPk2zLAD+IgAHNah6Sp/Jrp6pgQKBgQDK5Rl6jNlxUQHHSk26\\nQPV4fUMA3aQeERNqRKvSIPNB7upTbdh1ZoU5UeIzIIP4vI4y/B7V+fMQDXjjXuv2\\nft/R6SQ2DgoA3LOH6c+H6c5M5EtPNe/CSkUeKOlIO7IEQVbMyeroV49hfbslHl9G\\nnXxzmmb6pv6lKZTSy75SLZPCgQKBgQDADkqg2Qg26zFxSC5aeiUTQSzyBbVZxwlU\\nnibZpzB9oeQTWuCiS5HWug4T35/YYmzmnQDsM+EQ+JyLdWY9js4Was4eeI/2BxDN\\nYH5TKRB0rIJZ8brUjhVPYSxnBBC+nH9fxlHCQtJA8agEeB6lwqFjy0d6Av+1TUMm\\nBe9j5upq2QKBgD398eL31hhBYAG8OjOGVXoTC73f+p0VKpF1meoCF1E15nLHRTPZ\\ntyrkUfC9JpWBRxFc5y8Jx7JH63/NKNuPuGMykNXTREsvI8uLLNWiIl5sAnaZTEBY\\n4PVuGpjvZFzYeeTobNXAqxZmjB+zP/kbdUL9EinTjEp6gfZGOkhxlIwBAoGATOhs\\nMiU3COb+EaMaDNlE54T9/p0SljUCI4SBgj9VR7oAn0+RDOy+JgKziHnQhNJFUcQl\\njnDn++fSqHYGzzfUh12V1NXqsFb7/4JYk+ypzk8Wk/YdHukW14bORSJ3oh0BVNUS\\nAHzJvYAIDGIdw7tA7bmFkfKJe4zJCvztdFAQJ2ECgYEAwmUMJ8lxdckV2RhxSs8G\\n1iG5f+lfU/e28EHDkV5w20ggaHiybaR/Ye72dLFLXhszMgaVWrP52Voc5aQ3oPaM\\nobJnbdft7IEcLpjLyM94jIN+gGhMvEaulLM3Do/odUvcGpQj8mSqcJqLA/j/j9a7\\n9dAIlJJsy5l3DfBFNn3fNFQ=\\n-----END PRIVATE KEY-----\\n"
    },
    {
        "id": "96087061.c7ebf",
        "type": "ui_tab",
        "name": "Außen",
        "icon": "dashboard",
        "order": 7,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "d32aa509.f54168",
        "type": "ui_group",
        "name": "Licht",
        "tab": "96087061.c7ebf",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "d50d0c9f.31e858",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false
    },
    {
        "id": "c824e9e5.f339c8",
        "type": "ui_tab",
        "name": "Treppenhaus",
        "icon": "dashboard",
        "order": 3,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "64b01bd0.e1d1b4",
        "type": "ui_group",
        "name": "Aktuell",
        "tab": "c824e9e5.f339c8",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "da0dc882.b12038",
        "type": "ui_tab",
        "name": "Lüftungsempfehlungen",
        "icon": "dashboard",
        "order": 11,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "245ec0f9.12765",
        "type": "ui_group",
        "name": "Group 1",
        "tab": "da0dc882.b12038",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false
    },
    {
        "id": "c2e6322e.33404",
        "type": "fritz-api",
        "name": "fritzBox",
        "host": "http://fritz.box",
        "strictSSL": true
    },
    {
        "id": "a8a6836d.1b1cf",
        "type": "ui_group",
        "name": "Gas",
        "tab": "e822c4d8.ce3a88",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "e2d75124.92d37",
        "type": "ui_tab",
        "name": "Warmwasser",
        "icon": "dashboard",
        "order": 9,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "85193673.744e38",
        "type": "ui_group",
        "name": "Timer",
        "tab": "e2d75124.92d37",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "dab59e38.c408e",
        "type": "ui_group",
        "name": "Strom",
        "tab": "e822c4d8.ce3a88",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "eedc289c.0c0738",
        "type": "ui_tab",
        "name": "Werkstatt",
        "icon": "dashboard",
        "order": 6,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "d796a540.50d378",
        "type": "ui_group",
        "name": "Group 1",
        "tab": "eedc289c.0c0738",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "10c3f1d2.4cdbde",
        "type": "ui_group",
        "name": "Manuell",
        "tab": "e2d75124.92d37",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "82403ec68b4e0d16",
        "type": "ui_group",
        "d": true,
        "name": "Wasser",
        "tab": "e822c4d8.ce3a88",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "03f79ee82b15785f",
        "type": "ui_tab",
        "name": "Fahrradkeller",
        "icon": "dashboard",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "6e590cb07ba9a85d",
        "type": "ui_group",
        "name": "Äußentür",
        "tab": "03f79ee82b15785f",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "b6b292c6a3480048",
        "type": "nuki-bridge",
        "host": "nuki-bridge",
        "port": "8080",
        "callbackHost": "http://dipe-pi:1880",
        "clearCallbacks": false,
        "webUpdateTimeout": "30"
    },
    {
        "id": "9092750be0b451a2",
        "type": "ui_tab",
        "name": "IR-Heizungen",
        "icon": "dashboard",
        "order": 10,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "f4c6c5353740e204",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "9092750be0b451a2",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "8929498a4f6d4a2d",
        "type": "config-log",
        "logname": "node-red",
        "logdir": "node-red-logs",
        "stamp": "utc",
        "logstyle": "plain",
        "logrotate": true,
        "logcompress": true,
        "logrotatecount": "5",
        "logsize": "1000"
    },
    {
        "id": "c15e3cecb6ae7609",
        "type": "ui_group",
        "name": "Finger hinzufügen",
        "tab": "03f79ee82b15785f",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e1e3eb2e7b5352d1",
        "type": "ui_group",
        "name": "Finger löschen",
        "tab": "03f79ee82b15785f",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3d281e38187eb483",
        "type": "ui_group",
        "name": "",
        "tab": "03f79ee82b15785f",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "154f06d5432267e7",
        "type": "button-events-config",
        "name": "config for b26ffbed.c2c898",
        "clickedInterval": "200",
        "pressedInterval": "300",
        "debounceInterval": 30
    },
    {
        "id": "e19d291d.da6018",
        "type": "ui_group",
        "name": "Zigbee Battery Status",
        "tab": "71f75e8f.91051",
        "order": 1,
        "disp": true,
        "width": "20",
        "collapse": false
    },
    {
        "id": "71f75e8f.91051",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "bf6b9b61f49db1aa",
        "type": "influxdb",
        "hostname": "127.0.0.1",
        "port": "8086",
        "protocol": "http",
        "database": "database",
        "name": "influxdb",
        "usetls": false,
        "tls": "d50d0c9f.31e858",
        "influxdbVersion": "2.0",
        "url": "http://localhost:8086",
        "rejectUnauthorized": true
    },
    {
        "id": "8e65b3ed.9f24",
        "type": "function",
        "z": "a48db0b1.9dac6",
        "name": "Set Values",
        "func": "var minBattLevel = env.get(\"BatteryWarning\");\nflow.set(\"$parent.BatteryWarning\", parseInt(minBattLevel, 10));\n\nvar device = env.get(\"NotificationDevice\");\nflow.set(\"$parent.NotificationDevice\", device);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "9b62f1c2.e1c83",
        "type": "function",
        "z": "97561555.3ea248",
        "name": "Update Battery",
        "func": "var battType = env.get(\"BatteryType\");\nvar name = env.get(\"Name\");\nvar data = flow.get(\"$parent.zigbeeBattery\");\n\n\nvar battTRL = [\n  {\n    \"battery\": \"CR2032\",\n    \"url\": \"https://amzn.to/2RflnOx\"\n  },\n  {\n    \"battery\": \"CR2450\",\n    \"url\": \"https://amzn.to/2Tlaf5n\"\n  }\n];\n\nvar pos = data.map(function(e) { return e.info.name; }).indexOf(name);\nvar bat = battTRL.map(function(e) { return e.battery; }).indexOf(battType);\nif(pos !== -1){\n    if(bat => 0){data[pos].info.batteryURL = battTRL[bat].url;}\n    \n    data[pos].info.batteryType = battType;\n    flow.set(\"$parent.zigbeeBattery\", data);\n    msg.payload = battType +\" saved as default battery for \"+ name;\n}\nelse {\n    msg.payload = \"Check device name\";\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "930e92a7.3f378",
        "type": "mqtt in",
        "z": "37daec28.284ee4",
        "name": "Wandtaster rechts",
        "topic": "wandschalter-wozi1/binary_sensor/switch_1/state",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 170,
        "y": 180,
        "wires": [
            [
                "5bd1bdfd.b90a34",
                "3fb99550d3adcdae"
            ]
        ]
    },
    {
        "id": "84c90245.9e44f",
        "type": "mqtt in",
        "z": "37daec28.284ee4",
        "name": "Wandtaster links",
        "topic": "wandschalter-wozi1/binary_sensor/switch_2/state",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 160,
        "y": 220,
        "wires": [
            [
                "c018a260.a19a4",
                "3fb99550d3adcdae"
            ]
        ]
    },
    {
        "id": "dd76d72f.e06798",
        "type": "switch",
        "z": "37daec28.284ee4",
        "name": "",
        "property": "payload.device_idx",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 450,
        "y": 380,
        "wires": [
            [],
            [
                "b3e4bb8fe782821f"
            ],
            [
                "ecde6efbce017cdd"
            ],
            [
                "4ee3e653755d72db"
            ],
            [
                "72f5f0ed0262eb0f"
            ]
        ]
    },
    {
        "id": "ed1e9ea1.c5e59",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "save scene idx",
        "func": "msg.payload = Number(msg.payload)\nflow.set(\"current_scene_idx\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 300,
        "wires": [
            [
                "a7dbd651.4467b8"
            ]
        ]
    },
    {
        "id": "a7dbd651.4467b8",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "current scene",
        "func": "var scenes = flow.get(\"scenes\");\nvar current_scene_idx = flow.get(\"current_scene_idx\");\nvar scene = scenes[current_scene_idx];\nmsg.payload = scene.devices;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 340,
        "wires": [
            [
                "9cfaf9a.449b908"
            ]
        ]
    },
    {
        "id": "9cfaf9a.449b908",
        "type": "split",
        "z": "37daec28.284ee4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 230,
        "y": 380,
        "wires": [
            [
                "dd76d72f.e06798"
            ]
        ]
    },
    {
        "id": "3a3f3f29.1be49",
        "type": "link out",
        "z": "37daec28.284ee4",
        "name": "",
        "mode": "link",
        "links": [
            "6637cc7f.54ff74"
        ],
        "x": 795,
        "y": 320,
        "wires": []
    },
    {
        "id": "bd4f1b1d.c1d598",
        "type": "link out",
        "z": "37daec28.284ee4",
        "name": "",
        "links": [
            "a14232cb.a4256",
            "e30a134d.f410a"
        ],
        "x": 795,
        "y": 360,
        "wires": []
    },
    {
        "id": "773f6fe1.26d11",
        "type": "link out",
        "z": "37daec28.284ee4",
        "name": "",
        "links": [
            "bc7fb10d.fa659",
            "4bbc2b23.ee06a4"
        ],
        "x": 795,
        "y": 400,
        "wires": []
    },
    {
        "id": "d0971035.fd6cc",
        "type": "link out",
        "z": "37daec28.284ee4",
        "name": "",
        "links": [
            "cd111146.3d5c4",
            "e5d97c3.d1d738"
        ],
        "x": 795,
        "y": 440,
        "wires": []
    },
    {
        "id": "c5a30ac4.50aad8",
        "type": "inject",
        "z": "37daec28.284ee4",
        "name": "Reset",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "6b9f314660665039"
            ]
        ]
    },
    {
        "id": "4d73c0b1.422e1",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "2",
        "func": "msg.payload = 2;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 220,
        "wires": [
            [
                "5e79d51e.9213dc"
            ]
        ]
    },
    {
        "id": "79fb43e2.dda08c",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "4",
        "func": "msg.payload = 4;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 180,
        "wires": [
            [
                "5e79d51e.9213dc"
            ]
        ]
    },
    {
        "id": "5e79d51e.9213dc",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "toggle szene",
        "func": "var new_scene_idx = msg.payload;\nvar current_scene_idx = flow.get(\"current_scene_idx\");\n\nif (current_scene_idx != new_scene_idx) {\n    current_scene_idx = new_scene_idx\n} else {\n    current_scene_idx = 0\n}\n\nmsg.payload = current_scene_idx;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 200,
        "wires": [
            [
                "ed1e9ea1.c5e59"
            ]
        ]
    },
    {
        "id": "5d0fee20.ccd4d",
        "type": "mqtt out",
        "z": "37daec28.284ee4",
        "name": "Klavierlampe",
        "topic": "zigbee2mqtt/klavierlampe/set",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 250,
        "y": 1340,
        "wires": []
    },
    {
        "id": "f0382b17.121318",
        "type": "mqtt in",
        "z": "37daec28.284ee4",
        "name": "Klavierlampe",
        "topic": "zigbee2mqtt/klavierlampe",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 430,
        "y": 1340,
        "wires": [
            [
                "2a4ae50f.d0a24a"
            ]
        ]
    },
    {
        "id": "2a4ae50f.d0a24a",
        "type": "json",
        "z": "37daec28.284ee4",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 570,
        "y": 1340,
        "wires": [
            [
                "c47da63c.598c78",
                "7eb17679.660788"
            ]
        ]
    },
    {
        "id": "c47da63c.598c78",
        "type": "change",
        "z": "37daec28.284ee4",
        "name": "save Klavierlampe state",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "payload.state = 'ON' ? 'on' : 'off'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "payload.brightness",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "klavierlampe",
                "pt": "flow",
                "to": "{'state': state, 'brightness': brightness}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 1380,
        "wires": [
            [
                "31d2f239.bb705e"
            ]
        ]
    },
    {
        "id": "31d2f239.bb705e",
        "type": "debug",
        "z": "37daec28.284ee4",
        "name": "Klavierleuchte",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 1420,
        "wires": []
    },
    {
        "id": "7eb17679.660788",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "state",
        "func": "msg.payload = {\"state\": msg.payload.state};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 1420,
        "wires": [
            [
                "a491d10d.02174"
            ]
        ]
    },
    {
        "id": "a491d10d.02174",
        "type": "ui_switch",
        "z": "37daec28.284ee4",
        "name": "An/Aus Klavierlampe Fernsehzimmer",
        "label": "An/Aus",
        "tooltip": "",
        "group": "33913a78.8716a6",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "",
        "style": "",
        "onvalue": "{\"state\": \"ON\"}",
        "onvalueType": "json",
        "onicon": "",
        "oncolor": "",
        "offvalue": "{\"state\": \"OFF\"}",
        "offvalueType": "json",
        "officon": "",
        "offcolor": "",
        "x": 330,
        "y": 1460,
        "wires": [
            [
                "5d0fee20.ccd4d"
            ]
        ]
    },
    {
        "id": "4bbc2b23.ee06a4",
        "type": "link in",
        "z": "37daec28.284ee4",
        "name": "Set Klavierlampe",
        "links": [
            "7d2f7d57.122c54",
            "773f6fe1.26d11",
            "8bc43dda.f5f76"
        ],
        "x": 135,
        "y": 1300,
        "wires": [
            [
                "5d0fee20.ccd4d"
            ]
        ]
    },
    {
        "id": "e5d97c3.d1d738",
        "type": "link in",
        "z": "37daec28.284ee4",
        "name": "Set Leuchter",
        "links": [
            "4b03e0d9.5ac29",
            "d0971035.fd6cc",
            "9e89c97e.5c7568"
        ],
        "x": 135,
        "y": 1540,
        "wires": [
            [
                "82751974.3c5238"
            ]
        ]
    },
    {
        "id": "e30a134d.f410a",
        "type": "link in",
        "z": "37daec28.284ee4",
        "name": "Set Fensterbank",
        "links": [
            "54c14fb0.1f53d",
            "8c16d699.6098e8",
            "bd4f1b1d.c1d598"
        ],
        "x": 115,
        "y": 1000,
        "wires": [
            [
                "3915a3f2.641aac"
            ]
        ]
    },
    {
        "id": "6637cc7f.54ff74",
        "type": "link in",
        "z": "37daec28.284ee4",
        "name": "Set Tiffany",
        "links": [
            "17daaa56.bbd986",
            "54c14fb0.1f53d",
            "3a3f3f29.1be49"
        ],
        "x": 115,
        "y": 720,
        "wires": [
            [
                "40e09b5.33b3964"
            ]
        ]
    },
    {
        "id": "3915a3f2.641aac",
        "type": "mqtt out",
        "z": "37daec28.284ee4",
        "name": "Fensterbank",
        "topic": "zigbee2mqtt/fensterbank/set",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 250,
        "y": 1040,
        "wires": []
    },
    {
        "id": "f53bfe8.c90b9",
        "type": "mqtt in",
        "z": "37daec28.284ee4",
        "name": "Fensterbank",
        "topic": "zigbee2mqtt/fensterbank",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 430,
        "y": 1040,
        "wires": [
            [
                "43528aea.e5c924"
            ]
        ]
    },
    {
        "id": "43528aea.e5c924",
        "type": "json",
        "z": "37daec28.284ee4",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 570,
        "y": 1040,
        "wires": [
            [
                "63507385.c44d5c",
                "bcc690db.8cb87",
                "b07f212d.4c75a"
            ]
        ]
    },
    {
        "id": "63507385.c44d5c",
        "type": "change",
        "z": "37daec28.284ee4",
        "name": "save fensterbank state",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "payload.state = 'ON' ? 'on' : 'off'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "payload.brightness",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "fensterbank",
                "pt": "flow",
                "to": "{'state': state, 'brightness': brightness}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 1080,
        "wires": [
            [
                "7da55143.813f7"
            ]
        ]
    },
    {
        "id": "7da55143.813f7",
        "type": "debug",
        "z": "37daec28.284ee4",
        "name": "Fensterbank",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 1120,
        "wires": []
    },
    {
        "id": "8e0a2075.97183",
        "type": "ui_switch",
        "z": "37daec28.284ee4",
        "name": "An/Aus Fensterbank Fernsehzimmer",
        "label": "An/Aus",
        "tooltip": "",
        "group": "740db3e2.8916ac",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "",
        "style": "",
        "onvalue": "{\"state\": \"ON\"}",
        "onvalueType": "json",
        "onicon": "",
        "oncolor": "",
        "offvalue": "{\"state\": \"OFF\"}",
        "offvalueType": "json",
        "officon": "",
        "offcolor": "",
        "x": 330,
        "y": 1140,
        "wires": [
            [
                "7da55143.813f7",
                "3915a3f2.641aac"
            ]
        ]
    },
    {
        "id": "4ba59f70.c989c",
        "type": "ui_slider",
        "z": "37daec28.284ee4",
        "name": "Helligkeit Fensterbank Fernsehzimmer",
        "label": "Helligkeit",
        "tooltip": "",
        "group": "740db3e2.8916ac",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "all",
        "topic": "",
        "min": "20",
        "max": "254",
        "step": "25",
        "x": 330,
        "y": 1220,
        "wires": [
            [
                "9ac7d8bf.354318"
            ]
        ]
    },
    {
        "id": "9ac7d8bf.354318",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "brightness",
        "func": "msg.payload = {\"brightness\": msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 570,
        "y": 1220,
        "wires": [
            [
                "3915a3f2.641aac"
            ]
        ]
    },
    {
        "id": "bcc690db.8cb87",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "state",
        "func": "msg.payload = {\"state\": msg.payload.state};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 1100,
        "wires": [
            [
                "8e0a2075.97183"
            ]
        ]
    },
    {
        "id": "b07f212d.4c75a",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "brightness",
        "func": "msg.payload = msg.payload.brightness;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 250,
        "y": 1180,
        "wires": [
            [
                "4ba59f70.c989c"
            ]
        ]
    },
    {
        "id": "c018a260.a19a4",
        "type": "switch",
        "z": "37daec28.284ee4",
        "name": "state ON",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 220,
        "wires": [
            [
                "4d73c0b1.422e1"
            ]
        ]
    },
    {
        "id": "5bd1bdfd.b90a34",
        "type": "switch",
        "z": "37daec28.284ee4",
        "name": "state ON",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 180,
        "wires": [
            [
                "79fb43e2.dda08c"
            ]
        ]
    },
    {
        "id": "40e09b5.33b3964",
        "type": "mqtt out",
        "z": "37daec28.284ee4",
        "name": "Tiffany",
        "topic": "zigbee2mqtt/tiffany/set",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 230,
        "y": 760,
        "wires": []
    },
    {
        "id": "792c807c.de0c7",
        "type": "mqtt in",
        "z": "37daec28.284ee4",
        "name": "Tiffany",
        "topic": "zigbee2mqtt/tiffany",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 410,
        "y": 760,
        "wires": [
            [
                "61308a38.c34a64"
            ]
        ]
    },
    {
        "id": "61308a38.c34a64",
        "type": "json",
        "z": "37daec28.284ee4",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 570,
        "y": 760,
        "wires": [
            [
                "52aea2ca.07744c",
                "7e4ae382.f3381c",
                "9762023d.37de7"
            ]
        ]
    },
    {
        "id": "52aea2ca.07744c",
        "type": "change",
        "z": "37daec28.284ee4",
        "name": "save tiffany state",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "payload.state = 'ON' ? 'on' : 'off'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "payload.brightness",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "tiffany",
                "pt": "flow",
                "to": "{'state': state, 'brightness': brightness}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 800,
        "wires": [
            [
                "35891aa8.d828c6"
            ]
        ]
    },
    {
        "id": "35891aa8.d828c6",
        "type": "debug",
        "z": "37daec28.284ee4",
        "name": "Tiffany",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 840,
        "wires": []
    },
    {
        "id": "30c5bc34.3c3974",
        "type": "ui_switch",
        "z": "37daec28.284ee4",
        "name": "An/Aus Tiffany",
        "label": "An/Aus",
        "tooltip": "",
        "group": "1b9713a7.a3a26c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "{\"state\": \"ON\"}",
        "onvalueType": "json",
        "onicon": "",
        "oncolor": "",
        "offvalue": "{\"state\": \"OFF\"}",
        "offvalueType": "json",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "x": 260,
        "y": 860,
        "wires": [
            [
                "35891aa8.d828c6",
                "40e09b5.33b3964"
            ]
        ]
    },
    {
        "id": "483d789b.9b7bd8",
        "type": "ui_slider",
        "z": "37daec28.284ee4",
        "name": "Helligkeit Tiffany",
        "label": "Helligkeit",
        "tooltip": "",
        "group": "1b9713a7.a3a26c",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "all",
        "topic": "",
        "topicType": "str",
        "min": "20",
        "max": "254",
        "step": "25",
        "x": 260,
        "y": 940,
        "wires": [
            [
                "f74f051f.78aca8"
            ]
        ]
    },
    {
        "id": "f74f051f.78aca8",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "brightness",
        "func": "msg.payload = {\"brightness\": msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 570,
        "y": 940,
        "wires": [
            [
                "40e09b5.33b3964"
            ]
        ]
    },
    {
        "id": "7e4ae382.f3381c",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "state",
        "func": "msg.payload = {\"state\": msg.payload.state};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 820,
        "wires": [
            [
                "30c5bc34.3c3974"
            ]
        ]
    },
    {
        "id": "9762023d.37de7",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "brightness",
        "func": "msg.payload = msg.payload.brightness;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 250,
        "y": 900,
        "wires": [
            [
                "483d789b.9b7bd8"
            ]
        ]
    },
    {
        "id": "82751974.3c5238",
        "type": "mqtt out",
        "z": "37daec28.284ee4",
        "name": "Leuchter",
        "topic": "zigbee2mqtt/leuchter/set",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 240,
        "y": 1580,
        "wires": []
    },
    {
        "id": "87c6eea5.de14c",
        "type": "mqtt in",
        "z": "37daec28.284ee4",
        "name": "Leuchter",
        "topic": "zigbee2mqtt/leuchter",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 420,
        "y": 1580,
        "wires": [
            [
                "9b0a2d3d.d8a5f"
            ]
        ]
    },
    {
        "id": "9b0a2d3d.d8a5f",
        "type": "json",
        "z": "37daec28.284ee4",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 570,
        "y": 1580,
        "wires": [
            [
                "7411287e.b145a8",
                "d2d0266a.cd3ee8",
                "11d236e2.b42379"
            ]
        ]
    },
    {
        "id": "7411287e.b145a8",
        "type": "change",
        "z": "37daec28.284ee4",
        "name": "save leuchter state",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "payload.state = 'ON' ? 'on' : 'off'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "payload.brightness",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "leuchter",
                "pt": "flow",
                "to": "{'state': state, 'brightness': brightness}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 1620,
        "wires": [
            [
                "b46d4ee5.72901"
            ]
        ]
    },
    {
        "id": "b46d4ee5.72901",
        "type": "debug",
        "z": "37daec28.284ee4",
        "name": "Fensterbank",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 1660,
        "wires": []
    },
    {
        "id": "9aca83f0.327cd",
        "type": "ui_switch",
        "z": "37daec28.284ee4",
        "name": "An/Aus Leuchter Fernsehzimmer",
        "label": "An/Aus",
        "tooltip": "",
        "group": "b4675dbc.146e1",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "{\"state\": \"ON\"}",
        "onvalueType": "json",
        "onicon": "",
        "oncolor": "",
        "offvalue": "{\"state\": \"OFF\"}",
        "offvalueType": "json",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "x": 320,
        "y": 1680,
        "wires": [
            [
                "b46d4ee5.72901",
                "82751974.3c5238"
            ]
        ]
    },
    {
        "id": "546088f6.3a4488",
        "type": "ui_slider",
        "z": "37daec28.284ee4",
        "name": "Helligkeit Leuchter Fernsehzimmer",
        "label": "Helligkeit",
        "tooltip": "",
        "group": "b4675dbc.146e1",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "all",
        "topic": "",
        "topicType": "str",
        "min": "20",
        "max": "254",
        "step": "25",
        "x": 320,
        "y": 1760,
        "wires": [
            [
                "b3e0dafa.e18c68"
            ]
        ]
    },
    {
        "id": "b3e0dafa.e18c68",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "brightness",
        "func": "msg.payload = {\"brightness\": msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 570,
        "y": 1760,
        "wires": [
            [
                "82751974.3c5238"
            ]
        ]
    },
    {
        "id": "d2d0266a.cd3ee8",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "state",
        "func": "msg.payload = {\"state\": msg.payload.state};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 1640,
        "wires": [
            [
                "9aca83f0.327cd"
            ]
        ]
    },
    {
        "id": "11d236e2.b42379",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "brightness",
        "func": "msg.payload = msg.payload.brightness;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 250,
        "y": 1720,
        "wires": [
            [
                "546088f6.3a4488"
            ]
        ]
    },
    {
        "id": "83a9e308596bab08",
        "type": "link out",
        "z": "37daec28.284ee4",
        "name": "reset",
        "mode": "link",
        "links": [
            "764add5bf2b847c1",
            "c6ba0a745f4a0cac"
        ],
        "x": 495,
        "y": 120,
        "wires": []
    },
    {
        "id": "6b9f314660665039",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "initialize Scenes",
        "func": "flow.set(\"current_scene_idx\", 0)\nflow.set(\"max_scene_idx\", 4)\nflow.set(\"scenes\", [\n        {   scene_idx: 0,\n            scene_name: \"aus\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tiffany\",\n                    state: \"off\"\n                },\n                {   device_idx: 2,\n                    name: \"Fensterbank\",\n                    state: \"off\"\n                },\n                {   device_idx: 3,\n                    name: \"Klavierlampe\",\n                    state: \"off\"\n                },\n                {   device_idx: 4,\n                    name: \"Leuchter\",\n                    state: \"off\"\n                }\n            ]\n        },\n        {   scene_idx: 1,\n            scene_name: \"ambiente\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tiffany\",\n                    brightness: 70,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Fensterbank\",\n                    brightness: 70,\n                    state: \"on\"\n                },\n                {   device_idx: 3,\n                    name: \"Klavierlampe\",\n                    state: \"on\"\n                },\n                {   device_idx: 4,\n                    name: \"Leuchter\",\n                    state: \"off\"\n                }\n            ]\n        },\n          {   scene_idx: 2,\n            scene_name: \"cosy\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tiffany\",\n                    brightness: 150,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Fensterbank\",\n                    brightness: 150,\n                    state: \"on\"\n                },\n                {   device_idx: 3,\n                    name: \"Klavierlampe\",\n                    state: \"on\"\n                },\n                {   device_idx: 4,\n                    name: \"Leuchter\",\n                    state: \"off\"\n                }\n            ]\n        },\n        {   scene_idx: 3,\n            scene_name: \"sofa_read\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tiffany\",\n                    brightness: 100,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Fensterbank\",\n                    brightness: 255,\n                    state: \"on\"\n                },\n                {   device_idx: 3,\n                    name: \"Klavierlampe\",\n                    state: \"on\"\n                },\n                {   device_idx: 4,\n                    name: \"Leuchter\",\n                    state: \"off\"\n                }\n            ]\n        },\n      {   scene_idx: 4,\n            scene_name: \"bright\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tiffany\",\n                    brightness: 255,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Fensterbank\",\n                    brightness: 255,\n                    state: \"on\"\n                },\n                {   device_idx: 3,\n                    name: \"Klavierlampe\",\n                    state: \"on\"\n                },\n                {   device_idx: 4,\n                    name: \"Leuchter\",\n                    brightness: 255,\n                    state: \"on\"\n                }\n            ]\n        }\n    ]\n)\n\nreturn {payload: 0};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "b3e4bb8fe782821f",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "",
        "func": "delete msg.payload['name']\ndelete msg.payload['device_idx']\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 320,
        "wires": [
            [
                "3a3f3f29.1be49"
            ]
        ]
    },
    {
        "id": "ecde6efbce017cdd",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "",
        "func": "delete msg.payload['name']\ndelete msg.payload['device_idx']\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 360,
        "wires": [
            [
                "bd4f1b1d.c1d598"
            ]
        ]
    },
    {
        "id": "4ee3e653755d72db",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "",
        "func": "delete msg.payload['name']\ndelete msg.payload['device_idx']\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 400,
        "wires": [
            [
                "773f6fe1.26d11"
            ]
        ]
    },
    {
        "id": "72f5f0ed0262eb0f",
        "type": "function",
        "z": "37daec28.284ee4",
        "name": "",
        "func": "delete msg.payload['name']\ndelete msg.payload['device_idx']\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 440,
        "wires": [
            [
                "d0971035.fd6cc"
            ]
        ]
    },
    {
        "id": "dde36893.70da28",
        "type": "ui_button",
        "z": "37daec28.284ee4",
        "name": "",
        "group": "3f0994e3.62d76c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Gemütlich",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "2",
        "payloadType": "num",
        "topic": "",
        "x": 150,
        "y": 540,
        "wires": [
            [
                "7e2ee98fa66a02ae"
            ]
        ]
    },
    {
        "id": "af71545a.27def8",
        "type": "ui_button",
        "z": "37daec28.284ee4",
        "name": "",
        "group": "3f0994e3.62d76c",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Sofa Lesen",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "3",
        "payloadType": "num",
        "topic": "",
        "x": 150,
        "y": 580,
        "wires": [
            [
                "7e2ee98fa66a02ae"
            ]
        ]
    },
    {
        "id": "2653a92.9545856",
        "type": "ui_button",
        "z": "37daec28.284ee4",
        "name": "",
        "group": "3f0994e3.62d76c",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Hell",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "4",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 130,
        "y": 620,
        "wires": [
            [
                "7e2ee98fa66a02ae"
            ]
        ]
    },
    {
        "id": "e686622f.fbb93",
        "type": "ui_button",
        "z": "37daec28.284ee4",
        "name": "",
        "group": "3f0994e3.62d76c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Aus",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "0",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 130,
        "y": 460,
        "wires": [
            [
                "7e2ee98fa66a02ae"
            ]
        ]
    },
    {
        "id": "5455332d.7b9c3c",
        "type": "ui_button",
        "z": "37daec28.284ee4",
        "name": "",
        "group": "3f0994e3.62d76c",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Ambiente",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "1",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 140,
        "y": 500,
        "wires": [
            [
                "7e2ee98fa66a02ae"
            ]
        ]
    },
    {
        "id": "7e2ee98fa66a02ae",
        "type": "link out",
        "z": "37daec28.284ee4",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "c6ba0a745f4a0cac"
        ],
        "x": 345,
        "y": 540,
        "wires": []
    },
    {
        "id": "c6ba0a745f4a0cac",
        "type": "link in",
        "z": "37daec28.284ee4",
        "name": "link in 1",
        "links": [
            "7e2ee98fa66a02ae",
            "83a9e308596bab08"
        ],
        "x": 95,
        "y": 300,
        "wires": [
            [
                "ed1e9ea1.c5e59"
            ]
        ]
    },
    {
        "id": "3fb99550d3adcdae",
        "type": "flogger",
        "z": "37daec28.284ee4",
        "name": "wozi",
        "logfile": "wozi",
        "inputchoice": "fullmsg",
        "inputobject": "payload",
        "inputobjectType": "msg",
        "inputmoustache": "Recieved payload {{payload}} and topic {{topic}}",
        "loglevel": "INFO",
        "logconfig": "8929498a4f6d4a2d",
        "sendpane": "",
        "x": 710,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "13b7ccd6.d98e83",
        "type": "mqtt out",
        "z": "2ba29887.9266e8",
        "name": "Esszimmertisch",
        "topic": "zigbee2mqtt/esszimmertisch/set",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1140,
        "y": 640,
        "wires": []
    },
    {
        "id": "de92566e.0d9718",
        "type": "mqtt in",
        "z": "2ba29887.9266e8",
        "name": "Esszimmertisch",
        "topic": "zigbee2mqtt/esszimmertisch",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 1320,
        "y": 640,
        "wires": [
            [
                "c4938613.a86088"
            ]
        ]
    },
    {
        "id": "c4938613.a86088",
        "type": "json",
        "z": "2ba29887.9266e8",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 950,
        "y": 780,
        "wires": [
            [
                "6d9790ef.bf03b",
                "af26ea70.e86bc8",
                "4db81f06.f5ed8",
                "811e8564.045d88"
            ]
        ]
    },
    {
        "id": "6d9790ef.bf03b",
        "type": "change",
        "z": "2ba29887.9266e8",
        "name": "save Esszimmertisch state",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "payload.state = 'ON' ? 'on' : 'off'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "payload.brightness",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "esszimmertisch",
                "pt": "flow",
                "to": "{'state': state, 'brightness': brightness}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "e2cb5e97.bb6e8",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "increment esszimmertisch brightness",
        "func": "var leuchter = flow.get(\"esszimmertisch\")\n\nleuchter[\"brightness\"] += 5;\nif (leuchter[\"brightness\"] > 100) {\n    leuchter[\"brightness\"] = 100;\n}\n\nflow.set(\"esszimmertisch\", leuchter);\n\nmsg.payload = {\"brightness\": leuchter[\"brightness\"]};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 620,
        "wires": [
            [
                "13b7ccd6.d98e83"
            ]
        ]
    },
    {
        "id": "f0e908ff.7a1918",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "decrement esszimmertisch brightness",
        "func": "var leuchter = flow.get(\"esszimmertisch\")\n\nleuchter[\"brightness\"] -= 5;\nif (leuchter[\"brightness\"] < 10) {\n    leuchter[\"brightness\"] = 20;\n}\nflow.set(\"esszimmertisch\", leuchter);\n\nmsg.payload = {\"brightness\": leuchter[\"brightness\"]};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 660,
        "wires": [
            [
                "13b7ccd6.d98e83"
            ]
        ]
    },
    {
        "id": "4db81f06.f5ed8",
        "type": "mqtt out",
        "z": "2ba29887.9266e8",
        "name": "Esszimmer Eckschrank",
        "topic": "zigbee2mqtt/esszimmer_eckschrank/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1170,
        "y": 980,
        "wires": []
    },
    {
        "id": "5b18f2d2.31ab8c",
        "type": "mqtt in",
        "z": "2ba29887.9266e8",
        "name": "Esszimmer Eckschrank",
        "topic": "zigbee2mqtt/esszimmer_eckschrank",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 1400,
        "y": 980,
        "wires": [
            [
                "2aacd971.071d76"
            ]
        ]
    },
    {
        "id": "2aacd971.071d76",
        "type": "json",
        "z": "2ba29887.9266e8",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 970,
        "y": 1060,
        "wires": [
            [
                "ca4c1378.25b3f",
                "ddf229af.5ef508"
            ]
        ]
    },
    {
        "id": "ca4c1378.25b3f",
        "type": "change",
        "z": "2ba29887.9266e8",
        "name": "save Esszimmer Eckschrank state",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "payload.state = 'ON' ? 'on' : 'off'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "payload.brightness",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "Esszimmer_eckschrank",
                "pt": "flow",
                "to": "{'state': state, 'brightness': brightness}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "ddf229af.5ef508",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "state",
        "func": "msg.payload = {\"state\": msg.payload.state};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1150,
        "y": 1060,
        "wires": [
            [
                "cc2ba7a4.276d78"
            ]
        ]
    },
    {
        "id": "cc2ba7a4.276d78",
        "type": "ui_switch",
        "z": "2ba29887.9266e8",
        "name": "An/Aus Esszimmer Eckschrank",
        "label": "An/Aus",
        "tooltip": "",
        "group": "643154e.6b44bac",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "",
        "style": "",
        "onvalue": "{\"state\": \"ON\"}",
        "onvalueType": "json",
        "onicon": "",
        "oncolor": "",
        "offvalue": "{\"state\": \"OFF\"}",
        "offvalueType": "json",
        "officon": "",
        "offcolor": "",
        "x": 1230,
        "y": 1100,
        "wires": [
            [
                "4db81f06.f5ed8"
            ]
        ]
    },
    {
        "id": "af26ea70.e86bc8",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "state",
        "func": "msg.payload = {\"state\": msg.payload.state};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 740,
        "wires": [
            [
                "efbb8637.d28188"
            ]
        ]
    },
    {
        "id": "efbb8637.d28188",
        "type": "ui_switch",
        "z": "2ba29887.9266e8",
        "name": "An/Aus Esszimmer Tisch",
        "label": "An/Aus",
        "tooltip": "",
        "group": "12ecf9a1.9cb126",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "",
        "style": "",
        "onvalue": "{\"state\": \"ON\"}",
        "onvalueType": "json",
        "onicon": "",
        "oncolor": "",
        "offvalue": "{\"state\": \"OFF\"}",
        "offvalueType": "json",
        "officon": "",
        "offcolor": "",
        "x": 1210,
        "y": 780,
        "wires": [
            [
                "13b7ccd6.d98e83"
            ]
        ]
    },
    {
        "id": "811e8564.045d88",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "brightness",
        "func": "msg.payload = msg.payload.brightness;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 820,
        "wires": [
            [
                "b95edb0e.4e93d8"
            ]
        ]
    },
    {
        "id": "b95edb0e.4e93d8",
        "type": "ui_slider",
        "z": "2ba29887.9266e8",
        "name": "Helligkeit Esszimmer Tisch Fernsehzimmer",
        "label": "Helligkeit",
        "tooltip": "",
        "group": "12ecf9a1.9cb126",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "all",
        "topic": "",
        "topicType": "str",
        "min": "10",
        "max": "100",
        "step": "5",
        "className": "",
        "x": 1270,
        "y": 860,
        "wires": [
            [
                "6f2d06af.6b5c88"
            ]
        ]
    },
    {
        "id": "6f2d06af.6b5c88",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "brightness",
        "func": "msg.payload = {\"brightness\": msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 860,
        "wires": [
            [
                "13b7ccd6.d98e83"
            ]
        ]
    },
    {
        "id": "53bad8f.3633628",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "initialize scenes",
        "func": "flow.set(\"current_scene_idx\", 0)\nflow.set(\"max_scene_idx\", 4)\nflow.set(\"scenes\", [\n        {   scene_idx: 0,\n            scene_name: \"aus\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tisch\",\n                    state: \"off\"\n                },\n                {   device_idx: 2,\n                    name: \"Eckschrank\",\n                    state: \"off\"\n                }\n            ]\n        },\n        {   scene_idx: 1,\n            scene_name: \"Ambiente\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tisch\",\n                    brightness: 20,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Eckschrank\",\n                    state: \"on\"\n                }\n            ]\n        },\n        {   scene_idx: 2,\n            scene_name: \"Gemütlich\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tisch\",\n                    brightness: 50,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Eckschrank\",\n                    state: \"on\"\n                }\n            ]\n        },\n        {   scene_idx: 3,\n            scene_name: \"Normal\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tisch\",\n                    brightness: 80,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Eckschrank\",\n                    state: \"on\"\n                }\n            ]\n        },\n        {   scene_idx: 4,\n            scene_name: \"Hell\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tisch\",\n                    brightness: 100,\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Eckschrank\",\n                    state: \"on\"\n                }\n            ]\n        },\n        {   scene_idx: 5,\n            scene_name: \"an/aus\",\n            devices: [\n                {   device_idx: 1,\n                    name: \"Tisch\",\n                    state: \"on\"\n                },\n                {   device_idx: 2,\n                    name: \"Eckschrank\",\n                    state: \"on\"\n                }\n            ]\n        }\n    ]\n)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "8e92a889.216c18",
        "type": "switch",
        "z": "2ba29887.9266e8",
        "name": "",
        "property": "payload.device_idx",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1050,
        "y": 400,
        "wires": [
            [],
            [
                "268380fb30a88909"
            ],
            [
                "405b916573c753a5"
            ]
        ]
    },
    {
        "id": "734500d1.9d61f",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "save scene idx",
        "func": "msg.payload = Number(msg.payload)\nflow.set(\"current_scene_idx\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 320,
        "wires": [
            [
                "19f37cfd.d46353"
            ]
        ]
    },
    {
        "id": "19f37cfd.d46353",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "current scene",
        "func": "var scenes = flow.get(\"scenes\");\nvar current_scene_idx = flow.get(\"current_scene_idx\");\nvar scene = scenes[current_scene_idx];\nmsg.payload = scene.devices;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 860,
        "y": 360,
        "wires": [
            [
                "f47853f2.a021d"
            ]
        ]
    },
    {
        "id": "f47853f2.a021d",
        "type": "split",
        "z": "2ba29887.9266e8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 830,
        "y": 400,
        "wires": [
            [
                "8e92a889.216c18"
            ]
        ]
    },
    {
        "id": "cd344841.b0ef18",
        "type": "link out",
        "z": "2ba29887.9266e8",
        "name": "",
        "links": [
            "91766e4a.6c0a7"
        ],
        "x": 1305,
        "y": 400,
        "wires": []
    },
    {
        "id": "abb09b26.4d8768",
        "type": "link out",
        "z": "2ba29887.9266e8",
        "name": "",
        "links": [
            "b42c6c0f.4b835"
        ],
        "x": 1305,
        "y": 440,
        "wires": []
    },
    {
        "id": "731caccd.2f8924",
        "type": "inject",
        "z": "2ba29887.9266e8",
        "name": "Reset",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "53bad8f.3633628"
            ]
        ]
    },
    {
        "id": "2202e11f.f782ee",
        "type": "ui_button",
        "z": "2ba29887.9266e8",
        "name": "",
        "group": "aca2d944.6c15c8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Hell",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "4",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 110,
        "y": 320,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "f5b99d67.4869b",
        "type": "ui_button",
        "z": "2ba29887.9266e8",
        "name": "",
        "group": "aca2d944.6c15c8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Gemütlich",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "2",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 130,
        "y": 240,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "747c9148.1a912",
        "type": "ui_button",
        "z": "2ba29887.9266e8",
        "name": "",
        "group": "aca2d944.6c15c8",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Ambiente",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "1",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 120,
        "y": 200,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "a0a37e43.2bc1b",
        "type": "ui_button",
        "z": "2ba29887.9266e8",
        "name": "",
        "group": "aca2d944.6c15c8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Aus",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "0",
        "payloadType": "num",
        "topic": "",
        "x": 110,
        "y": 160,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "b42c6c0f.4b835",
        "type": "link in",
        "z": "2ba29887.9266e8",
        "name": "Eckschrank",
        "links": [
            "abb09b26.4d8768"
        ],
        "x": 975,
        "y": 980,
        "wires": [
            [
                "4db81f06.f5ed8"
            ]
        ]
    },
    {
        "id": "91766e4a.6c0a7",
        "type": "link in",
        "z": "2ba29887.9266e8",
        "name": "Esszimmertisch",
        "links": [
            "cd344841.b0ef18"
        ],
        "x": 965,
        "y": 580,
        "wires": [
            [
                "13b7ccd6.d98e83"
            ]
        ]
    },
    {
        "id": "664aeec7.e753d",
        "type": "switch",
        "z": "2ba29887.9266e8",
        "name": "action",
        "property": "payload.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "toggle",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_up_click",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_up_hold",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_up_release",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_down_click",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_down_hold",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_down_release",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "arrow_right_click",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "arrow_right_hold",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "arrow_left_click",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "arrow_left_hold",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 11,
        "x": 330,
        "y": 540,
        "wires": [
            [
                "9e9ad2ab8e210ec0"
            ],
            [
                "e2cb5e97.bb6e8"
            ],
            [
                "f832ecc933544019"
            ],
            [
                "e3c094e257957c0c"
            ],
            [
                "f0e908ff.7a1918"
            ],
            [
                "f54c6757aecd865b"
            ],
            [
                "e3c094e257957c0c"
            ],
            [
                "49199ea5.7436c"
            ],
            [],
            [
                "f4dedcc1.6edff"
            ],
            []
        ]
    },
    {
        "id": "b878ef06.91fa7",
        "type": "json",
        "z": "2ba29887.9266e8",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 190,
        "y": 540,
        "wires": [
            [
                "664aeec7.e753d"
            ]
        ]
    },
    {
        "id": "af3c9414.281838",
        "type": "mqtt in",
        "z": "2ba29887.9266e8",
        "name": "Fernbedienung WoZi",
        "topic": "zigbee2mqtt/fernbedienung_esszimmer",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 500,
        "wires": [
            [
                "b878ef06.91fa7"
            ]
        ]
    },
    {
        "id": "49199ea5.7436c",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "next scene",
        "func": "var current_scene_idx = flow.get(\"current_scene_idx\");\nvar max_scene_idx = flow.get(\"max_scene_idx\");\n\ncurrent_scene_idx++\nif (current_scene_idx > max_scene_idx) {\n    current_scene_idx = 0\n}\n\nmsg.payload = current_scene_idx;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 520,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "f4dedcc1.6edff",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "previous scene",
        "func": "var current_scene_idx = flow.get(\"current_scene_idx\");\nvar max_scene_idx = flow.get(\"max_scene_idx\");\n\ncurrent_scene_idx--\nif (current_scene_idx < 0 ) {\n    current_scene_idx = max_scene_idx\n}\n\nflow.set(\"current_scene_idx\", current_scene_idx);\n\nmsg.payload = current_scene_idx;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 560,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "f832ecc933544019",
        "type": "looptimer",
        "z": "2ba29887.9266e8",
        "duration": "0.25",
        "units": "Second",
        "maxloops": "20",
        "maxtimeout": "10",
        "maxtimeoutunits": "Second",
        "name": "Dim",
        "x": 590,
        "y": 640,
        "wires": [
            [
                "e2cb5e97.bb6e8"
            ],
            []
        ]
    },
    {
        "id": "f54c6757aecd865b",
        "type": "looptimer",
        "z": "2ba29887.9266e8",
        "duration": "0.25",
        "units": "Second",
        "maxloops": "20",
        "maxtimeout": "10",
        "maxtimeoutunits": "Second",
        "name": "Dim",
        "x": 590,
        "y": 680,
        "wires": [
            [
                "f0e908ff.7a1918"
            ],
            []
        ]
    },
    {
        "id": "e3c094e257957c0c",
        "type": "template",
        "z": "2ba29887.9266e8",
        "name": "STOP",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "STOP",
        "output": "str",
        "x": 450,
        "y": 660,
        "wires": [
            [
                "f832ecc933544019",
                "f54c6757aecd865b"
            ]
        ]
    },
    {
        "id": "9e9ad2ab8e210ec0",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "toggle szene",
        "func": "const new_scene_idx = 5;\nvar current_scene_idx = flow.get(\"current_scene_idx\");\n\nif (current_scene_idx == 0) {\n    current_scene_idx = new_scene_idx\n} else {\n    current_scene_idx = 0\n}\n\nmsg.payload = current_scene_idx;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 480,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "268380fb30a88909",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "",
        "func": "delete msg.payload['name']\ndelete msg.payload['device_idx']\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 400,
        "wires": [
            [
                "cd344841.b0ef18"
            ]
        ]
    },
    {
        "id": "405b916573c753a5",
        "type": "function",
        "z": "2ba29887.9266e8",
        "name": "",
        "func": "delete msg.payload['name']\ndelete msg.payload['device_idx']\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 440,
        "wires": [
            [
                "abb09b26.4d8768"
            ]
        ]
    },
    {
        "id": "c1d8b22f783add57",
        "type": "ui_button",
        "z": "2ba29887.9266e8",
        "name": "",
        "group": "aca2d944.6c15c8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Normal",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "3",
        "payloadType": "num",
        "topic": "",
        "topicType": "str",
        "x": 120,
        "y": 280,
        "wires": [
            [
                "734500d1.9d61f"
            ]
        ]
    },
    {
        "id": "b529a82a.481848",
        "type": "mqtt out",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-gaeste-wc/switch/relay1/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1350,
        "y": 360,
        "wires": []
    },
    {
        "id": "e3b87d0f.108a9",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-gaeste-wc/binary_sensor/button1/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 270,
        "y": 180,
        "wires": [
            [
                "dba6f56.3127408",
                "228e3903f8b991b2"
            ]
        ]
    },
    {
        "id": "c07473f0.eb252",
        "type": "ui_switch",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus  (2 min)",
        "label": "Treppenhaus  (2 min)",
        "tooltip": "",
        "group": "64b01bd0.e1d1b4",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "treppenhaus",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 820,
        "y": 360,
        "wires": [
            [
                "553fc166.0b31c",
                "37836f89.8422b",
                "c9724047.56def"
            ]
        ]
    },
    {
        "id": "153c328e.15de1d",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "Bewegungsmelder Treppenhaus Keller",
        "topic": "zigbee2mqtt/bewegungsmelder_treppenhaus_keller",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 230,
        "y": 580,
        "wires": [
            [
                "38bf3abf.87fe76"
            ]
        ]
    },
    {
        "id": "c473a018.46907",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "map occupancy to ON",
        "func": "if (msg.payload[\"occupancy\"])\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 320,
        "wires": [
            [
                "36a19851.367748"
            ]
        ]
    },
    {
        "id": "dba6f56.3127408",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "toggle state",
        "func": "if (msg.payload != \"ON\") { \n    return undefined;\n}\n\nvar topic = \"treppenhaustaster\";\nvar current_state = flow.get(topic);\n\nif (current_state === \"OFF\")\n    return {payload: \"ON\"}\nelse\n    return {payload: \"OFF\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 180,
        "wires": [
            [
                "50e80d17.fa58d4",
                "c07473f0.eb252"
            ]
        ]
    },
    {
        "id": "4907d5.d804982c",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 980,
        "y": 618,
        "wires": [
            [
                "1bf72870.060278"
            ]
        ]
    },
    {
        "id": "553fc166.0b31c",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "save state",
        "func": "flow.set(\"treppenhaustaster\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1050,
        "y": 360,
        "wires": [
            [
                "b529a82a.481848"
            ]
        ]
    },
    {
        "id": "1c86fb0b.6322c5",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "Bewegungsmelder Treppenhaus DG",
        "topic": "zigbee2mqtt/bewegungsmelder_treppenhaus_dg",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 220,
        "y": 300,
        "wires": [
            [
                "c473a018.46907"
            ]
        ]
    },
    {
        "id": "c8229850.b97058",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "Bewegungsmelder Treppenhaus EG",
        "topic": "zigbee2mqtt/bewegungsmelder_treppenhaus_eg",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 220,
        "y": 340,
        "wires": [
            [
                "c473a018.46907"
            ]
        ]
    },
    {
        "id": "cf66c5f7.71d4e8",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "d": true,
        "name": "Bewegungsmelder Treppenhaus OG",
        "topic": "zigbee2mqtt/bewegungsmelder_treppenhaus_og",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 220,
        "y": 380,
        "wires": [
            [
                "c473a018.46907"
            ]
        ]
    },
    {
        "id": "bb3b7629.ab9698",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-eg/binary_sensor/taster/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 240,
        "y": 998,
        "wires": [
            [
                "b26ffbed.c2c898"
            ]
        ]
    },
    {
        "id": "b187a14.548406",
        "type": "mqtt out",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-keller/switch/relay1/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1310,
        "y": 738,
        "wires": []
    },
    {
        "id": "3eb024a5.e9f9bc",
        "type": "ui_switch",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Keller (1 min)",
        "label": "Treppenhaus Keller (2 min)",
        "tooltip": "",
        "group": "64b01bd0.e1d1b4",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "treppenhaus_keller",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 740,
        "y": 678,
        "wires": [
            [
                "4907d5.d804982c",
                "95460152.3f519"
            ]
        ]
    },
    {
        "id": "38bf3abf.87fe76",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "map occupancy to ON",
        "func": "if (msg.payload[\"occupancy\"])\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 620,
        "wires": [
            [
                "d7f061.1e304fa",
                "e18902b0a943f1fe"
            ]
        ]
    },
    {
        "id": "1bf72870.060278",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 1 min",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1240,
        "y": 618,
        "wires": [
            [
                "3eb024a5.e9f9bc"
            ]
        ]
    },
    {
        "id": "33e8db68.d3a814",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-keller/binary_sensor/button1/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 260,
        "y": 1038,
        "wires": [
            [
                "b26ffbed.c2c898"
            ]
        ]
    },
    {
        "id": "50e80d17.fa58d4",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter OFF",
        "func": "if (msg.payload != \"ON\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 180,
        "wires": [
            [
                "7c5fc140.d9c58",
                "b70e105a77f51cd4"
            ]
        ]
    },
    {
        "id": "7c5fc140.d9c58",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 2 min",
        "op1": "DISABLE",
        "op2": "ENABLE",
        "op1type": "str",
        "op2type": "str",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 980,
        "y": 180,
        "wires": [
            [
                "4a9f1a2e29bec69c"
            ]
        ]
    },
    {
        "id": "36a19851.367748",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "Latch1",
        "func": "const latch = flow.get('treppenhaus_latch1');\n\nif (latch != \"DISABLE\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 360,
        "wires": [
            [
                "8a7888b.8497878"
            ]
        ]
    },
    {
        "id": "829da71c.1e4898",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter OFF",
        "func": "if (msg.payload != \"ON\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 758,
        "wires": [
            [
                "24c102d9.3a5e4e"
            ]
        ]
    },
    {
        "id": "24c102d9.3a5e4e",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 2 min",
        "op1": "DISABLE",
        "op2": "ENABLE",
        "op1type": "str",
        "op2type": "str",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 800,
        "y": 758,
        "wires": [
            [
                "25276f9407468fec"
            ]
        ]
    },
    {
        "id": "d7f061.1e304fa",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "Latch2",
        "func": "const latch = flow.get('treppenhaus_latch2');\n\nif (latch != \"DISABLE\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 620,
        "wires": [
            [
                "c53f0279.79555"
            ]
        ]
    },
    {
        "id": "37836f89.8422b",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 400,
        "wires": [
            [
                "bb85ebf4.9e01a8"
            ]
        ]
    },
    {
        "id": "bb85ebf4.9e01a8",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 2min",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1280,
        "y": 400,
        "wires": [
            [
                "c07473f0.eb252"
            ]
        ]
    },
    {
        "id": "5147c0eb.b5ca3",
        "type": "change",
        "z": "3a471104.edfbae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "reset",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 440,
        "wires": [
            [
                "bb85ebf4.9e01a8"
            ]
        ]
    },
    {
        "id": "c9724047.56def",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter OFF",
        "func": "if (msg.payload === \"OFF\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1040,
        "y": 440,
        "wires": [
            [
                "5147c0eb.b5ca3"
            ]
        ]
    },
    {
        "id": "95460152.3f519",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "store in flow",
        "func": "const topic = \"treppenhaus_kellerlicht\";\nconst last_state = flow.get(topic);\n\nif (last_state === \"ON\")\n    if (msg.payload === \"ON\") {\n        flow.set(topic + \"-exor\", true);\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, {payload: \"OFF\"}]\n    } else {\n        if (flow.get(topic + \"-exor\")) {\n            flow.set(topic + \"-exor\", false);\n            return;\n        }\n        flow.set(topic, msg.payload);\n        return [{payload: \"OFF\"}, {reset: \"RESET\"}, undefined];\n    }\nelse {\n    if (msg.payload === \"ON\") {\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, undefined];\n    }\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 678,
        "wires": [
            [
                "b187a14.548406"
            ],
            [
                "1bf72870.060278",
                "ca630234.003a1"
            ],
            [
                "ef88d6e2.56a248"
            ]
        ]
    },
    {
        "id": "b26ffbed.c2c898",
        "type": "button-events",
        "z": "3a471104.edfbae",
        "name": "",
        "outputs": 2,
        "inputField": "payload",
        "inputFieldType": "msg",
        "outputField": "payload",
        "outputFieldType": "msg",
        "downValue": "ON",
        "downValueType": "str",
        "upValue": "OFF",
        "upValueType": "str",
        "idleValue": "1",
        "buttonEventsConfig": "154f06d5432267e7",
        "clickedInterval": null,
        "pressedInterval": null,
        "debounceInterval": null,
        "events": [
            {
                "type": "clicked"
            },
            {
                "type": "pressed"
            }
        ],
        "x": 600,
        "y": 1018,
        "wires": [
            [
                "e5b77373cf1730fb"
            ],
            [
                "166368aac079833e"
            ]
        ]
    },
    {
        "id": "ad25b69b.70f848",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "store in flow",
        "func": "const topic = \"treppenhaus_kellerlicht\";\nconst last_state = flow.get(topic);\n\nif (last_state === \"ON\")\n    if (msg.payload === \"ON\") {\n        flow.set(topic + \"-exor\", true);\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, {payload: \"OFF\"}]\n    } else {\n        if (flow.get(topic + \"-exor\")) {\n            flow.set(topic + \"-exor\", false);\n            return;\n        }\n        flow.set(topic, msg.payload);\n        return [{payload: \"OFF\"}, {reset: \"RESET\"}, undefined];\n    }\nelse {\n    if (msg.payload === \"ON\") {\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, undefined];\n    }\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 970,
        "y": 838,
        "wires": [
            [
                "b187a14.548406"
            ],
            [
                "1bf72870.060278",
                "ca630234.003a1"
            ],
            [
                "3eb024a5.e9f9bc"
            ]
        ]
    },
    {
        "id": "c4c2eff3.b70f",
        "type": "link in",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Keller autom.",
        "links": [
            "86e17b7b.a2f5d8"
        ],
        "x": 455,
        "y": 678,
        "wires": [
            [
                "3eb024a5.e9f9bc",
                "829da71c.1e4898"
            ]
        ]
    },
    {
        "id": "86e17b7b.a2f5d8",
        "type": "link out",
        "z": "3a471104.edfbae",
        "name": "",
        "links": [
            "c4c2eff3.b70f",
            "aa508cc26dbab19a",
            "5d4fc47d69c0afb5",
            "01e739e468ac7641"
        ],
        "x": 1075,
        "y": 1000,
        "wires": []
    },
    {
        "id": "ef88d6e2.56a248",
        "type": "ui_switch",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Keller (1 h)",
        "label": "Treppenhaus Keller (1 h)",
        "tooltip": "",
        "group": "64b01bd0.e1d1b4",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "treppenhaus_keller",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 730,
        "y": 838,
        "wires": [
            [
                "ad25b69b.70f848",
                "3ebdc5c5.e2b66a"
            ]
        ]
    },
    {
        "id": "d28aedd4.51206",
        "type": "link out",
        "z": "3a471104.edfbae",
        "name": "",
        "links": [
            "2be218d9.cd0108",
            "a2fce519c5527456"
        ],
        "x": 1075,
        "y": 1040,
        "wires": []
    },
    {
        "id": "2be218d9.cd0108",
        "type": "link in",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Keller dauernd",
        "links": [
            "d28aedd4.51206"
        ],
        "x": 455,
        "y": 838,
        "wires": [
            [
                "ef88d6e2.56a248",
                "829da71c.1e4898"
            ]
        ]
    },
    {
        "id": "3ebdc5c5.e2b66a",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 980,
        "y": 898,
        "wires": [
            [
                "ca630234.003a1"
            ]
        ]
    },
    {
        "id": "ca630234.003a1",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 1 h",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "1",
        "extend": true,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1230,
        "y": 898,
        "wires": [
            [
                "ef88d6e2.56a248"
            ]
        ]
    },
    {
        "id": "8a7888b.8497878",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "dunkel",
        "func": "const umgebung = global.get('umgebungslicht');\n\nif (umgebung == \"dunkel\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 610,
        "y": 360,
        "wires": [
            [
                "c07473f0.eb252"
            ]
        ]
    },
    {
        "id": "c53f0279.79555",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "dunkel",
        "func": "const umgebung = global.get('umgebungslicht');\n\nif (umgebung == \"dunkel\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 810,
        "y": 620,
        "wires": [
            [
                "3eb024a5.e9f9bc"
            ]
        ]
    },
    {
        "id": "e2e13ddd.9151f",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "Bewegungsmelder Gäste-WC",
        "topic": "zigbee2mqtt/bewegungsmelder_gaeste_wc",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 200,
        "y": 260,
        "wires": [
            [
                "c473a018.46907"
            ]
        ]
    },
    {
        "id": "e18902b0a943f1fe",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 2 s",
        "op1": "DISABLE",
        "op2": "ENABLE",
        "op1type": "str",
        "op2type": "str",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 730,
        "y": 580,
        "wires": [
            [
                "8e3990f1558de9fb"
            ]
        ]
    },
    {
        "id": "8e3990f1558de9fb",
        "type": "change",
        "z": "3a471104.edfbae",
        "name": "Latch3",
        "rules": [
            {
                "t": "set",
                "p": "treppenhaus_latch3",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "e5b77373cf1730fb",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "Latch3",
        "func": "const latch = flow.get('treppenhaus_latch3');\n\nif (latch != \"DISABLE\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1000,
        "wires": [
            [
                "8a94d4bd.10b228"
            ]
        ]
    },
    {
        "id": "166368aac079833e",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "Latch3",
        "func": "const latch = flow.get('treppenhaus_latch3');\n\nif (latch != \"DISABLE\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1040,
        "wires": [
            [
                "d28aedd4.51206"
            ]
        ]
    },
    {
        "id": "4a9f1a2e29bec69c",
        "type": "change",
        "z": "3a471104.edfbae",
        "name": "Latch1",
        "rules": [
            {
                "t": "set",
                "p": "treppenhaus_latch1",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1190,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "25276f9407468fec",
        "type": "change",
        "z": "3a471104.edfbae",
        "name": "Latch2",
        "rules": [
            {
                "t": "set",
                "p": "treppenhaus_latch2",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "eccfd4fbd047082e",
        "type": "comment",
        "z": "3a471104.edfbae",
        "name": "",
        "info": "Schalte ich das Licht manuell aus, geht es nicht gleich wieder durch einen Bewegungsmerlder an.",
        "x": 920,
        "y": 140,
        "wires": []
    },
    {
        "id": "b85bf8cf47a30d55",
        "type": "comment",
        "z": "3a471104.edfbae",
        "name": "",
        "info": "Schalte der Bewegungsmelder das Licht ein und ich drücke praktisch gleichzeitig den Taster, schalte ich das Licht nicht unabsichtlich aus.",
        "x": 680,
        "y": 540,
        "wires": []
    },
    {
        "id": "4a4a0a337a679751",
        "type": "comment",
        "z": "3a471104.edfbae",
        "name": "",
        "info": "Kurz drücken: Licht an/aus; Treppenhausautomat 2 min.\nLang Drücken: Licht an; Treppenhaus automat 1 Stunde.",
        "x": 580,
        "y": 980,
        "wires": []
    },
    {
        "id": "dc323f21c8079cd6",
        "type": "mqtt in",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-gardrobe/binary_sensor/button2/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 270,
        "y": 1200,
        "wires": [
            [
                "de8d9af857835e7b"
            ]
        ]
    },
    {
        "id": "447669d06017102b",
        "type": "mqtt out",
        "z": "3a471104.edfbae",
        "name": "",
        "topic": "treppenhaus-gardrobe/switch/relay1/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 940,
        "y": 1160,
        "wires": []
    },
    {
        "id": "de8d9af857835e7b",
        "type": "button-events",
        "z": "3a471104.edfbae",
        "name": "",
        "outputs": 2,
        "inputField": "payload",
        "inputFieldType": "msg",
        "outputField": "payload",
        "outputFieldType": "msg",
        "downValue": "ON",
        "downValueType": "str",
        "upValue": "OFF",
        "upValueType": "str",
        "idleValue": "1",
        "clickedInterval": "200",
        "pressedInterval": "300",
        "debounceInterval": 30,
        "events": [
            {
                "type": "clicked"
            },
            {
                "type": "pressed"
            }
        ],
        "x": 420,
        "y": 1240,
        "wires": [
            [
                "b4daf9ad3a2af382"
            ],
            [
                "b4daf9ad3a2af382"
            ]
        ]
    },
    {
        "id": "b4daf9ad3a2af382",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "toggle state",
        "func": "if (msg.payload != \"clicked\" && msg.payload != \"pressed\") {\n    return undefined;\n}\n\nvar topic = \"treppenhaus_gardrobenlicht\";\nvar current_state = flow.get(topic);\n\nif (current_state === \"OFF\")\n    return {payload: \"ON\"}\nelse\n    return {payload: \"OFF\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1240,
        "wires": [
            [
                "3d54164a8aad07af"
            ]
        ]
    },
    {
        "id": "3d54164a8aad07af",
        "type": "ui_switch",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Gardrobe (2 min)",
        "label": "Treppenhaus Gardrobe (2 min)",
        "tooltip": "",
        "group": "64b01bd0.e1d1b4",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "treppenhaus_keller",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 850,
        "y": 1220,
        "wires": [
            [
                "81e18b30bcaf7bb9",
                "a5dc53d97b09619e",
                "c191f33a6502f671"
            ]
        ]
    },
    {
        "id": "81e18b30bcaf7bb9",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "save state",
        "func": "flow.set(\"treppenhaus_gardrobenlicht\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 1220,
        "wires": [
            [
                "447669d06017102b"
            ]
        ]
    },
    {
        "id": "8a94d4bd.10b228",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "toggle state",
        "func": "if (msg.payload != \"ON\") {\n    return undefined;\n}\n\nvar topic = \"treppenhaus_kellerlicht\";\nvar current_state = flow.get(topic);\n\nif (current_state === \"OFF\")\n    return {payload: \"ON\"}\nelse\n    return {payload: \"OFF\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 1000,
        "wires": [
            [
                "86e17b7b.a2f5d8"
            ]
        ]
    },
    {
        "id": "a5dc53d97b09619e",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 820,
        "y": 1260,
        "wires": [
            [
                "ed9df766a52f2c8c"
            ]
        ]
    },
    {
        "id": "ed9df766a52f2c8c",
        "type": "trigger",
        "z": "3a471104.edfbae",
        "name": "Treppenhausautomat 2min",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "2",
        "extend": false,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1060,
        "y": 1260,
        "wires": [
            [
                "3d54164a8aad07af"
            ]
        ]
    },
    {
        "id": "3cb225532788346d",
        "type": "change",
        "z": "3a471104.edfbae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "reset",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 1300,
        "wires": [
            [
                "ed9df766a52f2c8c"
            ]
        ]
    },
    {
        "id": "c191f33a6502f671",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter OFF",
        "func": "if (msg.payload === \"OFF\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 820,
        "y": 1300,
        "wires": [
            [
                "3cb225532788346d"
            ]
        ]
    },
    {
        "id": "42042fb5c5b6cd50",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter OFF",
        "func": "if (msg.payload === \"OFF\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 400,
        "wires": [
            [
                "c07473f0.eb252"
            ]
        ]
    },
    {
        "id": "5d4fc47d69c0afb5",
        "type": "link in",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Keller autom.",
        "links": [
            "86e17b7b.a2f5d8"
        ],
        "x": 485,
        "y": 400,
        "wires": [
            [
                "42042fb5c5b6cd50"
            ]
        ]
    },
    {
        "id": "01e739e468ac7641",
        "type": "link in",
        "z": "3a471104.edfbae",
        "name": "Treppenhaus Keller autom.",
        "links": [
            "86e17b7b.a2f5d8",
            "b70e105a77f51cd4"
        ],
        "x": 515,
        "y": 1200,
        "wires": [
            [
                "f266a2cb363f176a"
            ]
        ]
    },
    {
        "id": "b70e105a77f51cd4",
        "type": "link out",
        "z": "3a471104.edfbae",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "01e739e468ac7641"
        ],
        "x": 875,
        "y": 220,
        "wires": []
    },
    {
        "id": "f266a2cb363f176a",
        "type": "function",
        "z": "3a471104.edfbae",
        "name": "filter OFF",
        "func": "if (msg.payload === \"OFF\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 1200,
        "wires": [
            [
                "3d54164a8aad07af"
            ]
        ]
    },
    {
        "id": "228e3903f8b991b2",
        "type": "flogger",
        "z": "3a471104.edfbae",
        "name": "gaeste-wc",
        "logfile": "gaeste-wc",
        "inputchoice": "fullmsg",
        "inputobject": "payload",
        "inputobjectType": "msg",
        "inputmoustache": "Recieved payload {{payload}} and topic {{topic}}",
        "loglevel": "INFO",
        "logconfig": "8929498a4f6d4a2d",
        "sendpane": "",
        "x": 630,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "2f8c3777.ecafb8",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "topic": "waschkueche-luefter/sensor/humidity/state",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 230,
        "y": 160,
        "wires": [
            [
                "b56cd25f.124c9",
                "f24eda7c.102788"
            ]
        ]
    },
    {
        "id": "9c38a690.14f558",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "topic": "waschkueche-wama/sensor/power/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 220,
        "y": 760,
        "wires": [
            [
                "8fd7504b.225ed"
            ]
        ]
    },
    {
        "id": "15f3325a.1a8f0e",
        "type": "hangoutChatBot",
        "z": "4d90b497.b5b2ac",
        "hangoutsCertificate": "10925253.f46f4e",
        "roomid": "spaces/AAAAl9wJJ_0",
        "roomname": "spaces/AAAAl9wJJ_0",
        "contentproperty": "Waschmaschiene ist fertig!",
        "contenttype": "str",
        "x": 780,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "c4508389.32591",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "topic": "waschkueche-wama/sensor/temperature/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 240,
        "y": 900,
        "wires": [
            [
                "c7cd3c7f.93d75"
            ]
        ]
    },
    {
        "id": "7b089f13.f2142",
        "type": "hangoutChatBot",
        "z": "4d90b497.b5b2ac",
        "hangoutsCertificate": "10925253.f46f4e",
        "roomid": "spaces/-fp3jQAAAAE",
        "roomname": "spaces/-fp3jQAAAAE",
        "contentproperty": "Shelly WaMa ist überhitzt!",
        "contenttype": "str",
        "x": 780,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "8fd7504b.225ed",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "func": "var val = parseFloat(msg.payload);\nconst last_n = 30\n\nvar wama_power_last = flow.get(\"wama_power_last\") || [];\nvar wama_status = flow.get(\"wama_status\") || \"Aus\";\n\nwama_power_last.unshift(val);\nwama_power_last = wama_power_last.splice(0, last_n);\nflow.set(\"wama_power_last\", wama_power_last);\n\nconst avg_wama_power = wama_power_last.reduce(function (accumulator, currentValue) {\n  return accumulator + currentValue;\n}, 0) / last_n;\n\n\n// Result array:\n// 0 - Hangout\n// 1 - Status text\n// 2 - debug\nmsg = [undefined, {payload: wama_status}, {payload: avg_wama_power, topic: wama_status}];\nif (wama_status == \"läuft\") {\n    if (avg_wama_power < 4.0) {\n        flow.set(\"wama_status\", \"fertig\")\n        msg = [\n            {payload: \"fertig, \" + (new Date).toLocaleTimeString()},\n            {payload: \"fertig\"},\n            {payload: avg_wama_power, topic: wama_status}\n        ];\n    }\n} else if (wama_status == \"fertig\") {\n    if (avg_wama_power < 2.0) {\n        flow.set(\"wama_status\", \"aus\")\n        msg = [\n            undefined,\n            {payload: \"aus\"},\n            {payload: avg_wama_power, topic: wama_status}\n        ];\n    } else if (avg_wama_power >= 20.0) {\n        flow.set(\"wama_status\", \"läuft\")\n        msg = [\n            undefined,\n            {payload: \"läuft\"},\n            {payload: avg_wama_power, topic: wama_status}\n        ];\n    }\n} else { // status off\n    if (avg_wama_power >= 20.0) {\n        flow.set(\"wama_status\", \"läuft\")\n        msg = [\n            undefined,\n            {payload: \"läuft\"},\n            {payload: avg_wama_power, topic: wama_status}\n        ];\n    } else if (avg_wama_power >= 2.0) {\n        flow.set(\"wama_status\", \"fertig\")\n        msg = [\n            undefined,\n            {payload: \"fertig\"},\n            {payload: avg_wama_power, topic: wama_status}\n        ];\n    }\n}\n\nreturn msg;",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 760,
        "wires": [
            [
                "15f3325a.1a8f0e"
            ],
            [
                "fd3b965b.3e6fc8"
            ],
            [
                "9fbf87b9.5b6618"
            ]
        ]
    },
    {
        "id": "c7cd3c7f.93d75",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "func": "var val = parseFloat(msg.payload);\n\nvar text, status;\nif (val > 95) {\n    msg = [\n        {payload: \"Überhitzt\"},\n        {payload: \"OFF\"}\n    ];\n} else if (val < 55) {\n    msg = [\n        undefined,\n        {payload: \"ON\"}\n    ];\n} else {\n    msg = [\n        undefined,\n        undefined\n    ];\n}\n\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 900,
        "wires": [
            [
                "7b089f13.f2142"
            ],
            [
                "76339dfa.1244c4"
            ]
        ]
    },
    {
        "id": "76339dfa.1244c4",
        "type": "mqtt out",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "topic": "waschkueche-wama/switch/switch15/command",
        "qos": "",
        "retain": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 900,
        "y": 920,
        "wires": []
    },
    {
        "id": "fd3b965b.3e6fc8",
        "type": "ui_text",
        "z": "4d90b497.b5b2ac",
        "group": "7e092ea0.4f2d9",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Waschmaschine/Trockner",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 830,
        "y": 760,
        "wires": []
    },
    {
        "id": "9fbf87b9.5b6618",
        "type": "debug",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 800,
        "wires": []
    },
    {
        "id": "b56cd25f.124c9",
        "type": "ui_gauge",
        "z": "4d90b497.b5b2ac",
        "name": "Waschküche Luftfeuchtigkeit",
        "group": "7e092ea0.4f2d9",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Luftfeuchtigkeit",
        "label": "% rel.",
        "format": "{{value}}",
        "min": "20",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "35",
        "seg2": "65",
        "x": 620,
        "y": 200,
        "wires": []
    },
    {
        "id": "f24eda7c.102788",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "store global",
        "func": "var val = parseFloat(msg.payload);\nglobal.set(\"waschkueche_luefter-humidity\", val);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "e28bca49.e88d18",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "topic": "waschkueche-luefter/sensor/absolute_humidity/state",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 260,
        "y": 120,
        "wires": [
            [
                "47eed9bd.a41b08"
            ]
        ]
    },
    {
        "id": "47eed9bd.a41b08",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "store global",
        "func": "var val = parseFloat(msg.payload);\nglobal.set(\"waschkueche_luefter-absolute_humidity\", val);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "4990ce01.e26cf",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "store global",
        "func": "var val = parseFloat(msg.payload);\nglobal.set(\"waschkueche_luefter-temperature\", val);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "dd9b1b4b.d18598",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "topic": "waschkueche-luefter/sensor/temperature/state",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 240,
        "y": 80,
        "wires": [
            [
                "4990ce01.e26cf"
            ]
        ]
    },
    {
        "id": "74d29041.9a5c4",
        "type": "ui_switch",
        "z": "4d90b497.b5b2ac",
        "name": "Waschküche Lüfter",
        "label": "Lüfter",
        "tooltip": "",
        "group": "7e092ea0.4f2d9",
        "order": 4,
        "width": "0",
        "height": "0",
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 1070,
        "y": 380,
        "wires": [
            [
                "fcc6366f.aa0998",
                "92c6f73d.d38e98",
                "21f07479.c7da9c",
                "c8ee7404.bf05b8",
                "6afb2001.139fe"
            ]
        ]
    },
    {
        "id": "3226d9b9.c591c6",
        "type": "fritz-thermostat",
        "z": "4d90b497.b5b2ac",
        "connection": "c2e6322e.33404",
        "name": "setTempTarget AVM 301 Waschküche",
        "action": "setTempTarget",
        "x": 1950,
        "y": 340,
        "wires": [
            [
                "2122ea56.ebd5e6"
            ]
        ]
    },
    {
        "id": "a8931b52.026628",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "fan controller",
        "func": "const outside_abs_humidity = global.get(\"aussen-absolute_humidity\");\nconst wk_temperature = global.get(\"waschkueche_luefter-temperature\");\nconst wk_humidity = global.get(\"waschkueche_luefter-humidity\");\nconst wk_abs_humidity = global.get(\"waschkueche_luefter-absolute_humidity\");\n\nconst washroom_fan_control = flow.get(\"washroom_fan_control\");\nconst last_abs_humidity_gt_outside_abs_humidity = global.get(\"washroom-last_abs_humidity_gt_outside_abs_humidity\");\n\nconst room_abs_humidity_gt_outside_abs_humidity = (last_abs_humidity_gt_outside_abs_humidity) ?\n    wk_abs_humidity > outside_abs_humidity * 1.20 :\n    wk_abs_humidity > outside_abs_humidity * 1.25 ;\n\nglobal.set(\"washroom-last_abs_humidity_gt_outside_abs_humidity\", wk_abs_humidity > outside_abs_humidity);\n\nvar washroom_fan_on;\nif (washroom_fan_control == \"ON\") {\n    if (room_abs_humidity_gt_outside_abs_humidity) {\n        if (wk_humidity > 65) { // || wk_temperature > 17) {\n            washroom_fan_on = \"ON\";\n        } else {\n            washroom_fan_on = \"OFF\";\n        }\n    } else {\n        washroom_fan_on = \"OFF\";\n    }\n} else {\n    washroom_fan_on = undefined;\n}\n\nmsg = [\n    (washroom_fan_on) ? {topic: \"luefter_sw\", payload: washroom_fan_on} : undefined,\n    {topic: \"Debug\", payload: {\n            outside_abs_humidity: outside_abs_humidity,\n            wk_temperature: wk_temperature,\n            wk_humidity: wk_humidity,\n            wk_abs_humidity: wk_abs_humidity,\n            washroom_fan_on: washroom_fan_on,\n            washroom_fan_control: washroom_fan_control,\n            last_abs_humidity_gt_outside_abs_humidity: last_abs_humidity_gt_outside_abs_humidity\n    }   }\n];\n\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 380,
        "wires": [
            [
                "74d29041.9a5c4"
            ],
            [
                "9b925dad22426b25"
            ]
        ]
    },
    {
        "id": "fcc6366f.aa0998",
        "type": "mqtt out",
        "z": "4d90b497.b5b2ac",
        "name": "Waschküche Lüfter",
        "topic": "waschkueche-luefter/switch/switch12/command",
        "qos": "",
        "retain": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1410,
        "y": 460,
        "wires": []
    },
    {
        "id": "92c6f73d.d38e98",
        "type": "mqtt out",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung servo",
        "topic": "waschkueche-lueftungssteuerung/switch/servo/command",
        "qos": "",
        "retain": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1480,
        "y": 500,
        "wires": []
    },
    {
        "id": "21f07479.c7da9c",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "not",
        "func": "return {payload: (msg.payload != 'ON' ? 'ON' : 'OFF')};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 380,
        "wires": [
            [
                "341192ad.5f46be"
            ]
        ]
    },
    {
        "id": "c8ee7404.bf05b8",
        "type": "mqtt out",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung green led",
        "topic": "waschkueche-lueftungssteuerung/switch/green/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1490,
        "y": 540,
        "wires": []
    },
    {
        "id": "aea42133.521d6",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "func": "const lueften = msg.payload == \"LUEFTEN\";\nconst nicht_lueften = msg.payload == \"NICHT_LUEFTEN\";\nvar automatik = msg.payload == \"AUTOMATIK\" || flow.get(\"waschkueche_lueftungssteuerung-automatik\");\n\nif (lueften || nicht_lueften) {\n    automatik = false;\n}\n\nflow.set(\"waschkueche_lueftungssteuerung-automatik\", automatik);\n\nreturn [\n    {payload: (lueften) ? 'ON' : 'OFF'},\n    {payload: (automatik) ? 'ON' : 'OFF'}\n];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 540,
        "wires": [
            [
                "74d29041.9a5c4",
                "e141181a.c44548"
            ],
            [
                "d5fef74c.c342e8"
            ]
        ]
    },
    {
        "id": "429ff1e7.d2093",
        "type": "trigger",
        "z": "4d90b497.b5b2ac",
        "name": "Treppenhausautomat",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "65",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1080,
        "y": 460,
        "wires": [
            [
                "74d29041.9a5c4"
            ]
        ]
    },
    {
        "id": "6afb2001.139fe",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "func": "const luefter = msg.payload;\nconst wk_temperature = global.get(\"waschkueche_luefter-temperature\");\nconst wk_rel_humidity = global.get(\"waschkueche_luefter-humidity\");\n\nif (luefter === \"ON\") { \n    return {\n        payload: \"off\"\n    };\n} else if (wk_rel_humidity > 65) {\n    return {\n        payload: 16\n    };\n} else if (wk_rel_humidity > 60) {\n    return {\n        payload: \"off\"\n    };\n} else {\n    return {\n        payload: \"off\"\n    };\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 340,
        "wires": [
            [
                "6efdaf1f.06744"
            ]
        ]
    },
    {
        "id": "1547ac.8baef854",
        "type": "inject",
        "z": "4d90b497.b5b2ac",
        "name": "every 20 minutes",
        "props": [
            {
                "p": "topic",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "1200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 450,
        "y": 380,
        "wires": [
            [
                "a8931b52.026628"
            ]
        ]
    },
    {
        "id": "341192ad.5f46be",
        "type": "mqtt out",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung red led",
        "topic": "waschkueche-lueftungssteuerung/switch/red/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1620,
        "y": 380,
        "wires": []
    },
    {
        "id": "e141181a.c44548",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1060,
        "y": 500,
        "wires": [
            [
                "429ff1e7.d2093"
            ]
        ]
    },
    {
        "id": "d5fef74c.c342e8",
        "type": "ui_switch",
        "z": "4d90b497.b5b2ac",
        "name": "Waschküche Lüfterautomatik",
        "label": "Lüfterautomatik",
        "tooltip": "",
        "group": "7e092ea0.4f2d9",
        "order": 3,
        "width": "0",
        "height": "0",
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 1120,
        "y": 580,
        "wires": [
            [
                "9df23e12.4321d",
                "febc79d8.468048"
            ]
        ]
    },
    {
        "id": "10e19129.3947ef",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "filter ON map to LUEFTEN",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"LUEFTEN\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 500,
        "wires": [
            [
                "aea42133.521d6"
            ]
        ]
    },
    {
        "id": "7b34d28e.50768c",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "filter ON map to LUEFTEN",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"AUTOMATIK\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 540,
        "wires": [
            [
                "aea42133.521d6"
            ]
        ]
    },
    {
        "id": "a77eeea8.ad77b",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "filter ON map to NICHT_LUEFTEN",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"NICHT_LUEFTEN\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 580,
        "wires": [
            [
                "aea42133.521d6"
            ]
        ]
    },
    {
        "id": "9df23e12.4321d",
        "type": "change",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "washroom_fan_control",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1130,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "febc79d8.468048",
        "type": "mqtt out",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung yellow led",
        "topic": "waschkueche-lueftungssteuerung/switch/yellow/command",
        "qos": "",
        "retain": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1490,
        "y": 580,
        "wires": []
    },
    {
        "id": "8f0a4f28.6f3c4",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung lueften",
        "topic": "waschkueche-lueftungssteuerung/binary_sensor/lueften/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 220,
        "y": 500,
        "wires": [
            [
                "10e19129.3947ef"
            ]
        ]
    },
    {
        "id": "8e37f3ae.8c3a1",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung automatik",
        "topic": "waschkueche-lueftungssteuerung/binary_sensor/automatik/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 230,
        "y": 540,
        "wires": [
            [
                "7b34d28e.50768c"
            ]
        ]
    },
    {
        "id": "3389cd6e.2de5b2",
        "type": "mqtt in",
        "z": "4d90b497.b5b2ac",
        "name": "waschkueche-lueftungssteuerung nicht lueften",
        "topic": "waschkueche-lueftungssteuerung/binary_sensor/nicht_lueften/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 240,
        "y": 580,
        "wires": [
            [
                "a77eeea8.ad77b"
            ]
        ]
    },
    {
        "id": "6efdaf1f.06744",
        "type": "ui_dropdown",
        "z": "4d90b497.b5b2ac",
        "name": "Heizung Waschküche",
        "label": "Heizung",
        "tooltip": "",
        "place": "Select option",
        "group": "7e092ea0.4f2d9",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "off",
                "value": "off",
                "type": "str"
            },
            {
                "label": "14°",
                "value": 14,
                "type": "num"
            },
            {
                "label": "16°",
                "value": 16,
                "type": "num"
            },
            {
                "label": "20°",
                "value": 20,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1560,
        "y": 340,
        "wires": [
            [
                "6cf66f42.81259"
            ]
        ]
    },
    {
        "id": "2122ea56.ebd5e6",
        "type": "function",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "func": "const status = (msg.payload === \"off\") ? \"off\" : \"on\";\nconst temp = (msg.payload === \"off\" ? 0 : msg.payload);\n\nreturn {\n    topic: \"fritzbox/waschkueche_heizung\",\n    payload: {\n        status: status,\n        target_temperature: temp\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2000,
        "y": 380,
        "wires": [
            [
                "7b4ce70.b1fd818"
            ]
        ]
    },
    {
        "id": "6cf66f42.81259",
        "type": "change",
        "z": "4d90b497.b5b2ac",
        "name": "set ain",
        "rules": [
            {
                "t": "set",
                "p": "ain",
                "pt": "msg",
                "to": "099950702018",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1730,
        "y": 340,
        "wires": [
            [
                "3226d9b9.c591c6"
            ]
        ]
    },
    {
        "id": "7b4ce70.b1fd818",
        "type": "link out",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "links": [
            "4708a180.a07a"
        ],
        "x": 2095,
        "y": 380,
        "wires": []
    },
    {
        "id": "9b925dad22426b25",
        "type": "debug",
        "z": "4d90b497.b5b2ac",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 420,
        "wires": []
    },
    {
        "id": "3f614727.989a68",
        "type": "mqtt in",
        "z": "293bb437.fa00bc",
        "name": "Kellertürschalter Außenlicht",
        "topic": "kellertuer/binary_sensor/switch2/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 200,
        "y": 100,
        "wires": [
            [
                "7e1d2b18.0c9484"
            ]
        ]
    },
    {
        "id": "ba941b0f.612f68",
        "type": "mqtt out",
        "z": "293bb437.fa00bc",
        "name": "Gartenlicht",
        "topic": "kellertuer/switch/relay2/command",
        "qos": "",
        "retain": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1270,
        "y": 100,
        "wires": []
    },
    {
        "id": "9c8ad592.66e0d8",
        "type": "mqtt out",
        "z": "293bb437.fa00bc",
        "name": "Kellertürlicht",
        "topic": "kellertuer/switch/relay1/command",
        "qos": "",
        "retain": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1450,
        "y": 360,
        "wires": []
    },
    {
        "id": "6c60716b.1a609",
        "type": "ui_switch",
        "z": "293bb437.fa00bc",
        "name": "Gartenlicht (3h)",
        "label": "Gartenlicht",
        "tooltip": "",
        "group": "d32aa509.f54168",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 920,
        "y": 100,
        "wires": [
            [
                "50bd8fbd.0e738"
            ]
        ]
    },
    {
        "id": "3f392e15.5cb7d2",
        "type": "ui_switch",
        "z": "293bb437.fa00bc",
        "name": "Kellertürscheinwerfer  (1 min)",
        "label": "Kellertürscheinwerfer  (1 min)",
        "tooltip": "",
        "group": "d32aa509.f54168",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 960,
        "y": 300,
        "wires": [
            [
                "e35415a4.7f0848",
                "68961b94.429674"
            ]
        ]
    },
    {
        "id": "ee80f561.19c918",
        "type": "mqtt in",
        "z": "293bb437.fa00bc",
        "name": "Kellertürschalter außen",
        "topic": "kellertuer/binary_sensor/switch1/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 280,
        "wires": [
            [
                "8a4014a2.999cd8"
            ]
        ]
    },
    {
        "id": "7e1d2b18.0c9484",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "toggle",
        "func": "if (msg.payload != \"ON\")\n    return undefined;\n\nvar topic = \"gartenlicht\";\nvar current_state = flow.get(topic);\nvar new_state;\n\nif (current_state === \"OFF\") {\n    new_state = \"ON\";\n} else {\n    new_state = \"OFF\";\n}\n\nflow.set(topic, new_state);\n\nreturn {payload: new_state};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 100,
        "wires": [
            [
                "6c60716b.1a609",
                "264e2ae04e4d81f0",
                "2913705d3d5c391f"
            ]
        ]
    },
    {
        "id": "6de264d6.e9f88c",
        "type": "mqtt in",
        "z": "293bb437.fa00bc",
        "name": "Fernbedienung Balkontür",
        "topic": "zigbee2mqtt/fernbedienung_balkontuer",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 190,
        "y": 220,
        "wires": [
            [
                "851693ee.65c15"
            ]
        ]
    },
    {
        "id": "851693ee.65c15",
        "type": "switch",
        "z": "293bb437.fa00bc",
        "name": "action",
        "property": "payload.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_move_up",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_move_down",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "brightness_stop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 370,
        "y": 220,
        "wires": [
            [
                "89f0fbf4.8c0958"
            ],
            [
                "3191ad6d.ff0602"
            ],
            [],
            [
                "91179e20.4edce"
            ],
            []
        ]
    },
    {
        "id": "89f0fbf4.8c0958",
        "type": "template",
        "z": "293bb437.fa00bc",
        "name": "ON",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "ON",
        "output": "str",
        "x": 550,
        "y": 140,
        "wires": [
            [
                "7e1d2b18.0c9484"
            ]
        ]
    },
    {
        "id": "3191ad6d.ff0602",
        "type": "template",
        "z": "293bb437.fa00bc",
        "name": "ON",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "ON",
        "output": "str",
        "x": 550,
        "y": 280,
        "wires": [
            [
                "eabff51d.1ce108"
            ]
        ]
    },
    {
        "id": "eabff51d.1ce108",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "toggle",
        "func": "if (msg.payload != \"ON\")\n    return undefined;\n\nvar topic = \"kellertürlicht\";\nvar current_state = flow.get(topic);\nvar new_state;\n\nif (current_state === \"OFF\") {\n    new_state = \"ON\";\n} else {\n    new_state = \"OFF\";\n}\n\nreturn {payload: new_state};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 730,
        "y": 280,
        "wires": [
            [
                "3f392e15.5cb7d2",
                "155c6ddb3adf7186"
            ]
        ]
    },
    {
        "id": "a6b742da.b11dd",
        "type": "openweathermap in",
        "z": "293bb437.fa00bc",
        "name": "Wetter",
        "wtype": "current",
        "lon": "10.01239",
        "lat": "53.50597",
        "city": "",
        "country": "",
        "language": "de",
        "x": 130,
        "y": 700,
        "wires": [
            [
                "f537de13ab240908"
            ]
        ]
    },
    {
        "id": "19fb59d7.6f23e6",
        "type": "mqtt out",
        "z": "293bb437.fa00bc",
        "name": "",
        "topic": "aussen-licht/switch/relay1/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 930,
        "y": 520,
        "wires": []
    },
    {
        "id": "c06891a3.a77e7",
        "type": "mqtt in",
        "z": "293bb437.fa00bc",
        "name": "",
        "topic": "aussen-licht/binary_sensor/lichtsensor/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 250,
        "y": 540,
        "wires": [
            [
                "7ced6d2d.29ad64",
                "f52fa99.d8a2b58",
                "6795e265.50a59c",
                "c4e81b24848f57bf"
            ]
        ]
    },
    {
        "id": "7ced6d2d.29ad64",
        "type": "ui_switch",
        "z": "293bb437.fa00bc",
        "name": "Haustürlicht",
        "label": "Haustürlicht",
        "tooltip": "",
        "group": "d32aa509.f54168",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "x": 630,
        "y": 500,
        "wires": [
            [
                "19fb59d7.6f23e6"
            ]
        ]
    },
    {
        "id": "f52fa99.d8a2b58",
        "type": "ui_switch",
        "z": "293bb437.fa00bc",
        "name": "Treppenlicht",
        "label": "Treppenlicht",
        "tooltip": "",
        "group": "d32aa509.f54168",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "x": 630,
        "y": 540,
        "wires": [
            [
                "19fb59d7.6f23e6"
            ]
        ]
    },
    {
        "id": "6795e265.50a59c",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"dunkel\"}\nelse\n    return {payload: \"hell\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 580,
        "wires": [
            [
                "f6017621.65b638"
            ]
        ]
    },
    {
        "id": "bc54b6b1.153c68",
        "type": "ui_text",
        "z": "293bb437.fa00bc",
        "group": "d32aa509.f54168",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Umgebung",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 990,
        "y": 580,
        "wires": []
    },
    {
        "id": "e35415a4.7f0848",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1240,
        "y": 240,
        "wires": [
            [
                "cf34ae19.8d29c"
            ]
        ]
    },
    {
        "id": "cf34ae19.8d29c",
        "type": "trigger",
        "z": "293bb437.fa00bc",
        "name": "Treppenhausautomat 2 min",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1499,
        "y": 240,
        "wires": [
            [
                "3f392e15.5cb7d2"
            ]
        ]
    },
    {
        "id": "8a4014a2.999cd8",
        "type": "button-events",
        "z": "293bb437.fa00bc",
        "name": "Kellertürlicht",
        "outputs": 2,
        "inputField": "payload",
        "inputFieldType": "msg",
        "outputField": "payload",
        "outputFieldType": "msg",
        "downValue": "ON",
        "downValueType": "str",
        "upValue": "OFF",
        "upValueType": "str",
        "idleValue": "1",
        "clickedInterval": "200",
        "pressedInterval": "300",
        "debounceInterval": 30,
        "events": [
            {
                "type": "clicked"
            },
            {
                "type": "pressed"
            }
        ],
        "x": 350,
        "y": 320,
        "wires": [
            [
                "3191ad6d.ff0602"
            ],
            [
                "91179e20.4edce"
            ]
        ]
    },
    {
        "id": "b8b75b36.9f0be8",
        "type": "ui_switch",
        "z": "293bb437.fa00bc",
        "name": "Kellertürscheinwerfer (1h)",
        "label": "Kellertürscheinwerfer (1h)",
        "tooltip": "",
        "group": "d32aa509.f54168",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 950,
        "y": 400,
        "wires": [
            [
                "fe5adaf5.ca1d18",
                "565c0dc9.9aa304"
            ]
        ]
    },
    {
        "id": "91179e20.4edce",
        "type": "template",
        "z": "293bb437.fa00bc",
        "name": "ON",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "ON",
        "output": "str",
        "x": 550,
        "y": 340,
        "wires": [
            [
                "b8b75b36.9f0be8",
                "896147495b1766de"
            ]
        ]
    },
    {
        "id": "68961b94.429674",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "store in flow",
        "func": "const topic = \"kellertürlicht\";\nconst last_state = flow.get(topic);\n\nif (last_state === \"ON\")\n    if (msg.payload === \"ON\") {\n        flow.set(topic + \"-exor\", true);\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, {payload: \"OFF\"}]\n    } else {\n        if (flow.get(topic + \"-exor\")) {\n            flow.set(topic + \"-exor\", false);\n            return;\n        }\n        flow.set(topic, msg.payload);\n        return [{payload: \"OFF\"}, {reset: \"RESET\"}, undefined];\n    }\nelse {\n    if (msg.payload === \"ON\") {\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, undefined];\n    }\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1210,
        "y": 300,
        "wires": [
            [
                "9c8ad592.66e0d8"
            ],
            [
                "cf34ae19.8d29c",
                "a8d1c90e.0569d8"
            ],
            [
                "b8b75b36.9f0be8"
            ]
        ]
    },
    {
        "id": "50bd8fbd.0e738",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "store in flow",
        "func": "var topic = \"gartenlicht\";\nflow.set(topic, msg.payload);\nglobal.set(topic, msg.payload);\n\nreturn {payload: msg.payload};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 100,
        "wires": [
            [
                "ba941b0f.612f68",
                "86cb329b293bb1f4"
            ]
        ]
    },
    {
        "id": "fe5adaf5.ca1d18",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "store in flow",
        "func": "const topic = \"kellertürlicht\";\nconst last_state = flow.get(topic);\n\nif (last_state === \"ON\")\n    if (msg.payload === \"ON\") {\n        flow.set(topic + \"-exor\", true);\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, {payload: \"OFF\"}]\n    } else {\n        if (flow.get(topic + \"-exor\")) {\n            flow.set(topic + \"-exor\", false);\n            return;\n        }\n        flow.set(topic, msg.payload);\n        return [{payload: \"OFF\"}, {reset: \"RESET\"}, undefined];\n    }\nelse {\n    if (msg.payload === \"ON\") {\n        flow.set(topic, msg.payload);\n        return [{payload: \"ON\"}, undefined, undefined];\n    }\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1210,
        "y": 400,
        "wires": [
            [
                "9c8ad592.66e0d8"
            ],
            [
                "cf34ae19.8d29c",
                "a8d1c90e.0569d8"
            ],
            [
                "3f392e15.5cb7d2"
            ]
        ]
    },
    {
        "id": "565c0dc9.9aa304",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1240,
        "y": 460,
        "wires": [
            [
                "a8d1c90e.0569d8"
            ]
        ]
    },
    {
        "id": "a8d1c90e.0569d8",
        "type": "trigger",
        "z": "293bb437.fa00bc",
        "name": "Treppenhausautomat 1 h",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "1",
        "extend": true,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1489,
        "y": 460,
        "wires": [
            [
                "b8b75b36.9f0be8"
            ]
        ]
    },
    {
        "id": "f6017621.65b638",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "store in global",
        "func": "var topic = \"umgebungslicht\";\nglobal.set(topic, msg.payload);\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 580,
        "wires": [
            [
                "bc54b6b1.153c68"
            ]
        ]
    },
    {
        "id": "353ad6f4.8c98ba",
        "type": "mqtt in",
        "z": "293bb437.fa00bc",
        "name": "Bewegungsmelder Kellertür",
        "topic": "zigbee2mqtt/bewegungsmelder_kellertuer",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 200,
        "y": 400,
        "wires": [
            [
                "b4b4ec5a.5a982"
            ]
        ]
    },
    {
        "id": "b4b4ec5a.5a982",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "map occupancy to ON",
        "func": "if (msg.payload[\"occupancy\"])\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 460,
        "y": 400,
        "wires": [
            [
                "25c855ce.b3b12a"
            ]
        ]
    },
    {
        "id": "25c855ce.b3b12a",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "dunkel",
        "func": "const umgebung = global.get('umgebungslicht');\n\nif (umgebung == \"dunkel\")\n    return {payload: \"ON\"}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 730,
        "y": 320,
        "wires": [
            [
                "3f392e15.5cb7d2",
                "5dd90579e6837467"
            ]
        ]
    },
    {
        "id": "c4e81b24848f57bf",
        "type": "ui_switch",
        "z": "293bb437.fa00bc",
        "name": "Balkonlicht",
        "label": "Balkonlicht",
        "tooltip": "",
        "group": "d32aa509.f54168",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 630,
        "y": 640,
        "wires": [
            [
                "ea10858a1cba4404"
            ]
        ]
    },
    {
        "id": "ea10858a1cba4404",
        "type": "mqtt out",
        "z": "293bb437.fa00bc",
        "name": "",
        "topic": "steckdose1/switch/relais/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 920,
        "y": 640,
        "wires": []
    },
    {
        "id": "f1f1a294807a426a",
        "type": "thingzi-timer",
        "z": "293bb437.fa00bc",
        "name": "Licht Nachts aus",
        "lat": "50.882",
        "lon": "6.6949",
        "timerType": "trigger",
        "startupMessage": false,
        "ontype": "tod",
        "ontimesun": "dusk",
        "ontimetod": "23:00",
        "onpropertytype": "msg",
        "onproperty": "payload",
        "onvaluetype": "str",
        "onvalue": "OFF",
        "onoffset": "",
        "onrandomoffset": false,
        "offtype": "tod",
        "offtimesun": "dawn",
        "offtimetod": "23:00",
        "offpropertytype": "msg",
        "offproperty": "payload",
        "offvaluetype": "str",
        "offvalue": "OFF",
        "offoffset": "",
        "offrandomoffset": false,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": true,
        "sun": true,
        "x": 400,
        "y": 40,
        "wires": [
            [
                "89dc73d808e84b6b"
            ]
        ]
    },
    {
        "id": "42d43c62e34642a4",
        "type": "link in",
        "z": "293bb437.fa00bc",
        "name": "",
        "links": [
            "89dc73d808e84b6b"
        ],
        "x": 755,
        "y": 40,
        "wires": [
            [
                "6c60716b.1a609"
            ]
        ]
    },
    {
        "id": "89dc73d808e84b6b",
        "type": "link out",
        "z": "293bb437.fa00bc",
        "name": "Nachts Licht aus",
        "mode": "link",
        "links": [
            "42d43c62e34642a4",
            "7de46dbaad752c86"
        ],
        "x": 535,
        "y": 40,
        "wires": []
    },
    {
        "id": "7de46dbaad752c86",
        "type": "link in",
        "z": "293bb437.fa00bc",
        "name": "",
        "links": [
            "89dc73d808e84b6b"
        ],
        "x": 475,
        "y": 640,
        "wires": [
            [
                "c4e81b24848f57bf"
            ]
        ]
    },
    {
        "id": "264e2ae04e4d81f0",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 940,
        "y": 140,
        "wires": [
            [
                "7b254d67885a2819"
            ]
        ]
    },
    {
        "id": "7b254d67885a2819",
        "type": "trigger",
        "z": "293bb437.fa00bc",
        "name": "Treppenhausautomat 3h",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "3",
        "extend": true,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1170,
        "y": 140,
        "wires": [
            [
                "6c60716b.1a609"
            ]
        ]
    },
    {
        "id": "93bc5ff5cc82aa92",
        "type": "change",
        "z": "293bb437.fa00bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "reset",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1140,
        "y": 180,
        "wires": [
            [
                "7b254d67885a2819"
            ]
        ]
    },
    {
        "id": "2913705d3d5c391f",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "filter OFF",
        "func": "if (msg.payload === \"OFF\")\n    return {payload: \"OFF\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 940,
        "y": 180,
        "wires": [
            [
                "93bc5ff5cc82aa92"
            ]
        ]
    },
    {
        "id": "8bb8f7f2bf42a352",
        "type": "openweathermap in",
        "z": "293bb437.fa00bc",
        "d": true,
        "name": "Wettervorhersage",
        "wtype": "forecast",
        "lon": "10.01239",
        "lat": "53.50597",
        "city": "",
        "country": "",
        "language": "de",
        "x": 160,
        "y": 980,
        "wires": [
            [
                "c840b3d374ab48ce"
            ]
        ]
    },
    {
        "id": "c840b3d374ab48ce",
        "type": "debug",
        "z": "293bb437.fa00bc",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 360,
        "y": 980,
        "wires": []
    },
    {
        "id": "86cb329b293bb1f4",
        "type": "link out",
        "z": "293bb437.fa00bc",
        "name": "kellertuer_schalter_aussenlicht",
        "mode": "link",
        "links": [
            "cfca6b4ad8a515f2"
        ],
        "x": 1215,
        "y": 60,
        "wires": []
    },
    {
        "id": "896147495b1766de",
        "type": "flogger",
        "z": "293bb437.fa00bc",
        "name": "schalter2h",
        "logfile": "kellertuer",
        "inputchoice": "fullmsg",
        "inputobject": "payload",
        "inputobjectType": "msg",
        "inputmoustache": "Recieved payload {{payload}} and topic {{topic}}",
        "loglevel": "INFO",
        "logconfig": "8929498a4f6d4a2d",
        "sendpane": "",
        "x": 730,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "155c6ddb3adf7186",
        "type": "flogger",
        "z": "293bb437.fa00bc",
        "name": "schalter1min",
        "logfile": "kellertuer",
        "inputchoice": "fullmsg",
        "inputobject": "payload",
        "inputobjectType": "msg",
        "inputmoustache": "Recieved payload {{payload}} and topic {{topic}}",
        "loglevel": "INFO",
        "logconfig": "8929498a4f6d4a2d",
        "sendpane": "",
        "x": 930,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "5dd90579e6837467",
        "type": "flogger",
        "z": "293bb437.fa00bc",
        "name": "bewegungsmelder",
        "logfile": "kellertuer",
        "inputchoice": "fullmsg",
        "inputobject": "payload",
        "inputobjectType": "msg",
        "inputmoustache": "Recieved payload {{payload}} and topic {{topic}}",
        "loglevel": "INFO",
        "logconfig": "8929498a4f6d4a2d",
        "sendpane": "",
        "x": 930,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "48087d0df0fa2728",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "store global as named aussen",
        "func": "global.set(\"aussen-temperature\", msg.payload.tempc);\nglobal.set(\"aussen-humidity\", msg.payload.humidity);\nglobal.set(\"aussen-absolute_humidity\", msg.payload.absolute_humidity);\nglobal.set(\"aussen-pressure\", msg.payload.pressure);\nglobal.set(\"aussen-dew_point\", msg.payload.dew_point);\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "8a37748d46ba0dbf",
        "type": "link out",
        "z": "293bb437.fa00bc",
        "name": "aussen",
        "mode": "link",
        "links": [
            "9b9574d4.b3d108"
        ],
        "x": 575,
        "y": 700,
        "wires": []
    },
    {
        "id": "f537de13ab240908",
        "type": "function",
        "z": "293bb437.fa00bc",
        "name": "add absolute_humidity and dew_point",
        "func": "const mw = 18.01534;    // molar mass of water g/mol\nconst r = 8.31447215;   // Universal gas constant J/mol/K\n\nconst tempc = Number(msg.payload.tempc);\nconst humidity = Number(msg.payload.humidity);\n\nconst absolute_humidity = Number((6.112 * Math.exp((17.67 * tempc) /\n    (tempc + 243.5)) * humidity * mw) /\n    ((273.15 + tempc) * r));\nconst dew_point = Number((243.5 * (Math.log(humidity / 100) + ((17.67 * tempc) /\n    (243.5 + tempc))) / (17.67 - Math.log(humidity / 100) -\n        ((17.67 * tempc) / (243.5 + tempc)))));\n\nmsg.payload.absolute_humidity = absolute_humidity;\nmsg.payload.dew_point = dew_point;\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 700,
        "wires": [
            [
                "48087d0df0fa2728",
                "8a37748d46ba0dbf"
            ]
        ]
    },
    {
        "id": "7ae7fa74.a8aa34",
        "type": "function",
        "z": "fc81a32b.bb6db",
        "name": "add absolute_humidity and dew_point",
        "func": "const temperature = msg.payload.temperature;\nconst humidity = msg.payload.humidity;\n\nconst mw = 18.01534;    // molar mass of water g/mol\nconst r = 8.31447215;   // Universal gas constant J/mol/K\n\nmsg.payload.absolute_humidity = (6.112 * Math.pow(2.718281828, (17.67 * temperature) /\n    (temperature + 243.5)) * humidity * mw) /\n    ((273.15 + temperature) * r); // in grams/m^3\n\nmsg.payload.dew_point = (243.5*(Math.log(humidity/100)+((17.67*temperature)/\n    (243.5+temperature)))/(17.67-Math.log(humidity/100)-\n    ((17.67*temperature)/(243.5+temperature))));\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 670,
        "y": 140,
        "wires": [
            [
                "56169d58.a0dc04"
            ]
        ]
    },
    {
        "id": "aa7a4964.384d28",
        "type": "link out",
        "z": "fc81a32b.bb6db",
        "name": "",
        "links": [
            "4708a180.a07a"
        ],
        "x": 915,
        "y": 180,
        "wires": []
    },
    {
        "id": "87c5ced2.7998f",
        "type": "mqtt in",
        "z": "fc81a32b.bb6db",
        "name": "",
        "topic": "zigbee2mqtt/+",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 140,
        "y": 140,
        "wires": [
            [
                "d9d02903.582fc8",
                "a1cc7149.c8e29"
            ]
        ]
    },
    {
        "id": "d9d02903.582fc8",
        "type": "function",
        "z": "fc81a32b.bb6db",
        "name": "Filter Aqara Smart topics",
        "func": "if (msg.topic.match(/aqara_smart/)) {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 140,
        "wires": [
            [
                "7ae7fa74.a8aa34"
            ]
        ]
    },
    {
        "id": "a7ae9a7e.53fb48",
        "type": "function",
        "z": "fc81a32b.bb6db",
        "name": "Aqara Smart to global store",
        "func": "const name = msg.payload.name;\n\nglobal.set(`${name}-temperature`, msg.payload.temperature);\nglobal.set(`${name}-humidity`, msg.payload.humidity);\nglobal.set(`${name}-absolute_humidity`, msg.payload.absolute_humidity);\nglobal.set(`${name}-dew_point`, msg.payload.dew_point);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 820,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "fb6167b0.b1aeb8",
        "type": "debug",
        "z": "fc81a32b.bb6db",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 140,
        "wires": []
    },
    {
        "id": "f3d8ac5c.06b5d",
        "type": "mqtt in",
        "z": "fc81a32b.bb6db",
        "name": "",
        "topic": "+/sensor/+/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 140,
        "y": 80,
        "wires": [
            [
                "e9d35454.3632b8"
            ]
        ]
    },
    {
        "id": "e9d35454.3632b8",
        "type": "function",
        "z": "fc81a32b.bb6db",
        "name": "ESPHome to global store",
        "func": "const tokens = msg.topic.split(\"/\");\nconst name = tokens[0].replace(' ', '_');\nconst field = tokens[2].replace(' ', '_');\n\nconst value = (/^(\\-|\\+)?([0-9]+(\\.[0-9]+)?)$/.test(msg.payload))\n    ? Number(msg.payload) : msg.payload;\n\nglobal.set(`${name}-${field}`, value);\n\nreturn {payload: {\n    name: name,\n    field: field,\n    value: value\n}};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 80,
        "wires": [
            [
                "621bc9b5.3e4d28"
            ]
        ]
    },
    {
        "id": "621bc9b5.3e4d28",
        "type": "debug",
        "z": "fc81a32b.bb6db",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 80,
        "wires": []
    },
    {
        "id": "56169d58.a0dc04",
        "type": "function",
        "z": "fc81a32b.bb6db",
        "name": "add name",
        "func": "const name = msg.topic.replace(/^zigbee2mqtt\\/aqara_smart_/, '').replace(' ', '_');\nmsg.payload.name = name;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 760,
        "y": 180,
        "wires": [
            [
                "a7ae9a7e.53fb48",
                "aa7a4964.384d28",
                "fb6167b0.b1aeb8"
            ]
        ]
    },
    {
        "id": "a1cc7149.c8e29",
        "type": "debug",
        "z": "fc81a32b.bb6db",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 220,
        "wires": []
    },
    {
        "id": "267d2e1.40785d2",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "Create Message",
        "func": "var send_rate = Number(msg.payload.NewByteSendRate)\nvar receive_rate = Number(msg.payload.NewByteReceiveRate)\n\nmsg = [\n    {payload: receive_rate / 1024 / 1024 * 8},\n    {payload: send_rate / 1024 / 1024 * 8}\n];\n\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 80,
        "wires": [
            [
                "678631ab.fe1bb"
            ],
            [
                "9d0190fe.0d3fe"
            ]
        ]
    },
    {
        "id": "a29449a0.411b18",
        "type": "inject",
        "z": "2f328ad8.26ca86",
        "name": "Every 5s",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 80,
        "wires": [
            [
                "3e907215.115b5e"
            ]
        ]
    },
    {
        "id": "3e907215.115b5e",
        "type": "fritzbox-in",
        "z": "2f328ad8.26ca86",
        "device": "48b52eb1.50063",
        "name": "",
        "service": "urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1",
        "action": "GetAddonInfos",
        "arguments": "{}",
        "x": 410,
        "y": 80,
        "wires": [
            [
                "267d2e1.40785d2"
            ]
        ]
    },
    {
        "id": "86ad9def.8aa5c",
        "type": "mqtt in",
        "z": "2f328ad8.26ca86",
        "name": "",
        "topic": "stromzaehler/sensor/1/obis/1-0:16.7.0/255/value",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 320,
        "y": 340,
        "wires": [
            [
                "2da1b2f192911d45"
            ]
        ]
    },
    {
        "id": "2dcf1032.d990b",
        "type": "mqtt in",
        "z": "2f328ad8.26ca86",
        "name": "",
        "topic": "stromzaehler/sensor/1/obis/1-0:1.8.0/255/value",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 320,
        "y": 260,
        "wires": [
            [
                "d706024302ec5675"
            ]
        ]
    },
    {
        "id": "ea99ed95.a6b5f",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "Stromaufnahme",
        "mode": "link",
        "links": [
            "cf2bd5c4.367d88"
        ],
        "x": 735,
        "y": 300,
        "wires": []
    },
    {
        "id": "8452f01b.9b7a2",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "Stromzählerstand",
        "links": [
            "cbdd2a4.e9dcad8"
        ],
        "x": 735,
        "y": 220,
        "wires": []
    },
    {
        "id": "678631ab.fe1bb",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "DSL Downstream",
        "links": [
            "c464d2a1.b031e"
        ],
        "x": 735,
        "y": 60,
        "wires": []
    },
    {
        "id": "9d0190fe.0d3fe",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "DSL Upstream",
        "links": [
            "e94f62b.6a086a"
        ],
        "x": 735,
        "y": 100,
        "wires": []
    },
    {
        "id": "5a82383.d4d5ec8",
        "type": "mqtt in",
        "z": "2f328ad8.26ca86",
        "name": "",
        "topic": "zigbee2mqtt/gas_zaehler",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 250,
        "y": 560,
        "wires": [
            [
                "9e8d969fa2e830fa",
                "6238d883.2f3dd8"
            ]
        ]
    },
    {
        "id": "6238d883.2f3dd8",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "",
        "func": "if (msg.payload.contact) {\n    const topic = msg.topic;\n    var counter = (flow.get(topic) || 0) + 0.01;\n    flow.set(topic, counter);\n    return {topic: topic, payload: {counter: counter}};\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 560,
        "wires": [
            [
                "afb0333e.affc6",
                "cdbf2a81.584de8"
            ]
        ]
    },
    {
        "id": "afb0333e.affc6",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "Gas Zähler",
        "links": [
            "4708a180.a07a"
        ],
        "x": 735,
        "y": 560,
        "wires": []
    },
    {
        "id": "d7eb448b.d6abd8",
        "type": "ui_text",
        "z": "2f328ad8.26ca86",
        "group": "a8a6836d.1b1cf",
        "order": 0,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Zähler",
        "format": "{{msg.payload.counter}}",
        "layout": "row-spread",
        "x": 930,
        "y": 600,
        "wires": []
    },
    {
        "id": "ff9d667f.fa9df8",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "",
        "func": "if (msg.payload.counter) {\n    flow.set(msg.topic, msg.payload.counter);\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 640,
        "wires": [
            [
                "cdbf2a81.584de8"
            ]
        ]
    },
    {
        "id": "231f1768.7a5958",
        "type": "inject",
        "z": "2f328ad8.26ca86",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "zigbee2mqtt/gas_zaehler",
        "payload": "{\"counter\": 8515.868}",
        "payloadType": "json",
        "x": 400,
        "y": 640,
        "wires": [
            [
                "ff9d667f.fa9df8"
            ]
        ]
    },
    {
        "id": "cdbf2a81.584de8",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "",
        "func": "const intl = global.get('intl');\nmsg.payload.counter = intl.NumberFormat('de-De',{\n        style:'decimal', \n        maximumFractionDigits: 2,\n        minimumFractionDigits: 2\n    }).format(msg.payload.counter) + \" m³\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 600,
        "wires": [
            [
                "d7eb448b.d6abd8"
            ]
        ]
    },
    {
        "id": "137fe45c.47150c",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "format",
        "func": "const intl = global.get('intl');\nmsg.payload = intl.NumberFormat('de-De',{\n        style:'decimal', \n        minimumFractionDigits: 5,\n        maximumFractionDigits: 5\n    }).format(msg.payload/1000) + \" kWh\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 260,
        "wires": [
            [
                "a135ae90.6531b"
            ]
        ]
    },
    {
        "id": "a135ae90.6531b",
        "type": "ui_text",
        "z": "2f328ad8.26ca86",
        "group": "dab59e38.c408e",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Zähler",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 910,
        "y": 260,
        "wires": []
    },
    {
        "id": "d4a94293b3dcde0f",
        "type": "mqtt in",
        "z": "2f328ad8.26ca86",
        "name": "Wasserzaehler",
        "topic": "wasserzaehler/main/json",
        "qos": "2",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 220,
        "y": 780,
        "wires": [
            [
                "b362144e6d02d6d4",
                "81639ac35386f5a5"
            ]
        ]
    },
    {
        "id": "b362144e6d02d6d4",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "Wasserzähler",
        "mode": "link",
        "links": [
            "223c8bb042a5a36b"
        ],
        "x": 575,
        "y": 760,
        "wires": []
    },
    {
        "id": "bda66cbe403b98e1",
        "type": "ui_text",
        "z": "2f328ad8.26ca86",
        "group": "82403ec68b4e0d16",
        "order": 0,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Zähler",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 770,
        "y": 800,
        "wires": []
    },
    {
        "id": "81639ac35386f5a5",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "",
        "func": "const intl = global.get('intl');\nmsg.payload = intl.NumberFormat('de-De',{\n        style:'decimal', \n        maximumFractionDigits: 3,\n        minimumFractionDigits: 3\n    }).format(msg.payload.value) + \" m³\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 800,
        "wires": [
            [
                "bda66cbe403b98e1"
            ]
        ]
    },
    {
        "id": "02b2155614250dad",
        "type": "debug",
        "z": "2f328ad8.26ca86",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 840,
        "wires": []
    },
    {
        "id": "02f13974ebab4450",
        "type": "catch",
        "z": "2f328ad8.26ca86",
        "name": "Catch Error from Wasserzaehler",
        "scope": [
            "d4a94293b3dcde0f"
        ],
        "uncaught": false,
        "x": 270,
        "y": 840,
        "wires": [
            [
                "02b2155614250dad"
            ]
        ]
    },
    {
        "id": "9e8d969fa2e830fa",
        "type": "debounce",
        "z": "2f328ad8.26ca86",
        "d": true,
        "time": "2000",
        "name": "",
        "x": 460,
        "y": 500,
        "wires": [
            [
                "6238d883.2f3dd8"
            ]
        ]
    },
    {
        "id": "db817f6714d2a95f",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "format",
        "func": "const intl = global.get('intl');\n\nmsg.payload = intl.NumberFormat('de-De',{\n        style:'decimal', \n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n    }).format(msg.payload) + \" W\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 340,
        "wires": [
            [
                "a50e9312216973f8"
            ]
        ]
    },
    {
        "id": "a50e9312216973f8",
        "type": "ui_text",
        "z": "2f328ad8.26ca86",
        "group": "dab59e38.c408e",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Bezug",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 910,
        "y": 340,
        "wires": []
    },
    {
        "id": "f7476743a05366c2",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "Store stombezug in flow",
        "func": "flow.set(\"stombezug\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "2da1b2f192911d45",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "to_number",
        "func": "var value;\nif (/^(\\-|\\+)?([0-9]+(\\.[0-9]+)?)$/.test(msg.payload)) {\n    value = Number(msg.payload);\n} else {\n    value = msg.payload;\n}\n\nreturn {payload: value};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 340,
        "wires": [
            [
                "ea99ed95.a6b5f",
                "f7476743a05366c2",
                "db817f6714d2a95f"
            ]
        ]
    },
    {
        "id": "d706024302ec5675",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "to_number",
        "func": "var value;\nif (/^(\\-|\\+)?([0-9]+(\\.[0-9]+)?)$/.test(msg.payload)) {\n    value = Number(msg.payload);\n} else {\n    value = msg.payload;\n}\n\nreturn {payload: value};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 260,
        "wires": [
            [
                "8452f01b.9b7a2",
                "137fe45c.47150c"
            ]
        ]
    },
    {
        "id": "5001caa3ccebc382",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "einspeisung & eigenverbrauch",
        "func": "const solarertag = msg.payload;\nconst stombezug = flow.get(\"stombezug\");\n\nconst netzbezug = (stombezug > 0) ? stombezug : 0;\nconst einspeisung = (stombezug < 0) ? stombezug : 0; //wie so nicht - ?\nconst eigenverbrauch = solarertag - einspeisung;\nconst stromverbrauch = netzbezug + eigenverbrauch;\n\nreturn { payload: { eigenverbrauch: eigenverbrauch, einspeisung: einspeisung, netzbezug: netzbezug, stromverbrauch: stromverbrauch}};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 460,
        "wires": [
            [
                "4d932a70ca858354",
                "78bf53bd535db91f"
            ]
        ]
    },
    {
        "id": "e3e242d521f1c698",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "Store solarertrag in flow",
        "func": "flow.set(\"solarertag\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 460,
        "wires": [
            [
                "5001caa3ccebc382",
                "78bf53bd535db91f"
            ]
        ]
    },
    {
        "id": "4d932a70ca858354",
        "type": "link out",
        "z": "2f328ad8.26ca86",
        "name": "Einspeisung",
        "mode": "link",
        "links": [
            "49152127e918c9d7"
        ],
        "x": 1055,
        "y": 460,
        "wires": []
    },
    {
        "id": "3e9ebf101b0970f9",
        "type": "mqtt in",
        "z": "2f328ad8.26ca86",
        "name": "",
        "topic": "leistungsmesser2/sensor/power/state",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 290,
        "y": 420,
        "wires": [
            [
                "53201bdb5632cbb7",
                "e3e242d521f1c698"
            ]
        ]
    },
    {
        "id": "53201bdb5632cbb7",
        "type": "function",
        "z": "2f328ad8.26ca86",
        "name": "format",
        "func": "const intl = global.get('intl');\nmsg.payload = intl.NumberFormat('de-De',{\n        style:'decimal', \n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n    }).format(msg.payload) + \" W\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 420,
        "wires": [
            [
                "72e1ab824861a106"
            ]
        ]
    },
    {
        "id": "72e1ab824861a106",
        "type": "ui_text",
        "z": "2f328ad8.26ca86",
        "group": "dab59e38.c408e",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Solarertrag",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 930,
        "y": 420,
        "wires": []
    },
    {
        "id": "78bf53bd535db91f",
        "type": "debug",
        "z": "2f328ad8.26ca86",
        "name": "debug 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 520,
        "wires": []
    },
    {
        "id": "7b56cfeb.46625",
        "type": "mqtt out",
        "z": "dac2cb3b.559138",
        "name": "",
        "topic": "zigbee2mqtt/zirkulationspumpe/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 1000,
        "y": 380,
        "wires": []
    },
    {
        "id": "e1310c63.42996",
        "type": "thingzi-timer",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "Wochentag normal",
        "lat": "50.882",
        "lon": "6.6949",
        "timerType": "trigger",
        "startupMessage": false,
        "ontype": "tod",
        "ontimesun": "dusk",
        "ontimetod": "7:00",
        "onpropertytype": "msg",
        "onproperty": "payload",
        "onvaluetype": "str",
        "onvalue": "ON",
        "onoffset": "",
        "onrandomoffset": false,
        "offtype": "tod",
        "offtimesun": "dawn",
        "offtimetod": "8:00",
        "offpropertytype": "msg",
        "offproperty": "payload",
        "offvaluetype": "str",
        "offvalue": "OFF",
        "offoffset": "",
        "offrandomoffset": false,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": false,
        "sun": false,
        "x": 150,
        "y": 480,
        "wires": [
            [
                "4d0ea0476f9b4e31"
            ]
        ]
    },
    {
        "id": "b5f77d36.0420c",
        "type": "thingzi-timer",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "Wochenende",
        "lat": "50.882",
        "lon": "6.6949",
        "timerType": "trigger",
        "startupMessage": false,
        "ontype": "tod",
        "ontimesun": "dusk",
        "ontimetod": "8:00",
        "onpropertytype": "msg",
        "onproperty": "payload",
        "onvaluetype": "str",
        "onvalue": "ON",
        "onoffset": "",
        "onrandomoffset": false,
        "offtype": "tod",
        "offtimesun": "dawn",
        "offtimetod": "10:00",
        "offpropertytype": "msg",
        "offproperty": "payload",
        "offvaluetype": "str",
        "offvalue": "OFF",
        "offoffset": "",
        "offrandomoffset": false,
        "mon": false,
        "tue": false,
        "wed": false,
        "thu": false,
        "fri": false,
        "sat": true,
        "sun": true,
        "x": 170,
        "y": 580,
        "wires": [
            [
                "e96d4ab170b53532"
            ]
        ]
    },
    {
        "id": "1ffaa871.848be8",
        "type": "ui_text_input",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "Start",
        "label": "Start",
        "tooltip": "",
        "group": "85193673.744e38",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "time",
        "delay": "0",
        "topic": "start",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 190,
        "y": 840,
        "wires": [
            [
                "eda3a9b8.dfbd68"
            ]
        ]
    },
    {
        "id": "b761a7dd.a77438",
        "type": "function",
        "z": "dac2cb3b.559138",
        "name": "",
        "func": "function hh_mm_to_ms(hh, mm) {\n    return hh * 3600000 + mm * 60000;\n}\n\nconst last_state = flow.get(\"zirkulationspumpe\");\n\nconst timestamp = new Date();\nconst day_index = timestamp.getDay();\nconst ms = hh_mm_to_ms(timestamp.getHours(), timestamp.getMinutes());\nconst timer = flow.get(\"timer\");\n\nif (timer.wdays.includes(day_index) \n    && ms >= timer.start \n    && ms <= timer.start + 6*60*1000\n    && last_state != \"ON\") {\n    return [{payload: \"ON\"}, {payload: timer}];\n} else\n    return [undefined, {payload: timer}];\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 160,
        "y": 400,
        "wires": [
            [],
            [
                "a3dd6456.ef3838"
            ]
        ]
    },
    {
        "id": "7c405f66.1d519",
        "type": "inject",
        "z": "dac2cb3b.559138",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 360,
        "wires": [
            [
                "b761a7dd.a77438"
            ]
        ]
    },
    {
        "id": "fa434a86.5d1958",
        "type": "ui_dropdown",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "Wochentage",
        "label": "Wochentage",
        "tooltip": "",
        "place": "aus",
        "group": "85193673.744e38",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": true,
        "options": [
            {
                "label": "Mo.",
                "value": "1",
                "type": "str"
            },
            {
                "label": "Di.",
                "value": "2",
                "type": "str"
            },
            {
                "label": "Mi.",
                "value": "3",
                "type": "str"
            },
            {
                "label": "Do.",
                "value": "4",
                "type": "str"
            },
            {
                "label": "Fr.",
                "value": "5",
                "type": "str"
            },
            {
                "label": "Sa.",
                "value": "6",
                "type": "str"
            },
            {
                "label": "So.",
                "value": "0",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "wdays",
        "topicType": "str",
        "className": "",
        "x": 170,
        "y": 880,
        "wires": [
            [
                "c5b32853.08b2b8"
            ]
        ]
    },
    {
        "id": "e5f731f4.2d4b5",
        "type": "debug",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 860,
        "wires": []
    },
    {
        "id": "a3dd6456.ef3838",
        "type": "debug",
        "z": "dac2cb3b.559138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 150,
        "y": 440,
        "wires": []
    },
    {
        "id": "eda3a9b8.dfbd68",
        "type": "function",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "func": "const timer = flow.get(\"timer\") || {start: 0, wdays: []};\n\ntimer.start = msg.payload;\n\nflow.set(\"timer\", timer);\n\nreturn {payload: timer};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 840,
        "wires": [
            [
                "e5f731f4.2d4b5"
            ]
        ]
    },
    {
        "id": "c5b32853.08b2b8",
        "type": "function",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "func": "const timer = flow.get(\"timer\") || {start: 0, wdays: []};\n\ntimer.wdays = msg.payload;\n\nflow.set(\"timer\", timer);\n\nreturn {payload: timer};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 880,
        "wires": [
            [
                "e5f731f4.2d4b5"
            ]
        ]
    },
    {
        "id": "d472b0fb.8234d",
        "type": "ui_template",
        "z": "dac2cb3b.559138",
        "d": true,
        "group": "85193673.744e38",
        "name": "",
        "order": 2,
        "width": "0",
        "height": "0",
        "format": "<md-card ui-card-size=\"6x3\" \n    class=\"_md nr-dashboard-text layout-align-left-left nr-dashboard-widget-text visible\" \n    style=\"color: white; left: 0px; top: 54px; width: 300px; height: 256px;\">\n    <p><b>Normal</b></p><p>Mo.-Fr.: 07.00-08:00</p><p>Sa.-So.: 08:00-10:00</p>\n    <p><b>Urlaub zu Hause</b></p><p>Mo.-So.: 08:00-10:00</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 160,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "a8361f9.97356e",
        "type": "inject",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 660,
        "wires": [
            [
                "d472b0fb.8234d"
            ]
        ]
    },
    {
        "id": "31dbebd8.46ea94",
        "type": "function",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "func": "const timer = flow.get(\"timer\") || {mode: 'normal', start: 0, wdays: []};\n\nreturn {payload: timer.start};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 800,
        "wires": [
            [
                "1ffaa871.848be8"
            ]
        ]
    },
    {
        "id": "9d89bfbf.33214",
        "type": "inject",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 760,
        "wires": [
            [
                "31dbebd8.46ea94"
            ]
        ]
    },
    {
        "id": "d0ebd5ddad78c021",
        "type": "ui_dropdown",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "Modus",
        "label": "Modus",
        "tooltip": "",
        "place": "Select option",
        "group": "85193673.744e38",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Normal",
                "value": "normal",
                "type": "str"
            },
            {
                "label": "Urlaub zu Hause",
                "value": "urlaub",
                "type": "str"
            },
            {
                "label": "Aus",
                "value": "aus",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "mode",
        "topicType": "str",
        "className": "",
        "x": 110,
        "y": 180,
        "wires": [
            [
                "431eec62b4a8ced3"
            ]
        ]
    },
    {
        "id": "4d0ea0476f9b4e31",
        "type": "function",
        "z": "dac2cb3b.559138",
        "name": "",
        "func": "const timer = flow.get(\"timer\");\n\nif (timer.mode == 'normal') {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "e96d4ab170b53532",
        "type": "function",
        "z": "dac2cb3b.559138",
        "name": "",
        "func": "const timer = flow.get(\"timer\");\n\nif (timer.mode != 'aus') {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "292ea6bc48ae4c3c",
        "type": "thingzi-timer",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "Wochentag Urlaub",
        "lat": "50.882",
        "lon": "6.6949",
        "timerType": "trigger",
        "startupMessage": false,
        "ontype": "tod",
        "ontimesun": "dusk",
        "ontimetod": "8:00",
        "onpropertytype": "msg",
        "onproperty": "payload",
        "onvaluetype": "str",
        "onvalue": "ON",
        "onoffset": "",
        "onrandomoffset": false,
        "offtype": "tod",
        "offtimesun": "dawn",
        "offtimetod": "8:00",
        "offpropertytype": "msg",
        "offproperty": "payload",
        "offvaluetype": "str",
        "offvalue": "OFF",
        "offoffset": "",
        "offrandomoffset": false,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": false,
        "sun": false,
        "x": 150,
        "y": 540,
        "wires": [
            [
                "846c18c3ac28e800"
            ]
        ]
    },
    {
        "id": "846c18c3ac28e800",
        "type": "function",
        "z": "dac2cb3b.559138",
        "name": "",
        "func": "const timer = flow.get(\"timer\");\n\nif (timer.mode == 'urlaub') {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "431eec62b4a8ced3",
        "type": "function",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "func": "const timer = flow.get(\"timer\") || {mode: 'normal', start: 0, wdays: []};\n\ntimer.mode = msg.payload;\n\nflow.set(\"timer\", timer);\n\nreturn {payload: timer};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 180,
        "wires": [
            [
                "7d0a12acabacf60e"
            ]
        ]
    },
    {
        "id": "7d0a12acabacf60e",
        "type": "debug",
        "z": "dac2cb3b.559138",
        "d": true,
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 180,
        "wires": []
    },
    {
        "id": "5428f2e53de25092",
        "type": "mqtt in",
        "z": "dac2cb3b.559138",
        "name": "",
        "topic": "zigbee2mqtt/fernbedienung_bad",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 300,
        "wires": [
            [
                "df199e6fb3a59d4f"
            ]
        ]
    },
    {
        "id": "df199e6fb3a59d4f",
        "type": "template",
        "z": "dac2cb3b.559138",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "ON",
        "output": "str",
        "x": 440,
        "y": 280,
        "wires": [
            [
                "df2bfb8e940b1768"
            ]
        ]
    },
    {
        "id": "df2bfb8e940b1768",
        "type": "ui_switch",
        "z": "dac2cb3b.559138",
        "name": "Zirkulationspumpe (10min)",
        "label": "Zirkulationspumpe (10min)",
        "tooltip": "",
        "group": "10c3f1d2.4cdbde",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "zirkulationspumpe_10min",
        "topicType": "str",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 680,
        "y": 420,
        "wires": [
            [
                "7b56cfeb.46625",
                "2e8b20cfb2c1a46d",
                "1bd61820f04bb24e"
            ]
        ]
    },
    {
        "id": "351c32062e77392a",
        "type": "trigger",
        "z": "dac2cb3b.559138",
        "name": "Treppenhausautomat 10min",
        "op1": "",
        "op2": "OFF",
        "op1type": "nul",
        "op2type": "str",
        "duration": "10",
        "extend": false,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 1120,
        "y": 420,
        "wires": [
            [
                "df2bfb8e940b1768"
            ]
        ]
    },
    {
        "id": "2e8b20cfb2c1a46d",
        "type": "function",
        "z": "dac2cb3b.559138",
        "name": "filter ON",
        "func": "if (msg.payload === \"ON\")\n    return {payload: \"ON\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 920,
        "y": 420,
        "wires": [
            [
                "351c32062e77392a"
            ]
        ]
    },
    {
        "id": "1bd61820f04bb24e",
        "type": "debug",
        "z": "dac2cb3b.559138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 340,
        "wires": []
    },
    {
        "id": "e91d70892415c84f",
        "type": "mqtt in",
        "z": "dac2cb3b.559138",
        "name": "",
        "topic": "zigbee2mqtt/fernbedienung_bad_dg",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 260,
        "wires": [
            [
                "df199e6fb3a59d4f"
            ]
        ]
    },
    {
        "id": "e8dbd15a.75976",
        "type": "mqtt out",
        "z": "4fa3b184.bc7fb",
        "name": "Red",
        "topic": "luftguetemesser1/switch/red/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 610,
        "y": 200,
        "wires": []
    },
    {
        "id": "f1103c8a.63b5b",
        "type": "mqtt out",
        "z": "4fa3b184.bc7fb",
        "name": "Yellow",
        "topic": "luftguetemesser1/switch/yellow/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 610,
        "y": 240,
        "wires": []
    },
    {
        "id": "d860fe10.a5025",
        "type": "mqtt out",
        "z": "4fa3b184.bc7fb",
        "name": "Green",
        "topic": "luftguetemesser1/switch/green/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 610,
        "y": 280,
        "wires": []
    },
    {
        "id": "6ecf7aad.502114",
        "type": "function",
        "z": "4fa3b184.bc7fb",
        "name": "",
        "func": "const temp = global.get(\"luftguetemesser1-temperature\");\nconst hum = global.get(\"luftguetemesser1-humidity\");\nconst abs_hum = global.get(\"luftguetemesser1-absolute_humidity\");\nconst press = global.get(\"luftguetemesser1-pressure\");\nconst iaq = global.get(\"luftguetemesser1-iaq\");\nconst co2 = global.get(\"luftguetemesser1-co2\");\nconst voc = global.get(\"luftguetemesser1-voc\");\nconst m10 = global.get(\"luftguetemesser1-10m\");\nconst m25 = global.get(\"luftguetemesser1-25m\");\nconst m100 = global.get(\"luftguetemesser1-100m\");\nconst ampel_leds = flow.get(\"luftguetemesser1_ampel_leds\");\n\nvar red = {payload: \"OFF\"};\nvar yellow = {payload: \"OFF\"};\nvar green = {payload: \"OFF\"};\n\nif (ampel_leds == \"ON\") {\n    if (voc < 100 && m10 < 25 && m25 < 25 && m100 < 25 && co2 < 700) {\n        green = {payload: \"ON\"};\n    } else if (voc > 200 || m10 > 40 || m25 > 40 || m100 > 40 || co2 > 2000) {\n        red = {payload: \"ON\"};\n    } else {\n        yellow = {payload: \"ON\"};\n    }\n}\n\nvar debug = {\n    temp: temp,\n    hum: hum,\n    abs_hum: abs_hum,\n    press: press,\n    iaq: iaq,\n    co2: co2,\n    voc: voc,\n    m10: m10,\n    m25: m25,\n    m100: m100,\n    red: red,\n    yellow: yellow,\n    gree: green\n};\n\nconst intl = global.get('intl');\nconst format = intl.NumberFormat('de-De',{style:'decimal', maximumFractionDigits: 2}).format;\nconst sprintf = global.get(\"sprintf\");\n\nvar voc_status = {payload: {}};\nvar matter_status = {payload: {}};\nvar co2_status = {payload: {}};\n\nif (voc < 100) {\n    voc_status.payload = {value: \"Flüchtige org. Verbindungen\", color: \"limegreen\", text: sprintf(\"%s ppm\", format(voc))};\n} else if (voc > 200) {\n    voc_status.payload = {value: \"Flüchtige org. Verbindungen\", color: \"red\", text: sprintf(\"%s ppm\", format(voc))};\n} else {\n    voc_status.payload = {value: \"Flüchtige org. Verbindungen\", color: \"yellow\", text: sprintf(\"%s ppm\", format(voc))};\n}\n\nif (m10 < 25 && m25 < 25 && m100 < 25) {\n    matter_status.payload = {value: \"Feinstaub\", color: \"limegreen\", text1: sprintf(\"1,0 µm: %s ppm\", format(m10)), text2: sprintf(\"2,5 µm: %s ppm\", format(m25)), text3: sprintf(\"10 µm: %s ppm\", format(m100))};\n} else if (m10 > 200 || m25 > 200 || m100 > 200) {\n    matter_status.payload = {value: \"Feinstaub\", color: \"red\", text1: sprintf(\"1,0 µm: %s ppm\", format(m10)), text2: sprintf(\"2,5 µm: %s ppm\", format(m25)), text3: sprintf(\"10 µm: %s ppm\", format(m100))};\n} else {\n    matter_status.payload = {value: \"Feinstaub\", color: \"yellow\", text1: sprintf(\"1,0 µm: %s ppm\", format(m10)), text2: sprintf(\"2,5 µm: %s ppm\", format(m25)), text3: sprintf(\"10 µm: %s ppm\", format(m100))};\n}\n\nif (co2 < 700) {\n    co2_status.payload = {value: \"CO2\", color: \"limegreen\", text: sprintf(\"%s ppm\", format(co2))};\n} else if (co2 > 2000) {\n    co2_status.payload = {value: \"CO2\", color: \"red\", text: sprintf(\"%s ppm\", format(co2))};\n} else {\n    co2_status.payload = {value: \"CO2\", color: \"yellow\", text: sprintf(\"%s ppm\", format(co2))};\n}\n\n\nreturn [red, yellow, green, debug, voc_status, matter_status, co2_status];\n",
        "outputs": 7,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 340,
        "wires": [
            [
                "e8dbd15a.75976"
            ],
            [
                "f1103c8a.63b5b"
            ],
            [
                "d860fe10.a5025"
            ],
            [
                "5616c163.a87f9"
            ],
            [
                "23f6c6bd.14f54a"
            ],
            [
                "236c8c27.2d41a4"
            ],
            [
                "d7d58dae.c7b95"
            ]
        ]
    },
    {
        "id": "49d727fe.737a88",
        "type": "inject",
        "z": "4fa3b184.bc7fb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 340,
        "wires": [
            [
                "6ecf7aad.502114"
            ]
        ]
    },
    {
        "id": "5616c163.a87f9",
        "type": "debug",
        "z": "4fa3b184.bc7fb",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 340,
        "wires": []
    },
    {
        "id": "23f6c6bd.14f54a",
        "type": "ui_template",
        "z": "4fa3b184.bc7fb",
        "group": "d796a540.50d378",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"value\">{{msg.payload.value}}</p><p>{{msg.payload.text}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 620,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "236c8c27.2d41a4",
        "type": "ui_template",
        "z": "4fa3b184.bc7fb",
        "group": "d796a540.50d378",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"value\">{{msg.payload.value}}</p><p>{{msg.payload.text1}}<br/>{{msg.payload.text2}}<br/>{{msg.payload.text3}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 620,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "d7d58dae.c7b95",
        "type": "ui_template",
        "z": "4fa3b184.bc7fb",
        "group": "d796a540.50d378",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"value\">{{msg.payload.value}}</p><p>{{msg.payload.text}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 620,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "2708d55425c59e16",
        "type": "ui_switch",
        "z": "4fa3b184.bc7fb",
        "name": "",
        "label": "Ampel LEDs",
        "tooltip": "",
        "group": "d796a540.50d378",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "ON",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "OFF",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 390,
        "y": 540,
        "wires": [
            [
                "e900238e3614c29c"
            ]
        ]
    },
    {
        "id": "e900238e3614c29c",
        "type": "change",
        "z": "4fa3b184.bc7fb",
        "name": "store in flow",
        "rules": [
            {
                "t": "set",
                "p": "luftguetemesser1_ampel_leds",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "12ebb575.a874db",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "3825ae1b.6847c2",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "Lüftungsempfehlung",
        "func": "const name = msg.payload.name;\n\nconst temperature = global.get(name + \"-temperature\");\nconst humidity = global.get(name + \"-humidity\");\nconst abs_humidity = global.get(name + \"-absolute_humidity\");\nconst last_abs_humidity_gt_outside_abs_humidity = global.get(name + \"-last_abs_humidity_gt_outside_abs_humidity\");\nconst outside_abs_humidity = global.get(\"aussen-absolute_humidity\");\n\nconst room_abs_humidity_gt_outside_abs_humidity = (last_abs_humidity_gt_outside_abs_humidity) ?\n    abs_humidity > outside_abs_humidity * 1.05:\n    abs_humidity > outside_abs_humidity;\n\nglobal.set(name + \"-last_abs_humidity_gt_outside_abs_humidity\", abs_humidity > outside_abs_humidity);\n\nconst intl = global.get('intl');\nconst format = intl.NumberFormat('de-De',{style:'decimal', maximumFractionDigits: 2}).format;\nconst sprintf = global.get(\"sprintf\");\nconst text = sprintf(\"%s °C, %s %% H, %s g/m³\", format(temperature), format(humidity), format(abs_humidity))\n\nvar payload;\nif (room_abs_humidity_gt_outside_abs_humidity) {\n    if (humidity > 65) {\n        payload = {payload: {name: name, color: \"skyblue\", hint: \"Raum feucht. Lüften!\", text: text}};\n    } else {\n        payload = {payload: {name: name, color: \"limegreen\", hint: \"Raum ausreichend trocken.\", text: text}};\n    }\n} else {\n    payload = {payload: {name: name, color: \"red\", hint: \"Draußen zu feucht. Nur kurz lüften!\", text: text}};\n}\n\nconst debug = {\n    name: name,\n    temperature: temperature,\n    humidity: humidity,\n    abs_humidity: abs_humidity,\n    outside_abs_humidity: outside_abs_humidity,\n    last_abs_humidity_gt_outside_abs_humidity: last_abs_humidity_gt_outside_abs_humidity,\n    room_abs_humidity_gt_outside_abs_humidity: room_abs_humidity_gt_outside_abs_humidity,\n    text: text\n};\n\nreturn [payload, debug];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 560,
        "wires": [
            [
                "dac326a7.c5d638"
            ],
            [
                "755cd8db.bac358"
            ]
        ]
    },
    {
        "id": "89e98409.0b1d08",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "8fc7d555.415c28",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 5,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "8f4a8f67.f0316",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "",
        "func": "const hint = msg.payload.hint;\nconst text = msg.payload.text;\n\nconst lh = flow.get(\"lueftungsempfehlungen_hint\") || {};\n\nif (lh != hint) {\n    flow.set(\"lueftungsempfehlungen_hint\", hint);\n    return {payload: `${hint}\\n${text}\\nmehr: http://dipe-pi:1880/ui/#!/7?socketid=xoYPAh22ZP1gOFpmAAAA`};\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 860,
        "y": 320,
        "wires": [
            [
                "bea87736.5db2d8"
            ]
        ]
    },
    {
        "id": "bea87736.5db2d8",
        "type": "hangoutChatBot",
        "z": "2788b93b.8a2f56",
        "hangoutsCertificate": "10925253.f46f4e",
        "roomid": "spaces/-fp3jQAAAAE",
        "roomname": "spaces/-fp3jQAAAAE",
        "contentproperty": "payload",
        "contenttype": "msg",
        "x": 1020,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "2bf53ce9.7aa234",
        "type": "switch",
        "z": "2788b93b.8a2f56",
        "name": "",
        "property": "payload.name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "aussen",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "treppenhaus_keller",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "fahrradkeller",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "waschkueche_luefter",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "luftguetemesser1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "kueche",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "speisekammer",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "wozi",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "gaeste_wc",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "zwitscherbox-bad",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "büro_og",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "schlafzimmer",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ankleidezimmer",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "bad_dg",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "luftfeuchtemesser1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "schlafzimmer_dg",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 16,
        "x": 1090,
        "y": 520,
        "wires": [
            [
                "5221a0c4.27e25"
            ],
            [
                "12ebb575.a874db"
            ],
            [
                "89e98409.0b1d08"
            ],
            [
                "8fc7d555.415c28"
            ],
            [
                "c91d5cbf.ecc24"
            ],
            [
                "740dd7e9.4e3008"
            ],
            [
                "f9ee87ab.ae2d38"
            ],
            [
                "f1e82e9a.000e8"
            ],
            [
                "961cf428.5c8238"
            ],
            [
                "668c6b28.38a1c4"
            ],
            [
                "593cbcc1.6b4944"
            ],
            [
                "4010afc2.28a54"
            ],
            [
                "7ebcce878d52151f"
            ],
            [
                "b4af6219f2a77569"
            ],
            [
                "33b1161152456aae"
            ],
            [
                "9e24a05859ccbb80"
            ]
        ]
    },
    {
        "id": "c91d5cbf.ecc24",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 6,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "740dd7e9.4e3008",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 7,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "f1e82e9a.000e8",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 9,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "961cf428.5c8238",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 10,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "5221a0c4.27e25",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "d083875c.561678",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall klima draußen",
        "func": "const name = \"aussen\";\n\nconst temperature = global.get(name + \"-temperature\");\nconst humidity = global.get(name + \"-humidity\");\nconst abs_humidity = global.get(name + \"-absolute_humidity\");\nconst last_abs_humidity = global.get(name + \"-last_abs_humidity\");\nglobal.set(name + \"-last_abs_humidity\", abs_humidity);\n\n//node.warn(name)\n//node.warn(temperature)\n//node.warn(humidity)\n//node.warn(abs_humidity)\n//node.warn(last_abs_humidity_gt_outside_abs_humidity)\n//node.warn(outside_abs_humidity)\n\nconst intl = global.get('intl');\nconst format = intl.NumberFormat('de-De',{style:'decimal', maximumFractionDigits: 2}).format;\nconst sprintf = global.get(\"sprintf\");\nconst text = sprintf(\"%s °C, %s %% H, %s g/m³\", format(temperature), format(humidity), format(abs_humidity))\n\nif        (abs_humidity >= 13) {\n    return {payload: {name: name, color: \"deepskyblue\", hint: \"Draußen ist es sehr feucht.\", text: text}};\n} else if (abs_humidity >= 12 && abs_humidity < 13) {\n    return {payload: {name: name, color: \"skyblue\", hint: \"Draußen ist es feucht.\", text: text}};\n} else if (abs_humidity >= 11 && abs_humidity < 12) {\n    return {payload: {name: name, color: \"limegreen\", hint: \"Draußen ist einigermaßen trocken.\", text: text}};\n} else if (abs_humidity < 11) {\n    return {payload: {name: name, color: \"YellowGreen\", hint: \"Draußen ist es trocken.\", text: text}};\n} else {\n    return {payload: {name: name, color: \"DarkSeaGreen\", hint: \"Draußen ist es sehr trocken.\", text: text}};\n}\n\n// if (last_abs_humidity >= 13 && abs_humidity >= 13 ||\n//     last_abs_humidity < 13 && abs_humidity > 13 * 1.10) {\n//     return { payload: { name: name, color: \"deepskyblue\", hint: \"Draußen ist es sehr feucht.\", text: text } };\n// } else if (last_abs_humidity > 13 && abs_humidity < 13 / 1.10 && abs_humidity > 12 ||\n//     last_abs_humidity <= 13 && last_abs_humidity >= 12 && abs_humidity <= 13 && abs_humidity >= 12 ||\n//     last_abs_humidity < 12 && abs_humidity > 12 * 1.10 && abs_humidity < 13) {\n//     return { payload: { name: name, color: \"skyblue\", hint: \"Draußen ist es feucht.\", text: text } };\n// } else if (last_abs_humidity > 12 && abs_humidity < 12 / 1.10 && abs_humidity > 11 ||\n//     last_abs_humidity <= 12 && last_abs_humidity >= 11 && abs_humidity <= 12 && abs_humidity >= 11 ||\n//     last_abs_humidity < 11 && abs_humidity > 11 * 1.10 && abs_humidity < 12) {\n//     return { payload: { name: name, color: \"limegreen\", hint: \"Draußen ist einigermaßen trocken.\", text: text } };\n// } else if (last_abs_humidity > 11 && abs_humidity < 11 / 1.10 ||\n//     last_abs_humidity <= 11 && abs_humidity <= 11) {\n//     return { payload: { name: name, color: \"YellowGreen\", hint: \"Draußen ist es trocken.\", text: text } };\n// } else {\n//     return { payload: { name: name, color: \"DarkSeaGreen\", hint: \"Draußen ist es sehr trocken.\", text: text } };\n// }\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 380,
        "wires": [
            [
                "dac326a7.c5d638"
            ]
        ]
    },
    {
        "id": "593cbcc1.6b4944",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "3fc26a03.2a8a06",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall zwitscherbox klima",
        "func": "const name = \"zwitscherbox-bad\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 420,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "3bab439b.dca5ec",
        "type": "inject",
        "z": "2788b93b.8a2f56",
        "name": "each 5 minutes",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 540,
        "wires": [
            [
                "3fc26a03.2a8a06",
                "d083875c.561678",
                "19b316c1.d916e9",
                "dc465da3.9f075",
                "1f972c48.e2ab94",
                "f54e3c81.4c057",
                "f477863d.bbbe58",
                "6604bb11.21e7b4",
                "800e50b3.1cd8f",
                "d97bb3fb.f95d7",
                "febd2e38.1a2e1",
                "48f55ed2.c2f68",
                "fe0cab1575d624e5",
                "0b3e08059fd963b5",
                "7359385faca6d84e",
                "0bed57233aab0d43"
            ]
        ]
    },
    {
        "id": "40d6912.e35a67",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "initialize names-rooms mapping",
        "func": "const room = global.set(\"names_rooms\", {\n    \"zwitscherbox-bad\": \"Bad\",\n    \"luftguetemesser1\": \"Werkstatt\",\n    \"gaeste_wc\": \"Gäste-WC\",\n    \"waschkueche_luefter\": \"Waschküche\",\n    \"wozi\": \"Wohnzimmer\",\n    \"kueche\": \"Küche\",\n    \"aussen\": \"Draußen\",\n    \"luftfeuchtemesser1\": \"Büro Peter\",\n    \"büro_og\": \"Büro Angelika\",\n    \"schlafzimmer_dg\": \"Schalfzimmer Emma\",\n    \"bad_dg\": \"Bad Emma\",\n});\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "2fa070d.b96fb9",
        "type": "inject",
        "z": "2788b93b.8a2f56",
        "name": "Reset",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 170,
        "y": 220,
        "wires": [
            [
                "40d6912.e35a67"
            ]
        ]
    },
    {
        "id": "dac326a7.c5d638",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "add room",
        "func": "const name = msg.payload.name;\nconst names_rooms = global.get(\"names_rooms\");\nvar room = names_rooms[name] || name;\nroom = room\n    .split('_')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n    \nmsg.payload.room = room;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 860,
        "y": 520,
        "wires": [
            [
                "2bf53ce9.7aa234"
            ]
        ]
    },
    {
        "id": "19b316c1.d916e9",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall gaeste_wc klima",
        "func": "const name = \"gaeste_wc\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 400,
        "y": 460,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "dc465da3.9f075",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall waschkueche_luefter klima",
        "func": "const name = \"waschkueche_luefter\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 500,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "1f972c48.e2ab94",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall fahrradkeller klima",
        "func": "const name = \"fahrradkeller\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 410,
        "y": 540,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "f54e3c81.4c057",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall treppenhaus_keller klima",
        "func": "const name = \"treppenhaus_keller\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 580,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "f477863d.bbbe58",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall wozi klima",
        "func": "const name = \"wozi\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 380,
        "y": 660,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "6604bb11.21e7b4",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall kueche klima",
        "func": "const name = \"kueche\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 390,
        "y": 700,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "800e50b3.1cd8f",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall schlafzimmer klima",
        "func": "const name = \"schlafzimmer\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 410,
        "y": 780,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "febd2e38.1a2e1",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall werkstatt (luftguetemesser1) klima",
        "func": "const name = \"luftguetemesser1\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 460,
        "y": 620,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "d97bb3fb.f95d7",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall speisekammer klima",
        "func": "const name = \"speisekammer\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 420,
        "y": 740,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "668c6b28.38a1c4",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 11,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "f9ee87ab.ae2d38",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 8,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "95ffdad4.8bfbc8",
        "type": "time-of-day",
        "z": "2788b93b.8a2f56",
        "name": "",
        "startTime": "07:30:00",
        "endTime": "23:30:00",
        "outputs": 2,
        "x": 690,
        "y": 340,
        "wires": [
            [
                "8f4a8f67.f0316"
            ],
            [
                "b9dc6788.b603b8"
            ]
        ]
    },
    {
        "id": "b9dc6788.b603b8",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "",
        "func": "flow.set(\"lueftungsempfehlungen_hint\", '');\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 860,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "755cd8db.bac358",
        "type": "debug",
        "z": "2788b93b.8a2f56",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 600,
        "wires": []
    },
    {
        "id": "48f55ed2.c2f68",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall Büro DG (luftfeuchtemesser1) klima",
        "func": "const name = \"luftfeuchtemesser1\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 940,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "4010afc2.28a54",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "fe0cab1575d624e5",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall schlafzimmer dg klima",
        "func": "const name = \"schlafzimmer_dg\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 900,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "0b3e08059fd963b5",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall bad dg klima",
        "func": "const name = \"bad_dg\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 820,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "7359385faca6d84e",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall büro og klima",
        "func": "const name = \"büro_og\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 860,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "7ebcce878d52151f",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "b4af6219f2a77569",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "33b1161152456aae",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1300,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "0bed57233aab0d43",
        "type": "function",
        "z": "2788b93b.8a2f56",
        "name": "recall Büro DG (luftfeuchtemesser1) klima",
        "func": "const name = \"ankleidezimmer\";\nreturn {\n    payload: {\n        name: name,\n        humidity: global.get(`${name}-humidity`),\n        absolute_humidity: global.get(`${name}-absolute_humidity`),\n        tempeature: global.get(`${name}-temperature`)\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 980,
        "wires": [
            [
                "3825ae1b.6847c2"
            ]
        ]
    },
    {
        "id": "9e24a05859ccbb80",
        "type": "ui_template",
        "z": "2788b93b.8a2f56",
        "group": "245ec0f9.12765",
        "name": "",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "<md-card ui-card-size=\"6x2\" \n    class=\"_md nr-dashboard-text layout-align-center-center nr-dashboard-widget-text visible\" \n    style=\"background-color: {{msg.payload.color}}; color: black; left: 0px; top: 54px; width: 300px; height: 96px;\">\n    <p class=\"label\">{{msg.payload.room}}</p><p>{{msg.payload.text}}</p> <p class=\"value\">{{msg.payload.hint}}</p>\n</md-card>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1300,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "fc831115.7e04a",
        "type": "mqtt in",
        "z": "d0173d54.941d7",
        "name": "",
        "topic": "+/+/+/state",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 160,
        "y": 200,
        "wires": [
            [
                "681998dd.099198"
            ]
        ]
    },
    {
        "id": "faa25f7f.0777",
        "type": "influxdb out",
        "z": "d0173d54.941d7",
        "influxdb": "bf6b9b61f49db1aa",
        "name": "InfluxDB",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "adh29",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "dipe",
        "bucket": "adh29-forever",
        "x": 1020,
        "y": 380,
        "wires": []
    },
    {
        "id": "681998dd.099198",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "ESPHOME to InfluxDB",
        "func": "const tokens = msg.topic.split(\"/\");\n\nif (tokens[1] == \"debug\") {\n    return;\n}\n\nvar value;\nif(/^(\\-|\\+)?([0-9]+(\\.[0-9]+)?)$/.test(msg.payload)) {\n  value = Number(msg.payload);\n} else {\n  value = msg.payload;\n}\n\nif (value === \"nan\" || value === undefined || value === null) {\n    return;\n}\n\nconst measurement = tokens[0].replace('-', '_');\n\nmsg.measurement = measurement;\nmsg.payload = {};\nmsg.payload[tokens[2]] = value;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 180,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "6d729e00.24b394",
        "type": "mqtt in",
        "z": "d0173d54.941d7",
        "name": "",
        "topic": "zigbee2mqtt/+",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 180,
        "y": 380,
        "wires": [
            [
                "54e7d479.9e81bc"
            ]
        ]
    },
    {
        "id": "fa0231fe.d86ab",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "ZIGBEE2MQTT to InfluxDB",
        "func": "function flatItem(base, key, src, dest) {\n     if (typeof src === 'undefined') {\n         return;\n     }\n     const deepKey = base.length ? base + '.' + key : key;\n     // console.log(`base=${base} key=${key} deepKey=${deepKey}`);\n     if (typeof src === 'object') {\n        if (Array.isArray(src)) {\n            src.forEach((val, idx) => flatItem(deepKey, idx, val, dest));\n        } else {\n            Object.entries(src).forEach(([key, val]) => flatItem(deepKey, key, val, dest))\n        }\n     } else {\n        dest[deepKey] = src;\n     }\n}\n\nlet deSerialize = {};\nlet deep = msg.payload;\nlet value; \ntry {\n    deep = JSON.parse(msg.payload);\n    if (typeof deep == 'object') {\n        flatItem('', '', deep, deSerialize);\n    } else {\n       deSerialize.value = deep; \n    }\n} catch (e) {\n}\n\nconst tokens = msg.topic.split(\"/\");\nconst measurement = tokens[1].replace(/ /g, '_').toLowerCase();\nmsg.measurement = measurement;\nmsg.payload = deSerialize;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 660,
        "y": 380,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "56b0182.c2cb1e8",
        "type": "mqtt in",
        "z": "d0173d54.941d7",
        "name": "",
        "topic": "+/+/+/command",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 180,
        "y": 240,
        "wires": [
            [
                "681998dd.099198"
            ]
        ]
    },
    {
        "id": "fb23ed2a.5d3d1",
        "type": "mqtt in",
        "z": "d0173d54.941d7",
        "name": "",
        "topic": "+/debug",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 160,
        "y": 160,
        "wires": [
            [
                "681998dd.099198"
            ]
        ]
    },
    {
        "id": "9c0d621e.c88d8",
        "type": "mqtt in",
        "z": "d0173d54.941d7",
        "name": "",
        "topic": "+/uptime",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "inputs": 0,
        "x": 160,
        "y": 120,
        "wires": [
            [
                "681998dd.099198"
            ]
        ]
    },
    {
        "id": "7c6e00fe.37756",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "SDL counter to InfluxDB",
        "func": "const value = msg.payload;\nmsg.measurement = \"stromzähler\";\nmsg.payload = {};\nmsg.payload[\"counter\"] = value;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 560,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "e9ca4023.2c05e",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "SDL consumption to InfluxDB",
        "func": "const value = msg.payload;\nmsg.measurement = \"stromzähler\";\nmsg.payload = {};\nmsg.payload[\"consumption\"] = value;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 600,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "cbdd2a4.e9dcad8",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "",
        "links": [
            "8452f01b.9b7a2"
        ],
        "x": 415,
        "y": 560,
        "wires": [
            [
                "7c6e00fe.37756"
            ]
        ]
    },
    {
        "id": "cf2bd5c4.367d88",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "",
        "links": [
            "ea99ed95.a6b5f"
        ],
        "x": 415,
        "y": 600,
        "wires": [
            [
                "e9ca4023.2c05e"
            ]
        ]
    },
    {
        "id": "c464d2a1.b031e",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "",
        "links": [
            "678631ab.fe1bb"
        ],
        "x": 415,
        "y": 700,
        "wires": [
            [
                "18f89cba.858903"
            ]
        ]
    },
    {
        "id": "e94f62b.6a086a",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "",
        "links": [
            "9d0190fe.0d3fe"
        ],
        "x": 415,
        "y": 740,
        "wires": [
            [
                "2e920011.62b1e"
            ]
        ]
    },
    {
        "id": "18f89cba.858903",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "DSL downstream to InfluxDB",
        "func": "var value = msg.payload;\nmsg.payload = {downstream: value};\nmsg.measurement = \"dsl\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 700,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "2e920011.62b1e",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "DSL upstream to InfluxDB",
        "func": "var value = msg.payload;\nmsg.payload = {upstream: value};\nmsg.measurement = \"dsl\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 740,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "d7a58b62.d342b8",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "openweather to InfluxDB",
        "func": "msg.measurement = \"open_weather\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 800,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "9b9574d4.b3d108",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "openweather",
        "links": [
            "8a37748d46ba0dbf"
        ],
        "x": 415,
        "y": 800,
        "wires": [
            [
                "d7a58b62.d342b8"
            ]
        ]
    },
    {
        "id": "4708a180.a07a",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "JSON to InfluxDB",
        "links": [
            "7b4ce70.b1fd818",
            "aa7a4964.384d28",
            "afb0333e.affc6",
            "0f68dc3afdaa2f7f",
            "61153b6e98049a2e"
        ],
        "x": 415,
        "y": 460,
        "wires": [
            [
                "bc2288b2.755178"
            ]
        ]
    },
    {
        "id": "54e7d479.9e81bc",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "Filter Sensors",
        "func": "if (!msg.topic.match(/aqara_smart|gas_zaehler/)) {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 380,
        "y": 380,
        "wires": [
            [
                "fa0231fe.d86ab"
            ]
        ]
    },
    {
        "id": "bc2288b2.755178",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "JSON to InfluxDB",
        "func": "const tokens = msg.topic.split(\"/\");\nconst measurement = tokens[1] || tokens[0];\nmsg.measurement = measurement.replace(/ /g, '_').toLowerCase();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 460,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "2433e1cc815bb8e6",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "Shellies to Influxdb",
        "func": "const tokens = msg.topic.split(\"/\");\n\nvar value;\nif(/^(\\-|\\+)?([0-9]+(\\.[0-9]+)?)$/.test(msg.payload)) {\n  value = Number(msg.payload);\n} else {\n  value = msg.payload;\n}\n\nif (value === \"nan\" || value === undefined || value === null) {\n    return;\n}\n\nconst measurement = tokens[1].replace(/\\-/g, '_');\n\nmsg.measurement = measurement;\nmsg.payload = {};\nif (tokens.length > 4) {\n    if (tokens[2] === \"emeter\") {\n        const L = Number(tokens[3]) + 1;\n        msg.payload[\"L\" + L + \"_\" + tokens[4]] = value;\n    } else {\n        msg.payload[\"relay\" + tokens[3] + \"_\" + tokens[4]] = value;\n    }\n} else if (tokens.length > 3) {\n    msg.payload[tokens[2] + tokens[3]] = value;\n} else {\n    msg.payload[tokens[2]] = value;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 320,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "fb1d1c15841f2b0a",
        "type": "mqtt in",
        "z": "d0173d54.941d7",
        "name": "",
        "topic": "shellies/#",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 320,
        "wires": [
            [
                "2433e1cc815bb8e6"
            ]
        ]
    },
    {
        "id": "91d756784b44f0df",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "AI on the edge to InfluxDB",
        "func": "const tokens = msg.topic.split(\"/\");\nconst measurement = tokens[0];\nmsg.measurement = measurement.replace(/ /g, '_').toLowerCase();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 500,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "223c8bb042a5a36b",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "AI on the edge to InfluxDB",
        "links": [
            "b362144e6d02d6d4"
        ],
        "x": 415,
        "y": 500,
        "wires": [
            [
                "91d756784b44f0df"
            ]
        ]
    },
    {
        "id": "e09cb821aca323d1",
        "type": "function",
        "z": "d0173d54.941d7",
        "name": "Solarertrag",
        "func": "msg.measurement = \"solarertrag\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 640,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "49152127e918c9d7",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "Einspeisung",
        "links": [
            "4d932a70ca858354",
            "1b836d09c69d552f",
            "e8000a58ec07a97e"
        ],
        "x": 415,
        "y": 640,
        "wires": [
            [
                "e09cb821aca323d1"
            ]
        ]
    },
    {
        "id": "1df2986a56225244",
        "type": "link in",
        "z": "d0173d54.941d7",
        "name": "influxdb",
        "links": [
            "9a213e7f538e9cae"
        ],
        "x": 875,
        "y": 280,
        "wires": [
            [
                "faa25f7f.0777"
            ]
        ]
    },
    {
        "id": "b0c2185455845eab",
        "type": "ui_switch",
        "z": "559aac41a5cf74c4",
        "name": "",
        "label": "600W",
        "tooltip": "",
        "group": "f4c6c5353740e204",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "on",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "off",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 450,
        "y": 100,
        "wires": [
            [
                "da4a469d8344edbb",
                "531910955e8efef5",
                "fb3ddf83da531e33"
            ]
        ]
    },
    {
        "id": "fb3ddf83da531e33",
        "type": "mqtt out",
        "z": "559aac41a5cf74c4",
        "name": "",
        "topic": "shellies/shellyplug-s-D9D98A/relay/0/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 780,
        "y": 100,
        "wires": []
    },
    {
        "id": "60ffb0aba571e88d",
        "type": "ui_switch",
        "z": "559aac41a5cf74c4",
        "name": "",
        "label": "1200W",
        "tooltip": "",
        "group": "f4c6c5353740e204",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "on",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "off",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 460,
        "y": 360,
        "wires": [
            [
                "ae7875fc8d01a17a",
                "6db95c48eb02d3d7",
                "bdf0b95fa9293b45"
            ]
        ]
    },
    {
        "id": "bdf0b95fa9293b45",
        "type": "mqtt out",
        "z": "559aac41a5cf74c4",
        "name": "",
        "topic": "shellies/shellyplug-s-F13595/relay/0/command",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 780,
        "y": 360,
        "wires": []
    },
    {
        "id": "643ce35e172881c8",
        "type": "mqtt in",
        "z": "559aac41a5cf74c4",
        "name": "",
        "topic": "shellies/shellyplug-s-D9D98A/relay/0",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 220,
        "y": 100,
        "wires": [
            [
                "b0c2185455845eab"
            ]
        ]
    },
    {
        "id": "0215ba7d3ea6bbfc",
        "type": "mqtt in",
        "z": "559aac41a5cf74c4",
        "name": "",
        "topic": "shellies/shellyplug-s-F13595/relay/0",
        "qos": "2",
        "datatype": "auto",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 220,
        "y": 360,
        "wires": [
            [
                "60ffb0aba571e88d"
            ]
        ]
    },
    {
        "id": "da4a469d8344edbb",
        "type": "function",
        "z": "559aac41a5cf74c4",
        "name": "filter on",
        "func": "if (msg.payload === \"on\")\n    return {payload: \"on\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 140,
        "wires": [
            [
                "7a5699533a2b6543"
            ]
        ]
    },
    {
        "id": "7a5699533a2b6543",
        "type": "trigger",
        "z": "559aac41a5cf74c4",
        "name": "Treppenhausautomat 1h",
        "op1": "",
        "op2": "off",
        "op1type": "nul",
        "op2type": "str",
        "duration": "1",
        "extend": false,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 870,
        "y": 140,
        "wires": [
            [
                "b0c2185455845eab"
            ]
        ]
    },
    {
        "id": "9a609221ad91e84e",
        "type": "change",
        "z": "559aac41a5cf74c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "reset",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 180,
        "wires": [
            [
                "7a5699533a2b6543"
            ]
        ]
    },
    {
        "id": "531910955e8efef5",
        "type": "function",
        "z": "559aac41a5cf74c4",
        "name": "filter off",
        "func": "if (msg.payload === \"off\")\n    return {payload: \"off\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 180,
        "wires": [
            [
                "9a609221ad91e84e"
            ]
        ]
    },
    {
        "id": "ae7875fc8d01a17a",
        "type": "function",
        "z": "559aac41a5cf74c4",
        "name": "filter on",
        "func": "if (msg.payload === \"on\")\n    return {payload: \"on\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 400,
        "wires": [
            [
                "13d23de0dd6aedb7"
            ]
        ]
    },
    {
        "id": "13d23de0dd6aedb7",
        "type": "trigger",
        "z": "559aac41a5cf74c4",
        "name": "Treppenhausautomat 1h",
        "op1": "",
        "op2": "off",
        "op1type": "nul",
        "op2type": "str",
        "duration": "1",
        "extend": false,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 870,
        "y": 400,
        "wires": [
            [
                "60ffb0aba571e88d"
            ]
        ]
    },
    {
        "id": "a8db2b8520cacc58",
        "type": "change",
        "z": "559aac41a5cf74c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "reset",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 440,
        "wires": [
            [
                "13d23de0dd6aedb7"
            ]
        ]
    },
    {
        "id": "6db95c48eb02d3d7",
        "type": "function",
        "z": "559aac41a5cf74c4",
        "name": "filter off",
        "func": "if (msg.payload === \"off\")\n    return {payload: \"off\"}\nelse\n    return undefined;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 440,
        "wires": [
            [
                "a8db2b8520cacc58"
            ]
        ]
    },
    {
        "id": "5491f3b7aa1d4a3f",
        "type": "nuki-lock-control",
        "z": "caf02dc9a5b73890",
        "name": "Kellertür-Riegel",
        "nuki": "439053421",
        "bridge": "b6b292c6a3480048",
        "x": 560,
        "y": 1260,
        "wires": [
            [
                "61153b6e98049a2e",
                "4d7734b5b68a4673"
            ]
        ]
    },
    {
        "id": "ebe65eae65335e8d",
        "type": "nuki-lock-control",
        "z": "caf02dc9a5b73890",
        "name": "Kellertür-Schloss",
        "nuki": "664478908",
        "bridge": "b6b292c6a3480048",
        "x": 570,
        "y": 1300,
        "wires": [
            [
                "0f68dc3afdaa2f7f",
                "51e2c8177b790c74"
            ]
        ]
    },
    {
        "id": "c9e2a024280b0742",
        "type": "ui_text",
        "z": "caf02dc9a5b73890",
        "group": "6e590cb07ba9a85d",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Schloss",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1320,
        "y": 1320,
        "wires": []
    },
    {
        "id": "57d2ad26b221e581",
        "type": "ui_text",
        "z": "caf02dc9a5b73890",
        "group": "6e590cb07ba9a85d",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Riegel",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1310,
        "y": 1240,
        "wires": []
    },
    {
        "id": "6b35d5e316596e6d",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "Status-Text",
        "func": "if (msg.topic !== \"lockStatus\") return;\n\nconst state_name_de = {\n    UNCALIBRATED: \"uncalibriert\",\n    LOCKED: \"verriegelt\",\n    UNLOCKING: \"entriegeln\",\n    UNLOCKED: \"entriegelt\",\n    LOCKING: \"verriegeln\",\n    UNLATCHED: \"geöffnet\",\n    UNLOCKED_LOCK_N_GO: \"entriegelt und gehen\",\n    UNLATCHING: \"öffnen\",\n    MOTOR_BLOCKED: \"Motor blockiert\",\n    UNDEFINED: \"undefiniert\"\n}[msg.payload.state];\n\nreturn({payload: state_name_de});",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 1260,
        "wires": [
            [
                "57d2ad26b221e581",
                "462ab2a1dc1a547b"
            ]
        ]
    },
    {
        "id": "168965c8e03f3f68",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockAction",
        "payload": "UNLOCK",
        "payloadType": "str",
        "x": 610,
        "y": 820,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "5e7292d16e8d5d7d",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockAction",
        "payload": "LOCK",
        "payloadType": "str",
        "x": 600,
        "y": 780,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "4c84210c5dbade60",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "setupCallbacks",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "f6d4e7980ac1e1d5",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockAction",
        "payload": "UNLOCK",
        "payloadType": "str",
        "x": 190,
        "y": 820,
        "wires": [
            [
                "daf7dacd9dca27aa"
            ]
        ]
    },
    {
        "id": "37278a8ab9471b0a",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockAction",
        "payload": "LOCK",
        "payloadType": "str",
        "x": 180,
        "y": 780,
        "wires": [
            [
                "daf7dacd9dca27aa"
            ]
        ]
    },
    {
        "id": "67e01832216dd655",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "getCallbacks",
        "x": 170,
        "y": 520,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "0f68dc3afdaa2f7f",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "",
        "mode": "link",
        "links": [
            "19c3635367e1d357",
            "4708a180.a07a"
        ],
        "x": 715,
        "y": 1340,
        "wires": []
    },
    {
        "id": "8517dde1d4e1be01",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockAction",
        "payload": "UNLATCH",
        "payloadType": "str",
        "x": 620,
        "y": 860,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "f2a9858295ce0676",
        "type": "mqtt in",
        "z": "caf02dc9a5b73890",
        "name": "",
        "topic": "zigbee2mqtt/kellertuer_sensor",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 1540,
        "wires": [
            [
                "25f654e171406fb8",
                "6260a7d2e27bbda1",
                "21b33795391d4ce8"
            ]
        ]
    },
    {
        "id": "e8dc780272f0a049",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "Abschließen wenn Gartenlicht aus",
        "func": "const contact = flow.get(\"kellertuer_sensor\");\nconst gartenlicht = global.get(\"gartenlicht\");\n\nif (contact && gartenlicht == \"OFF\") {\n    return {topic: \"lockAction\", payload: \"LOCK\"};\n} else \n    return;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 1460,
        "wires": [
            [
                "a57ad13c5478facf"
            ]
        ]
    },
    {
        "id": "cfca6b4ad8a515f2",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": "nuki",
        "links": [
            "86cb329b293bb1f4"
        ],
        "x": 305,
        "y": 1460,
        "wires": [
            [
                "e8dc780272f0a049"
            ]
        ]
    },
    {
        "id": "418d8d8e9de2763b",
        "type": "ui_text",
        "z": "caf02dc9a5b73890",
        "group": "6e590cb07ba9a85d",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Status",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 590,
        "y": 1540,
        "wires": []
    },
    {
        "id": "6260a7d2e27bbda1",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "Status-Text",
        "func": "const contact = msg.payload.contact;\n\nreturn { payload: (contact) ? \"geschlossen\" : \"offen\"};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1540,
        "wires": [
            [
                "418d8d8e9de2763b"
            ]
        ]
    },
    {
        "id": "1679bb791b7ed221",
        "type": "catch",
        "z": "caf02dc9a5b73890",
        "name": "",
        "scope": [
            "5491f3b7aa1d4a3f",
            "ebe65eae65335e8d"
        ],
        "uncaught": false,
        "x": 950,
        "y": 1580,
        "wires": [
            [
                "1941a899e31bb27f"
            ]
        ]
    },
    {
        "id": "13a2708c18c5fc01",
        "type": "ui_text",
        "z": "caf02dc9a5b73890",
        "group": "6e590cb07ba9a85d",
        "order": 6,
        "width": "6",
        "height": "6",
        "name": "Log",
        "label": "{{msg.payload}}",
        "format": "",
        "layout": "row-spread",
        "className": "",
        "x": 1310,
        "y": 1520,
        "wires": []
    },
    {
        "id": "a8d9c863a171f99c",
        "type": "ui_button",
        "z": "caf02dc9a5b73890",
        "name": "",
        "group": "6e590cb07ba9a85d",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Log löschen",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "-",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 1150,
        "y": 1560,
        "wires": [
            [
                "a3b59c897713f50e"
            ]
        ]
    },
    {
        "id": "38c704d3beb148ed",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": "Kellertür öffnen",
        "links": [
            "bc763a522d5e7245",
            "da07e9eb00c44b89"
        ],
        "x": 225,
        "y": 1220,
        "wires": [
            [
                "5c9d349cfc6dbce2"
            ]
        ]
    },
    {
        "id": "5c9d349cfc6dbce2",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "Tür öffnren",
        "func": "return [\n    { topic: \"lockAction\", payload: \"UNLOCK\" },\n    { topic: \"lockAction\", payload: \"UNLATCH\" }\n];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 1260,
        "wires": [
            [
                "5491f3b7aa1d4a3f"
            ],
            [
                "ebe65eae65335e8d"
            ]
        ]
    },
    {
        "id": "acc198f8dc5ea896",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "1f5092044763746a"
        ],
        "x": 815,
        "y": 900,
        "wires": []
    },
    {
        "id": "daf7dacd9dca27aa",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "1fe490d1499dd17b"
        ],
        "x": 385,
        "y": 900,
        "wires": []
    },
    {
        "id": "1f5092044763746a",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": " Nuki Kellertür-Schloss",
        "links": [
            "acc198f8dc5ea896",
            "a57ad13c5478facf"
        ],
        "x": 425,
        "y": 1340,
        "wires": [
            [
                "ebe65eae65335e8d"
            ]
        ]
    },
    {
        "id": "1fe490d1499dd17b",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": " Nuki Kellertür-Riegel",
        "links": [
            "a57ad13c5478facf",
            "daf7dacd9dca27aa"
        ],
        "x": 425,
        "y": 1220,
        "wires": [
            [
                "5491f3b7aa1d4a3f"
            ]
        ]
    },
    {
        "id": "a57ad13c5478facf",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "0b172ea0761e4dbb",
            "1f5092044763746a",
            "1fe490d1499dd17b",
            "85461b3c7b54b76f"
        ],
        "x": 685,
        "y": 1460,
        "wires": []
    },
    {
        "id": "21b33795391d4ce8",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "0b172ea0761e4dbb"
        ],
        "x": 375,
        "y": 1580,
        "wires": []
    },
    {
        "id": "61153b6e98049a2e",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "",
        "mode": "link",
        "links": [
            "19c3635367e1d357",
            "4708a180.a07a"
        ],
        "x": 715,
        "y": 1220,
        "wires": []
    },
    {
        "id": "25f654e171406fb8",
        "type": "change",
        "z": "caf02dc9a5b73890",
        "name": "Speicher kellertuer_sensor Status",
        "rules": [
            {
                "t": "set",
                "p": "kellertuer_sensor",
                "pt": "flow",
                "to": "payload.contact",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 1500,
        "wires": [
            [
                "e8dc780272f0a049"
            ]
        ]
    },
    {
        "id": "094c0e53103ca4e6",
        "type": "template",
        "z": "caf02dc9a5b73890",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Tür geschlossen, absperren!\n",
        "output": "str",
        "x": 940,
        "y": 1500,
        "wires": [
            [
                "1941a899e31bb27f"
            ]
        ]
    },
    {
        "id": "23b39e867ad3e835",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": "Kellertür öffnen",
        "links": [
            "bc763a522d5e7245"
        ],
        "x": 835,
        "y": 1540,
        "wires": [
            [
                "40a7873186f5ed29"
            ]
        ]
    },
    {
        "id": "85461b3c7b54b76f",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": " Nuki Kellertür-Riegel",
        "links": [
            "a57ad13c5478facf"
        ],
        "x": 835,
        "y": 1500,
        "wires": [
            [
                "094c0e53103ca4e6"
            ]
        ]
    },
    {
        "id": "40a7873186f5ed29",
        "type": "template",
        "z": "caf02dc9a5b73890",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Fingerbadruck erkannt. Tür öffnen!",
        "output": "str",
        "x": 940,
        "y": 1540,
        "wires": [
            [
                "1941a899e31bb27f"
            ]
        ]
    },
    {
        "id": "946d1f30ab368907",
        "type": "template",
        "z": "caf02dc9a5b73890",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{topic}} {{payload}}",
        "output": "str",
        "x": 940,
        "y": 1460,
        "wires": [
            [
                "1941a899e31bb27f"
            ]
        ]
    },
    {
        "id": "941ca6aa3f7271d7",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": " Nuki Kellertür-Riegel",
        "links": [
            "462ab2a1dc1a547b"
        ],
        "x": 835,
        "y": 1460,
        "wires": [
            [
                "946d1f30ab368907"
            ]
        ]
    },
    {
        "id": "462ab2a1dc1a547b",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "19c3635367e1d357",
            "941ca6aa3f7271d7"
        ],
        "x": 1275,
        "y": 1280,
        "wires": []
    },
    {
        "id": "1941a899e31bb27f",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "append to log",
        "func": "const log = flow.get('log');\nconst timestamp = new Date().toLocaleTimeString('de-DE');\nconst new_entry = timestamp + \": \" + msg.payload;\nconst max_length = 10;\n\nlog.push(new_entry);\nif (log.length > max_length) {\n    log.splice(0, log.length - max_length);\n}\nflow.set('log', log);\n\nreturn { payload: log.join(\"<br>\")};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 1520,
        "wires": [
            [
                "13a2708c18c5fc01"
            ]
        ]
    },
    {
        "id": "a3b59c897713f50e",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "clear log",
        "func": "flow.set('log', []);\nreturn {payload: ''};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 1560,
        "wires": [
            [
                "13a2708c18c5fc01"
            ]
        ]
    },
    {
        "id": "b5b92d8b9c38f19c",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "Öffnen",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 1260,
        "wires": [
            [
                "5c9d349cfc6dbce2"
            ]
        ]
    },
    {
        "id": "b2bffe229b81a908",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "Verriegeln",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 1300,
        "wires": [
            [
                "53351be4e1c45aae"
            ]
        ]
    },
    {
        "id": "53351be4e1c45aae",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "Tür verriegeln",
        "func": "return { topic: \"lockAction\", payload: \"LOCK\" };",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1300,
        "wires": [
            [
                "5491f3b7aa1d4a3f",
                "ebe65eae65335e8d"
            ]
        ]
    },
    {
        "id": "7d89baf2b5fa03a5",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "clearCallbacks",
        "x": 180,
        "y": 440,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "14679608625f0446",
        "type": "nuki-bridge-control",
        "z": "caf02dc9a5b73890",
        "name": "nuki-bridge:8080",
        "bridge": "b6b292c6a3480048",
        "x": 470,
        "y": 560,
        "wires": [
            [
                "645c78c3640c5827"
            ]
        ]
    },
    {
        "id": "645c78c3640c5827",
        "type": "debug",
        "z": "caf02dc9a5b73890",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 560,
        "wires": []
    },
    {
        "id": "82bcfc893e556a35",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockStatus",
        "x": 160,
        "y": 900,
        "wires": [
            [
                "daf7dacd9dca27aa"
            ]
        ]
    },
    {
        "id": "5d625fd936836a58",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "lockStatus",
        "x": 580,
        "y": 900,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "b1edf012dd9fdd5d",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "log",
        "x": 150,
        "y": 560,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "d839b0f99142aff4",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "reboot",
        "x": 150,
        "y": 600,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "6a415e6fa2a77d40",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "getCallbacks",
        "x": 170,
        "y": 1020,
        "wires": [
            [
                "daf7dacd9dca27aa"
            ]
        ]
    },
    {
        "id": "232550bd72c0484a",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "getCallbacks",
        "x": 590,
        "y": 1020,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "6dcb8402f055283a",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "setupCallbacks",
        "x": 180,
        "y": 980,
        "wires": [
            [
                "daf7dacd9dca27aa"
            ]
        ]
    },
    {
        "id": "7c975bebaf5caf0a",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "clearCallbacks",
        "x": 180,
        "y": 940,
        "wires": [
            [
                "daf7dacd9dca27aa"
            ]
        ]
    },
    {
        "id": "d28c4ab814dce050",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "setupCallbacks",
        "x": 600,
        "y": 980,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "700a10beec25cd07",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "clearCallbacks",
        "x": 600,
        "y": 940,
        "wires": [
            [
                "acc198f8dc5ea896"
            ]
        ]
    },
    {
        "id": "299399f2880f0767",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "fwupdate",
        "x": 160,
        "y": 640,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "a7e5de583cc42faa",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "info",
        "x": 150,
        "y": 680,
        "wires": [
            [
                "14679608625f0446"
            ]
        ]
    },
    {
        "id": "afa506d5c1267a98",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "d": true,
        "name": "Trigger Schloss",
        "func": "if (msg.topic !== \"lockCallback\") return;\n\nconst tandem_action_from_state = {\n    \"locked\": \"LOCK\",\n    \"unlocked\": \"UNLATCH\",\n    \"motor blocked\": \"LOCK\",\n    \"unlocked (lock 'n' go)\":  \"LOCK\"\n};\nconst tandem_nuki_name = \"kellertuer_schloss\";\nconst state_name = msg.payload.stateName;\nconst tandem_state_name = flow.get(tandem_nuki_name);\n\nif (state_name && state_name !== tandem_state_name)\n    return {payload: tandem_action_from_state[state_name], topic: \"lockAction\"};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "0be5be39aa68669b",
        "type": "nuki-lock-control",
        "z": "caf02dc9a5b73890",
        "name": "Kellertür-Riegel",
        "nuki": "439053421",
        "bridge": "b6b292c6a3480048",
        "x": 940,
        "y": 1260,
        "wires": [
            [
                "6b35d5e316596e6d",
                "51ff512d041315da"
            ]
        ]
    },
    {
        "id": "9532cc6340534aa8",
        "type": "nuki-lock-control",
        "z": "caf02dc9a5b73890",
        "name": "Kellertür-Schloss",
        "nuki": "664478908",
        "bridge": "b6b292c6a3480048",
        "x": 950,
        "y": 1300,
        "wires": [
            [
                "62b141ee2365aa8e",
                "40451bbf160ab4c7"
            ]
        ]
    },
    {
        "id": "4d7734b5b68a4673",
        "type": "template",
        "z": "caf02dc9a5b73890",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "lockStatus",
        "output": "str",
        "x": 760,
        "y": 1260,
        "wires": [
            [
                "0be5be39aa68669b"
            ]
        ]
    },
    {
        "id": "51e2c8177b790c74",
        "type": "template",
        "z": "caf02dc9a5b73890",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "lockStatus",
        "output": "str",
        "x": 760,
        "y": 1300,
        "wires": [
            [
                "9532cc6340534aa8"
            ]
        ]
    },
    {
        "id": "62b141ee2365aa8e",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "Status-Text",
        "func": "if (msg.topic !== \"lockStatus\") return;\n\nconst state_name_de = {\n    UNCALIBRATED: \"uncalibriert\",\n    LOCKED: \"verriegelt\",\n    UNLOCKING: \"entriegeln\",\n    UNLOCKED: \"entriegelt\",\n    LOCKING: \"verriegeln\",\n    UNLATCHED: \"geöffnet\",\n    UNLOCKED_LOCK_N_GO: \"entriegelt und gehen\",\n    UNLATCHING: \"öffnen\",\n    MOTOR_BLOCKED: \"Motor blockiert\",\n    UNDEFINED: \"undefiniert\"\n}[msg.payload.state];\n\nreturn({payload: state_name_de});",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 1300,
        "wires": [
            [
                "462ab2a1dc1a547b",
                "c9e2a024280b0742"
            ]
        ]
    },
    {
        "id": "3ad75162d58d56de",
        "type": "ui_button",
        "z": "caf02dc9a5b73890",
        "name": "",
        "group": "6e590cb07ba9a85d",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Tür öffnen",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 1180,
        "wires": [
            [
                "39b8b4aeb3b0300a"
            ]
        ]
    },
    {
        "id": "d30eaa96a9c03566",
        "type": "ui_text_input",
        "z": "caf02dc9a5b73890",
        "name": "",
        "label": "PIN",
        "tooltip": "",
        "group": "6e590cb07ba9a85d",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "password",
        "delay": "300",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 130,
        "y": 1140,
        "wires": [
            [
                "be4cf324cf4e4559"
            ]
        ]
    },
    {
        "id": "be4cf324cf4e4559",
        "type": "change",
        "z": "caf02dc9a5b73890",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pin",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "39b8b4aeb3b0300a",
        "type": "function",
        "z": "caf02dc9a5b73890",
        "name": "open with pin",
        "func": "const pin = flow.get('pin');\nflow.set('pin', '');\n\nif (pin != \"21109\") return;\n\nreturn [{ payload: '' }, { payload: true}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1180,
        "wires": [
            [
                "d30eaa96a9c03566"
            ],
            [
                "da07e9eb00c44b89"
            ]
        ]
    },
    {
        "id": "da07e9eb00c44b89",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "link out 12",
        "mode": "link",
        "links": [
            "38c704d3beb148ed"
        ],
        "x": 465,
        "y": 1180,
        "wires": []
    },
    {
        "id": "66f1ea73dc51f63e",
        "type": "ui_button",
        "z": "caf02dc9a5b73890",
        "name": "",
        "group": "6e590cb07ba9a85d",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Tür verriegeln",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 160,
        "y": 1360,
        "wires": [
            [
                "53351be4e1c45aae"
            ]
        ]
    },
    {
        "id": "5459fcc983b43949",
        "type": "debug",
        "z": "caf02dc9a5b73890",
        "name": "debug 6",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 1180,
        "wires": []
    },
    {
        "id": "19c3635367e1d357",
        "type": "link in",
        "z": "caf02dc9a5b73890",
        "name": "Nuki Debug",
        "links": [
            "61153b6e98049a2e",
            "0f68dc3afdaa2f7f",
            "462ab2a1dc1a547b",
            "51ff512d041315da",
            "40451bbf160ab4c7"
        ],
        "x": 1215,
        "y": 1180,
        "wires": [
            [
                "5459fcc983b43949"
            ]
        ]
    },
    {
        "id": "51ff512d041315da",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "",
        "mode": "link",
        "links": [
            "19c3635367e1d357"
        ],
        "x": 1095,
        "y": 1220,
        "wires": []
    },
    {
        "id": "40451bbf160ab4c7",
        "type": "link out",
        "z": "caf02dc9a5b73890",
        "name": "",
        "mode": "link",
        "links": [
            "19c3635367e1d357"
        ],
        "x": 1095,
        "y": 1340,
        "wires": []
    },
    {
        "id": "b008a4ef92d8709c",
        "type": "http in",
        "z": "caf02dc9a5b73890",
        "name": "",
        "url": "/nuki",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 320,
        "wires": [
            [
                "5426f39b9317f078",
                "d4c87387ce096aff"
            ]
        ]
    },
    {
        "id": "5426f39b9317f078",
        "type": "debug",
        "z": "caf02dc9a5b73890",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 300,
        "y": 360,
        "wires": []
    },
    {
        "id": "e8ae208c5b493a6b",
        "type": "inject",
        "z": "caf02dc9a5b73890",
        "name": "Reset",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 150,
        "y": 80,
        "wires": [
            [
                "f541f04b9ff59bf4"
            ]
        ]
    },
    {
        "id": "fadc0297633fd69c",
        "type": "http request",
        "z": "caf02dc9a5b73890",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://nuki-bridge:8080/callback/add?url=http%3A%2F%2Fdipe-pi%3A1880%2Fnuki&token=368902",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 200,
        "wires": [
            [
                "185711cedafd5fe4",
                "13751a35e9cc7c50"
            ]
        ]
    },
    {
        "id": "d4c87387ce096aff",
        "type": "http response",
        "z": "caf02dc9a5b73890",
        "name": "send empty response",
        "statusCode": "200",
        "headers": {},
        "x": 340,
        "y": 320,
        "wires": []
    },
    {
        "id": "185711cedafd5fe4",
        "type": "debug",
        "z": "caf02dc9a5b73890",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 240,
        "wires": []
    },
    {
        "id": "f541f04b9ff59bf4",
        "type": "http request",
        "z": "caf02dc9a5b73890",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://nuki-bridge:8080/callback/remove&id=0&token=368902",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 80,
        "wires": [
            [
                "185711cedafd5fe4",
                "e46a80466f947d5d"
            ]
        ]
    },
    {
        "id": "e46a80466f947d5d",
        "type": "http request",
        "z": "caf02dc9a5b73890",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://nuki-bridge:8080/callback/remove&id=0&token=368902",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 120,
        "wires": [
            [
                "185711cedafd5fe4",
                "d9c6ea5f4b202c82"
            ]
        ]
    },
    {
        "id": "d9c6ea5f4b202c82",
        "type": "http request",
        "z": "caf02dc9a5b73890",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://nuki-bridge:8080/callback/remove&id=0&token=368902",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 160,
        "wires": [
            [
                "185711cedafd5fe4",
                "fadc0297633fd69c"
            ]
        ]
    },
    {
        "id": "13751a35e9cc7c50",
        "type": "http request",
        "z": "caf02dc9a5b73890",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://nuki-bridge:8080/callback/list?token=368902",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 240,
        "wires": [
            [
                "185711cedafd5fe4"
            ]
        ]
    },
    {
        "id": "3f9580dafe32e9bb",
        "type": "ui_button",
        "z": "0133ddc4e63513b7",
        "name": "",
        "group": "c15e3cecb6ae7609",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "hinzufügen",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 230,
        "y": 420,
        "wires": [
            [
                "b3d68c772a191a78"
            ]
        ]
    },
    {
        "id": "89a64d036fd322d0",
        "type": "mqtt out",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/enroll",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 700,
        "y": 420,
        "wires": []
    },
    {
        "id": "ae9aadc6afd2d3de",
        "type": "mqtt in",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/scan_matched",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 240,
        "y": 1040,
        "wires": [
            [
                "a0e67b7908ae5add"
            ]
        ]
    },
    {
        "id": "b3d68c772a191a78",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "add fingerprint",
        "func": "const pin = flow.get('pin');\nconst id_to_add = flow.get('id_to_add');\nconst num_scans = flow.get('num_scans');\n\nreturn [\n    {payload: {pin: pin,finger_id: id_to_add, num_scans: num_scans}},\n    {topic: \"Scan:\", payload: \"Bitte Finger auflegen\"} \n];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 420,
        "wires": [
            [
                "89a64d036fd322d0"
            ],
            [
                "166ea28fb4066970"
            ]
        ]
    },
    {
        "id": "ccb35b1aaf0aeec3",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_to_delete",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "4e11783bd4309030",
        "type": "ui_button",
        "z": "0133ddc4e63513b7",
        "name": "",
        "group": "c15e3cecb6ae7609",
        "order": 9,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "abbrechen",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 230,
        "y": 920,
        "wires": [
            [
                "30de075bd1f111fb",
                "abbbe6d61cd273b9"
            ]
        ]
    },
    {
        "id": "30de075bd1f111fb",
        "type": "mqtt out",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/cancel_enroll",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 720,
        "y": 920,
        "wires": []
    },
    {
        "id": "abbbe6d61cd273b9",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "abgebrochen",
        "func": "return {topic: \"Scan\", payload: \"abgebrochen\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 800,
        "wires": [
            [
                "a7b0725dc592d634",
                "166ea28fb4066970",
                "6aed96f65ecbb9f3"
            ]
        ]
    },
    {
        "id": "55b427a01688b459",
        "type": "ui_text",
        "z": "0133ddc4e63513b7",
        "group": "3d281e38187eb483",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Erkannt",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 680,
        "y": 1060,
        "wires": []
    },
    {
        "id": "5e24a83c88aa4d68",
        "type": "mqtt in",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/scan_unmatched",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 250,
        "y": 1080,
        "wires": [
            [
                "2fe2d56f15c3abdc"
            ]
        ]
    },
    {
        "id": "70de19f992b33696",
        "type": "mqtt in",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/enrollment_done",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 250,
        "y": 680,
        "wires": [
            [
                "73b8c6b7d4950cbd"
            ]
        ]
    },
    {
        "id": "3cb72c0f04124551",
        "type": "ui_button",
        "z": "0133ddc4e63513b7",
        "name": "",
        "group": "e1e3eb2e7b5352d1",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "löschen",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 220,
        "y": 1200,
        "wires": [
            [
                "2b68d34c5c1a2fa4"
            ]
        ]
    },
    {
        "id": "10b246287006741b",
        "type": "mqtt out",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/delete",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 620,
        "y": 1200,
        "wires": []
    },
    {
        "id": "2b68d34c5c1a2fa4",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "get id_to_delete",
        "func": "const id_to_delete = parseInt(flow.get('id_to_delete'));\nif (isNaN(id_to_delete) || id_to_delete < 0 || id_to_delete > 200) return;\n\nconst list_of_fingerprints = flow.get('list_of_fingerprints') || {};\ndelete (list_of_fingerprints[id_to_delete]);\nflow.set('list_of_fingerprints', list_of_fingerprints);\nflow.set('id_to_delete', undefined);\n\nreturn [{ payload: \"\" }, { payload: { finger_id: id_to_delete}}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 1200,
        "wires": [
            [
                "0eb646d574f0db4b"
            ],
            [
                "10b246287006741b"
            ]
        ]
    },
    {
        "id": "9491802aea11742e",
        "type": "ui_text_input",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "Name",
        "tooltip": "",
        "group": "c15e3cecb6ae7609",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "300",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 210,
        "y": 580,
        "wires": [
            [
                "4b60f74abbc296ce"
            ]
        ]
    },
    {
        "id": "4b60f74abbc296ce",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "name_to_add",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "a0e67b7908ae5add",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "Lookup Name",
        "func": "const list_of_fingerprints = flow.get('list_of_fingerprints') || [];\nconst finger_id = msg.payload.finger_id;\nconst confidence = msg.payload.confidence;\nconst finger_name = list_of_fingerprints[finger_id];\n\nconst sprintf = global.get(\"sprintf\");\nconst text = sprintf(\"%s ID: %i, Vertrauen: %i\", finger_name, finger_id, confidence);\n\nreturn {topic: \"Finger erkannt:\", payload: text};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 1040,
        "wires": [
            [
                "55b427a01688b459",
                "bc763a522d5e7245"
            ]
        ]
    },
    {
        "id": "2fe2d56f15c3abdc",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "unerkannt",
        "func": "return { topic: \"unerkannt\", payload: new Date().toISOString()};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1080,
        "wires": [
            [
                "55b427a01688b459"
            ]
        ]
    },
    {
        "id": "d17d57a0f6777e94",
        "type": "inject",
        "z": "0133ddc4e63513b7",
        "name": "Reset",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 190,
        "y": 120,
        "wires": [
            [
                "e3e03178bf6cebe2"
            ]
        ]
    },
    {
        "id": "e3e03178bf6cebe2",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "text",
        "func": "const list_of_fingerprints = flow.get('list_of_fingerprints');\nconst fingerprint_count = flow.get('fingerprint_count');\n\nvar text = 'Anzahl: ' + fingerprint_count + \"<br>\";\nconst keys = Object.keys(list_of_fingerprints);\nkeys.forEach(key => {\n    text += key + ': ' + list_of_fingerprints[key] + \"<br>\";\n});\n\nreturn {payload: text};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 120,
        "wires": [
            [
                "1bf4ce914349d32c"
            ]
        ]
    },
    {
        "id": "73b8c6b7d4950cbd",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "store finger name and id",
        "func": "const name_to_add = flow.get('name_to_add');\nconst hand_to_add = flow.get('hand_to_add');\nconst finger_to_add = flow.get('finger_to_add');\nconst id_to_add = flow.get('id_to_add');\nconst list_of_fingerprints = flow.get('list_of_fingerprints') || {};\n\nlist_of_fingerprints[id_to_add] = `${name_to_add}-${finger_to_add}-${hand_to_add}`;\nflow.set('list_of_fingerprints', list_of_fingerprints);\nflow.set('pin', '');\n\nconst sprintf = global.get(\"sprintf\");\nconst text = sprintf(\"%i: %s\", id_to_add, name_to_add);\n\nreturn [{ payload: '' }, { topic: \"Erfolgreich hinzugefügt:\", payload: text}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 680,
        "wires": [
            [
                "4d42edd6ee3c272e"
            ],
            [
                "6aed96f65ecbb9f3",
                "166ea28fb4066970"
            ]
        ]
    },
    {
        "id": "45b0b3720d097fba",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "Finger auflegen",
        "func": "const finger_id = msg.payload.finger_id;\nconst scan_num = msg.payload.scan_num;\nreturn { topic: \"Scan \" + scan_num, payload: \"Finger auflegen\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 720,
        "wires": [
            [
                "166ea28fb4066970",
                "6aed96f65ecbb9f3"
            ]
        ]
    },
    {
        "id": "a90c6b6f4a513295",
        "type": "mqtt in",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/enrollment_scan",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 250,
        "y": 720,
        "wires": [
            [
                "45b0b3720d097fba"
            ]
        ]
    },
    {
        "id": "202829b1ecb95432",
        "type": "mqtt in",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/enrollment_failed",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 250,
        "y": 760,
        "wires": [
            [
                "95e84c223e344396"
            ]
        ]
    },
    {
        "id": "95e84c223e344396",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "fehlgeschlagen",
        "func": "return { topic: \"Scan\", payload: \"Scan fehlgeschlagen\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 760,
        "wires": [
            [
                "166ea28fb4066970",
                "6aed96f65ecbb9f3"
            ]
        ]
    },
    {
        "id": "a7b0725dc592d634",
        "type": "delay",
        "z": "0133ddc4e63513b7",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 480,
        "y": 840,
        "wires": [
            [
                "2db468fa3dfbf794"
            ]
        ]
    },
    {
        "id": "2db468fa3dfbf794",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "leer-string",
        "func": "return {topic: \"\", payload: \"\"};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 880,
        "wires": [
            [
                "166ea28fb4066970"
            ]
        ]
    },
    {
        "id": "9afd1b961981d213",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_to_add",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "cb029e624bf3c1fd",
        "type": "ui_numeric",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "ID",
        "tooltip": "",
        "group": "c15e3cecb6ae7609",
        "order": 2,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "step": 1,
        "className": "",
        "x": 210,
        "y": 340,
        "wires": [
            [
                "9afd1b961981d213"
            ]
        ]
    },
    {
        "id": "166ea28fb4066970",
        "type": "link out",
        "z": "0133ddc4e63513b7",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "64ef87f3fce3dec3",
            "825a65ab717007e7"
        ],
        "x": 775,
        "y": 680,
        "wires": []
    },
    {
        "id": "4269a56a99ca7eab",
        "type": "ui_text",
        "z": "0133ddc4e63513b7",
        "group": "c15e3cecb6ae7609",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "Status",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 950,
        "y": 680,
        "wires": []
    },
    {
        "id": "64ef87f3fce3dec3",
        "type": "link in",
        "z": "0133ddc4e63513b7",
        "name": "link in 2",
        "links": [
            "166ea28fb4066970"
        ],
        "x": 845,
        "y": 680,
        "wires": [
            [
                "4269a56a99ca7eab"
            ]
        ]
    },
    {
        "id": "825a65ab717007e7",
        "type": "link in",
        "z": "0133ddc4e63513b7",
        "name": "link in 3",
        "links": [
            "166ea28fb4066970"
        ],
        "x": 225,
        "y": 160,
        "wires": [
            [
                "e3e03178bf6cebe2"
            ]
        ]
    },
    {
        "id": "3a0290f6b1ccf091",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "clear list of fingerprints",
        "func": "flow.set('list_of_fingerprints', {\n    0: \"Peter-Zeigefinger-rechts\",\n    1: \"Peter-Mittelfinger-rechts\",\n    2: \"Peter-Daumen-rechts\"\n});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 80,
        "wires": [
            [
                "e3e03178bf6cebe2",
                "8a933d4e671f227f"
            ]
        ]
    },
    {
        "id": "1115a1ae4aed1157",
        "type": "inject",
        "z": "0133ddc4e63513b7",
        "name": "Delete All",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 200,
        "y": 80,
        "wires": [
            [
                "3a0290f6b1ccf091"
            ]
        ]
    },
    {
        "id": "8a933d4e671f227f",
        "type": "mqtt out",
        "z": "0133ddc4e63513b7",
        "d": true,
        "name": "",
        "topic": "fingersensor1/delete_all",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 710,
        "y": 80,
        "wires": []
    },
    {
        "id": "853e0dc102578fac",
        "type": "mqtt in",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/sensor/fingerprint_count/state",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 290,
        "y": 260,
        "wires": [
            [
                "b048f207dc1e62d9",
                "cb029e624bf3c1fd"
            ]
        ]
    },
    {
        "id": "b048f207dc1e62d9",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "fingerprint_count",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 260,
        "wires": [
            [
                "e3e03178bf6cebe2"
            ]
        ]
    },
    {
        "id": "8d25e61dcf29b6a7",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pin",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "4d42edd6ee3c272e",
        "type": "ui_text_input",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "PIN",
        "tooltip": "",
        "group": "c15e3cecb6ae7609",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "password",
        "delay": "300",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 210,
        "y": 620,
        "wires": [
            [
                "8d25e61dcf29b6a7"
            ]
        ]
    },
    {
        "id": "eed67a44576cb146",
        "type": "ui_numeric",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "Anzahl Scans",
        "tooltip": "",
        "group": "c15e3cecb6ae7609",
        "order": 6,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": 1,
        "className": "",
        "x": 240,
        "y": 380,
        "wires": [
            [
                "819f8134e44f5ffc"
            ]
        ]
    },
    {
        "id": "819f8134e44f5ffc",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "num_scans",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "1bf4ce914349d32c",
        "type": "ui_text",
        "z": "0133ddc4e63513b7",
        "group": "3d281e38187eb483",
        "order": 2,
        "width": "6",
        "height": "6",
        "name": "Liste",
        "label": "{{msg.payload}}",
        "format": "",
        "layout": "row-left",
        "className": "",
        "x": 550,
        "y": 120,
        "wires": []
    },
    {
        "id": "0eb646d574f0db4b",
        "type": "ui_text_input",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "ID",
        "tooltip": "",
        "group": "e1e3eb2e7b5352d1",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 210,
        "y": 1160,
        "wires": [
            [
                "ccb35b1aaf0aeec3"
            ]
        ]
    },
    {
        "id": "86fec2abf6293c44",
        "type": "mqtt out",
        "z": "0133ddc4e63513b7",
        "name": "",
        "topic": "fingersensor1/enroll",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "c349b9ff.9dc4c8",
        "x": 900,
        "y": 780,
        "wires": []
    },
    {
        "id": "6aed96f65ecbb9f3",
        "type": "function",
        "z": "0133ddc4e63513b7",
        "name": "clear data",
        "func": "return(\n    {payload: {pin: '', finger_id: '', num_scans: ''}});\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 740,
        "wires": [
            [
                "86fec2abf6293c44"
            ]
        ]
    },
    {
        "id": "bc763a522d5e7245",
        "type": "link out",
        "z": "0133ddc4e63513b7",
        "name": "Finger erkannt",
        "mode": "link",
        "links": [
            "38c704d3beb148ed",
            "23b39e867ad3e835",
            "e0f2ee18f4a3dcc1"
        ],
        "x": 635,
        "y": 1020,
        "wires": []
    },
    {
        "id": "64feafd00e0a8031",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "finger_to_add",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "0e71dae562ead704",
        "type": "change",
        "z": "0133ddc4e63513b7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hand_to_add",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "20e79245e5976a01",
        "type": "ui_dropdown",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "Hand",
        "tooltip": "",
        "place": "Select option",
        "group": "c15e3cecb6ae7609",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "links",
                "type": "str"
            },
            {
                "label": "",
                "value": "rechts",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 210,
        "y": 500,
        "wires": [
            [
                "0e71dae562ead704"
            ]
        ]
    },
    {
        "id": "4e316cd3f68e90a4",
        "type": "ui_dropdown",
        "z": "0133ddc4e63513b7",
        "name": "",
        "label": "Finger",
        "tooltip": "",
        "place": "Select option",
        "group": "c15e3cecb6ae7609",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "Daumen",
                "type": "str"
            },
            {
                "label": "",
                "value": "Zeigefinger",
                "type": "str"
            },
            {
                "label": "",
                "value": "Mittelfinger",
                "type": "str"
            },
            {
                "label": "",
                "value": "Ringfinger",
                "type": "str"
            },
            {
                "label": "",
                "value": "kleiner Finger",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 210,
        "y": 540,
        "wires": [
            [
                "64feafd00e0a8031"
            ]
        ]
    },
    {
        "id": "a8ef2ce.4a169d",
        "type": "mqtt in",
        "z": "ff52c0df.f6082",
        "name": "Zigbee Batteries",
        "topic": "zigbee2mqtt/#",
        "qos": "0",
        "datatype": "json",
        "broker": "c349b9ff.9dc4c8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 140,
        "y": 260,
        "wires": [
            [
                "164ed4d4.17b46b",
                "d7399023.389bd",
                "bc0f398077257b8c"
            ]
        ]
    },
    {
        "id": "164ed4d4.17b46b",
        "type": "function",
        "z": "ff52c0df.f6082",
        "name": "Save Battery",
        "func": "var battery = msg.payload.battery;\nvar batteryLow = msg.payload.battery_low;\nvar voltage = msg.payload.voltage;\nvar deviceTopic  = msg.topic;\nvar ZigbeeDeviceNames = flow.get(\"ZigbeeDeviceNames\");\n\nvar zigbeeBattery = flow.get(\"zigbeeBattery\");\n\nif(zigbeeBattery === undefined){\n    zigbeeBattery = [];\n}\nif(zigbeeBattery === undefined){\n    zigbeeBattery = [];\n}\n\nvar test = isNaN(battery);\n\n//battery info present\nif(test === false){\n    \n    //get device ID\n    var z1 = /zigbee2mqtt\\/(.*)/.exec(deviceTopic);\n    var id = z1[1];\n    \n    //get name and ID\n    var posName = ZigbeeDeviceNames.map(function(e) { return e.name; }).indexOf(id);\n    node.warn(posName);\n    var deviceId = ZigbeeDeviceNames[posName].device;\n    var deviceName = ZigbeeDeviceNames[posName].name;\n    node.warn(posName);\n    //optional voltage and low batt \n    var testBatt = isNaN(batteryLow);\n    var testVolt = isNaN(voltage);\n    \n    if(testBatt === true){batteryLow = false;}\n    if(testVolt === true){voltage = false;}\n    \n    //get time\n    var time = new Date();\n    \n    var pos = zigbeeBattery.map(function(e) { return e.info.name; }).indexOf(deviceName);\n    node.warn(pos);\n    var a;\n    if(pos === -1){\n        a = {\"device\": deviceId, \n                  \"info\":{ \n                    \"battery\":    battery,\n                    \"timestamp\":  time,\n                    \"batteryType\": false,\n                    \"batteryETA\":  \"TBD\",\n                    \"battery_low\": false,\n                    \"voltage\": voltage,\n                    \"name\": deviceName}\n                    };\n        zigbeeBattery.push(a);\n        flow.set(\"zigbeeBattery\", zigbeeBattery);\n    }\n    if(pos >= 0){\n        var battType = zigbeeBattery[pos].info.batteryType\n        a = {\"device\": deviceId, \n                  \"info\":{ \n                    \"battery\":    battery,\n                    \"timestamp\":  time,\n                    \"batteryType\": battType,\n                    \"batteryETA\":  \"TBD\",\n                    \"battery_low\": batteryLow,\n                    \"voltage\": voltage,\n                    \"name\": deviceName}\n                    };\n    }\n    zigbeeBattery[pos]= a;\n    flow.set(\"zigbeeBattery\", zigbeeBattery);\n}\n\n\n   \n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "a6b8166b.c02258",
        "type": "ui_template",
        "z": "ff52c0df.f6082",
        "group": "e19d291d.da6018",
        "name": "",
        "order": 1,
        "width": 20,
        "height": 8,
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 780,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "bc7957e.97d16a8",
        "type": "function",
        "z": "ff52c0df.f6082",
        "name": "Update Chart",
        "func": "var data = flow.get(\"zigbeeBattery\");\n\nvar arr = [];\n\nvar count =  data.length;\n    for (var i=0; i < count; i++){\n        var nmsg = {payload:data[i].info.battery, topic:data[i].info.name};\n        arr.push(nmsg);\n    }\n\nreturn [arr];\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 400,
        "wires": [
            [
                "228e9800.5ab598"
            ]
        ]
    },
    {
        "id": "46ffe730.2ce6a8",
        "type": "function",
        "z": "ff52c0df.f6082",
        "d": true,
        "name": "Android notification",
        "func": "var data = flow.get(\"zigbeeBattery\");\nvar batteryWarning =  flow.get(\"BatteryWarning\");\nvar device = flow.get(\"NotificationDevice\");\n\n\nvar key = global.get(device);\nvar url = \"https://autoremotejoaomgcd.appspot.com/sendmessage\";\nvar command = \"NOT20\";\n\n\n\nvar battPush = [];\nvar buttons = {};\nvar battBuy = [];\nvar battLink = [];\n\nfor (var i=0; i < data.length; i++) {\n    var batt = data[i].info.battery;\n    var battType = data[i].info.batteryType;\n    if(batt <= batteryWarning){\n        var name = data[i].info.name;\n        if(battType === false){\n            var battTypeDisplay = \"battery type configuration.\\ \";\n            \n        }\n        else { var battTypeDisplay = battType;\n                battBuy.push(battType);\n                battLink.push(data[i].info.batteryURL);\n        }\n    var lowBatt = \"<li><strong>\"+name + \":</strong><span style=\\\"color: #ff9900;\\\"> \"+ batt +\"%</span><span style=\\\"color: #333333;\\\"><em> needs </em><strong>\" + battTypeDisplay + \"</strong></span></li>\";\n    battPush.push(lowBatt);\n    }\n}\n\n\nif(battPush.length > 0){\n\nvar reg = battPush.toString();\nvar reg1 = reg.replace(/,/g, \"\");\n\nvar body = {\n  \"text\": {\n    \"text\": \"A number of your Zigbee devices need a new battery\" ,    \n    \"textexpanded\": \"<ul>\"+ reg1 + \"</ul>\"\n  },\n  \"title\": {\n    \"title\": \"Zigbee Low Battery Warning\",\n    \"titleexpanded\": \"Zigbee Low Battery Warning\"\n  },\n  \"icons\": {\n    \"navbaricon\": \"https://raw.githubusercontent.com/google/material-design-icons/master/device/2x_web/ic_battery_alert_black_48dp.png\",\n    \"bigicon\": \"https://raw.githubusercontent.com/google/material-design-icons/master/device/2x_web/ic_battery_alert_black_48dp.png\",\n    \"smallicon\": \"https://raw.githubusercontent.com/google/material-design-icons/master/device/2x_web/ic_battery_alert_black_48dp.png\",\n    \"iconexpanded\": \"https://raw.githubusercontent.com/google/material-design-icons/master/device/2x_web/ic_battery_alert_black_48dp.png\"\n  },\n  \"notificationid\": \"ZigbeeBattery\",\n  \"persistent\": false,\n  \"priority\": 1,\n  \"color\": \"#b9512c\",\n  \"backgroundcolor\": \"#fafafa\",\n  \"picture\": \"pictureurl\",\n  \"buttons\": \"\"\n};\n\n\nvar battBuy1 = [ ...new Set(battBuy) ];\nvar battLink1 = [ ...new Set(battLink) ];\n\nvar objButton ={};\nfor (var a = 0; a <battBuy1.length; a++) {\n    var b = a +1\n    var keyButton = \"button\"+ b;\n    \n    objButton =  {\n        \"icon\": \"iconURL\",\n        \"label\": \"Buy \" + battBuy1[a],\n        \"command\": \"buybattery*-*\" + battLink1[a]\n    };\n    node.warn(objButton);\n    buttons[keyButton] = objButton;\n    node.warn(buttons);\n}\n\nbody[\"buttons\"] = [buttons];\n\n\nmsg.data = body;\nvar x = JSON.stringify(body);\nvar encodedBody = encodeURIComponent(x);\n\nmsg.url = url + \"?key=\" + key + \"&message=\" +command + \"=:=\"+ encodedBody;\nreturn msg;\n}",
        "outputs": 1,
        "noerr": 1,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 660,
        "wires": [
            [
                "7b41c0bc.eba5d"
            ]
        ]
    },
    {
        "id": "34eaea50.91aab6",
        "type": "subflow:97561555.3ea248",
        "z": "ff52c0df.f6082",
        "name": "Add Battery Info",
        "env": [
            {
                "name": "BatteryType",
                "value": "CR2450",
                "type": "str"
            },
            {
                "name": "Name",
                "value": "TUYA_temp_1",
                "type": "str"
            }
        ],
        "x": 340,
        "y": 140,
        "wires": [
            [
                "f16ccf23.b206"
            ]
        ]
    },
    {
        "id": "82c403c6.93a1b",
        "type": "inject",
        "z": "ff52c0df.f6082",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 140,
        "wires": [
            [
                "34eaea50.91aab6"
            ]
        ]
    },
    {
        "id": "f16ccf23.b206",
        "type": "debug",
        "z": "ff52c0df.f6082",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 530,
        "y": 140,
        "wires": []
    },
    {
        "id": "72d828b7.59b208",
        "type": "subflow:a48db0b1.9dac6",
        "z": "ff52c0df.f6082",
        "name": "",
        "env": [
            {
                "name": "NotificationDevice",
                "value": "ARpixel3",
                "type": "str"
            },
            {
                "name": "BatteryWarning",
                "value": "78",
                "type": "num"
            },
            {
                "name": "Battery warning",
                "value": "7",
                "type": "str"
            }
        ],
        "x": 340,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "9f4bf161.ac641",
        "type": "inject",
        "z": "ff52c0df.f6082",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 620,
        "wires": [
            [
                "72d828b7.59b208"
            ]
        ]
    },
    {
        "id": "e2838269.8935b",
        "type": "inject",
        "z": "ff52c0df.f6082",
        "name": "Update 5min",
        "repeat": "300",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 400,
        "wires": [
            [
                "bc7957e.97d16a8"
            ]
        ]
    },
    {
        "id": "3c764738.1e0d68",
        "type": "inject",
        "z": "ff52c0df.f6082",
        "name": "every 24",
        "repeat": "",
        "crontab": "00 12 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "clear",
        "payloadType": "str",
        "x": 140,
        "y": 480,
        "wires": [
            [
                "bc7957e.97d16a8"
            ]
        ]
    },
    {
        "id": "83134a13.58e6b8",
        "type": "inject",
        "z": "ff52c0df.f6082",
        "name": "Once a day",
        "repeat": "",
        "crontab": "00 13 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 660,
        "wires": [
            [
                "46ffe730.2ce6a8"
            ]
        ]
    },
    {
        "id": "7b41c0bc.eba5d",
        "type": "http request",
        "z": "ff52c0df.f6082",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 590,
        "y": 660,
        "wires": [
            [
                "2ed9d566.4c7ada"
            ]
        ]
    },
    {
        "id": "2ed9d566.4c7ada",
        "type": "http response",
        "z": "ff52c0df.f6082",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 790,
        "y": 660,
        "wires": []
    },
    {
        "id": "c8413a30.af4798",
        "type": "file in",
        "z": "ff52c0df.f6082",
        "name": "Zigbee configuration.yaml",
        "filename": "/opt/zigbee2mqtt/data/configuration.yaml",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "x": 570,
        "y": 320,
        "wires": [
            [
                "efa82fdd.ff49f"
            ]
        ]
    },
    {
        "id": "efa82fdd.ff49f",
        "type": "yaml",
        "z": "ff52c0df.f6082",
        "property": "payload",
        "name": "",
        "x": 770,
        "y": 320,
        "wires": [
            [
                "2916361e.d54a3a"
            ]
        ]
    },
    {
        "id": "2916361e.d54a3a",
        "type": "function",
        "z": "ff52c0df.f6082",
        "name": "Create Zigbee List",
        "func": "var x = {\"devices\":msg.payload.devices};\nvar devices = [];\nvar device = Object.keys(x.devices);\nvar name = Object.values(x.devices);\n\nvar arr = Object.entries(x.devices);\n    for ([device,name] of arr) {\n        var n = name.friendly_name;\n        \n        var a = {device, \"name\": n}\n        \n        devices.push(a);\n        flow.set(\"ZigbeeDeviceNames\", devices);\n    }\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 950,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "d7399023.389bd",
        "type": "switch",
        "z": "ff52c0df.f6082",
        "name": "",
        "property": "payload.battery",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 320,
        "wires": [
            [
                "c8413a30.af4798"
            ]
        ]
    },
    {
        "id": "5a186078.f4965",
        "type": "comment",
        "z": "ff52c0df.f6082",
        "name": "Settings",
        "info": "",
        "x": 120,
        "y": 100,
        "wires": []
    },
    {
        "id": "e5058bb5.d75808",
        "type": "comment",
        "z": "ff52c0df.f6082",
        "name": "update device list",
        "info": "",
        "x": 420,
        "y": 280,
        "wires": []
    },
    {
        "id": "be6d1020.eea37",
        "type": "comment",
        "z": "ff52c0df.f6082",
        "name": "Clear Average",
        "info": "",
        "x": 390,
        "y": 460,
        "wires": []
    },
    {
        "id": "ed27adf4.45fa",
        "type": "comment",
        "z": "ff52c0df.f6082",
        "name": "Android Notification",
        "info": "",
        "x": 130,
        "y": 580,
        "wires": []
    },
    {
        "id": "228e9800.5ab598",
        "type": "average-bars",
        "z": "ff52c0df.f6082",
        "name": "average-bars2",
        "title": "Battery %",
        "period": "topic",
        "yMin": "0",
        "yMax": "100",
        "showBarsValue": true,
        "showScaleValue": true,
        "showLastValue": false,
        "showAverageValue": false,
        "showMinimumValue": false,
        "showMaximumValue": false,
        "maxBar": "50",
        "topColor": "#d6fa0a",
        "bottomColor": "#df3d20",
        "unit": "%",
        "fontColor": "#ffffff",
        "barStyle": "Equalizer",
        "decimal": "0",
        "x": 600,
        "y": 480,
        "wires": [
            [
                "a6b8166b.c02258"
            ]
        ]
    },
    {
        "id": "bc0f398077257b8c",
        "type": "debug",
        "z": "ff52c0df.f6082",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 200,
        "wires": []
    },
    {
        "id": "4f8e3104.574f1",
        "type": "switch",
        "z": "650e7c81.102bb4",
        "name": "Door unlocked?",
        "property": "response.state.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "5",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "7",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 180,
        "y": 420,
        "wires": [
            [],
            [],
            [],
            [],
            [
                "7e70627b.f08c6c"
            ]
        ]
    },
    {
        "id": "70048d9c.18f574",
        "type": "http in",
        "z": "650e7c81.102bb4",
        "name": "Nuki Bridge API HTTP Callback Endpoint",
        "url": "/nukiii",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 240,
        "y": 100,
        "wires": [
            [
                "b292b974.c942e8"
            ]
        ]
    },
    {
        "id": "b292b974.c942e8",
        "type": "http response",
        "z": "650e7c81.102bb4",
        "name": "send empty response",
        "statusCode": "",
        "headers": {},
        "x": 560,
        "y": 100,
        "wires": []
    },
    {
        "id": "7565f770.71dfc8",
        "type": "comment",
        "z": "650e7c81.102bb4",
        "name": "Get incoming state changes using the Nuki Callback Bridge API",
        "info": "",
        "x": 350,
        "y": 60,
        "wires": []
    },
    {
        "id": "fd156475.c77da8",
        "type": "comment",
        "z": "650e7c81.102bb4",
        "name": "Request Nuki lock state via Nuki Web API",
        "info": "",
        "x": 580,
        "y": 180,
        "wires": []
    },
    {
        "id": "578cd7c0.a07468",
        "type": "comment",
        "z": "650e7c81.102bb4",
        "name": "React on the status change",
        "info": "",
        "x": 260,
        "y": 360,
        "wires": []
    },
    {
        "id": "2feeeaae.f4a326",
        "type": "http request",
        "z": "650e7c81.102bb4",
        "name": "Send Nuki Web API HTTP Get-Request",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 240,
        "y": 280,
        "wires": [
            [
                "cbcd5436.7ca548"
            ]
        ]
    },
    {
        "id": "ff07ef80.9321c",
        "type": "change",
        "z": "650e7c81.102bb4",
        "name": "Prepare Nuki Web API HTTP Request https://api.nuki.io/smartlock",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://api.nuki.io/smartlock/\" & msg.smartlockId",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "token",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "smartlockId",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 220,
        "wires": [
            [
                "2feeeaae.f4a326"
            ]
        ]
    },
    {
        "id": "cbcd5436.7ca548",
        "type": "change",
        "z": "650e7c81.102bb4",
        "name": "Write Nuki lock state to the payload",
        "rules": [
            {
                "t": "set",
                "p": "response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "response.state.state",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 280,
        "wires": [
            [
                "6f81deb7.277cc"
            ]
        ]
    },
    {
        "id": "6f81deb7.277cc",
        "type": "function",
        "z": "650e7c81.102bb4",
        "name": "Check whether the state changed or not",
        "func": "var oldNukiStatus = global.get(\"oldNukiStatus\");\n\nif (msg.payload != oldNukiStatus) {\n    global.set(\"oldNukiStatus\", msg.payload);\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 900,
        "y": 280,
        "wires": [
            [
                "4f8e3104.574f1"
            ]
        ]
    },
    {
        "id": "7e70627b.f08c6c",
        "type": "switch",
        "z": "650e7c81.102bb4",
        "name": "Door locked?",
        "property": "response.state.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 380,
        "y": 500,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "c7413f7e.f51cb",
        "type": "function",
        "z": "650e7c81.102bb4",
        "name": "Request Header set authorization",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 220,
        "wires": [
            [
                "ff07ef80.9321c"
            ]
        ]
    },
    {
        "id": "620b3a1.f8968c4",
        "type": "comment",
        "z": "650e7c81.102bb4",
        "name": "Actions to perform when the door gets unlocked",
        "info": "",
        "x": 460,
        "y": 420,
        "wires": []
    },
    {
        "id": "d179b6dd.dbea38",
        "type": "comment",
        "z": "650e7c81.102bb4",
        "name": "Actions to perform when the door gets locked",
        "info": "",
        "x": 650,
        "y": 500,
        "wires": []
    },
    {
        "id": "8c2f0346.e870c",
        "type": "credentials",
        "z": "650e7c81.102bb4",
        "name": "Credentials Nuki Web API",
        "props": [
            {
                "value": "smartlockId",
                "type": "msg"
            },
            {
                "value": "token",
                "type": "msg"
            }
        ],
        "x": 190,
        "y": 220,
        "wires": [
            [
                "c7413f7e.f51cb"
            ]
        ]
    }
]